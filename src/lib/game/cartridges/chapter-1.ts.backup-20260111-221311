import type { Chapter, ChapterId, Flag, Game, GameId, GameObject, GameObjectId, Item, ItemId, Location, LocationId, NPC, NpcId, Portal, PortalId, Structure, StructureId, WorldId, ZoneId } from '../types';

// --- Chapter 1: The Investigation Begins ---
// The player starts at a street location investigating the abduction of Lili

// =====================================
// ITEMS
// =====================================

const items: Record<ItemId, Item> = {
    // Starting items given to player on chapter start
    'item_audio_message': {
        id: 'item_audio_message' as ItemId,
        name: 'Voice Message',
        alternateNames: ['voice message', 'audio message', 'voicemail', 'message', 'sarah message', 'sarah voice message'],
        description: 'A voice message from Sarah Chen about the gray van sighting.',
        zone: 'personal', // Received via phone - always accessible
        capabilities: { isTakable: false, isReadable: false, isUsable: false, isCombinable: false, isConsumable: false, isScannable: false, isAnalyzable: false, isPhotographable: false },
        revealMethod: 'MANUAL',
        media: {
            audio: {
                url: '',
                description: 'Sarah Chen briefing about gray van sighting'
            }
        },
        handlers: {
            onExamine: {
                success: {
                    message: 'Voice message from Sarah Chen:\n\n"Burt, I tried pulling CCTV from the bus station that night. Cameras were offline. All of them.\n\nI did find something though - a gray van shows up on Elm Street traffic cams. Repeatedly. For weeks before April 15th.\n\nMight be worth checking out. Be careful."\n\nThe message points you to Elm Street to investigate the gray van.',
                    media: {
                        url: '',
                        description: 'Sarah Chen briefing about gray van sighting',
                        hint: 'audio message'
                    }
                }
            }
        },
        version: { schema: '1.0.0', content: '3.0.0' }
    },

    'item_lili_photo': {
        id: 'item_lili_photo' as ItemId,
        name: 'Photo of Lili',
        alternateNames: ['lili photo', 'photo', 'lili picture', 'picture of lili', 'photograph'],
        archetype: 'Evidence',
        description: 'A recent photo of Lili sent by Sarah Chen. Shows Lili\'s face clearly - useful for showing to witnesses.',
        zone: 'personal', // Received via phone from Sarah - always accessible
        capabilities: { isTakable: false, isReadable: false, isUsable: false, isCombinable: false, isConsumable: false, isScannable: false, isAnalyzable: false, isPhotographable: false },
        revealMethod: 'MANUAL',
        tags: ['evidence', 'photo'],
        media: {
            images: {
                default: {
                    url: '',
                    description: 'Recent photo of Lili',
                    hint: 'photo of Lili'
                }
            }
        },
        handlers: {
            onExamine: {
                success: {
                    message: 'A recent photo of Lili that Sarah sent to your phone. Clear facial details, good for showing to potential witnesses.\n\nYou can SHOW this photo TO people you meet to see if they recognize her.',
                    media: {
                        url: '',
                        description: 'Recent photo of Lili',
                        hint: 'photo of Lili'
                    }
                }
            },
            onUse: {
                fail: {
                    message: 'This photo is for showing to witnesses. Try: SHOW PHOTO TO <person name>',
                    media: undefined
                }
            }
        },
        design: {
            authorNotes: "Starting evidence item. Player uses this to trigger Margaret Chen witness statement by showing photo to her. Part of Evidence 3 puzzle.",
            tags: ['starting-item', 'witness-trigger', 'evidence']
        },
        version: { schema: '1.0.0', content: '1.0.0' }
    },

    'item_player_phone': {
        id: 'item_player_phone' as ItemId,
        name: 'Phone',
        alternateNames: ['phone', 'smartphone', 'cell phone', 'mobile', 'fbi phone', 'my phone', 'fbi smartphone'],
        archetype: 'Tool',
        description: "Your standard-issue FBI smartphone. It has a camera, secure messaging, and a slot for external media.",
        zone: 'personal', // Always accessible personal equipment
        capabilities: { isTakable: false, isReadable: false, isUsable: true, isCombinable: false, isConsumable: false, isScannable: false, isAnalyzable: false, isPhotographable: false },
        state: { currentStateId: 'default', readCount: 0 },
        media: {
            images: {
                default: { url: 'https://res.cloudinary.com/dg912bwcc/image/upload/v1762705398/Pulls_out_Phone_zrekhi.png', description: 'FBI-issue smartphone', hint: 'fbi phone' }
            }
        },
        handlers: {
            // EXAMINE - Visual inspection
            onExamine: {
                success: {
                    message: "FBI-issue smartphone. Camera, secure messaging, media slot. Standard kit. Always in your pocket.\n\nYou can USE PHONE to enter phone mode and make calls or take photos."
                }
            },

            // USE - Enter phone mode
            onUse: {
                success: {
                    message: "You take out your FBI phone. The screen lights up.\n\nThe notification LED blinks - you have unread messages.",
                    media: {
                        url: 'https://res.cloudinary.com/dg912bwcc/image/upload/v1762705398/Pulls_out_Phone_zrekhi.png',
                        description: 'Pulling out FBI phone from jacket',
                        hint: 'Taking out phone'
                    },
                    effects: [
                        { type: 'SET_DEVICE_FOCUS', deviceId: 'item_player_phone' as ItemId },
                        {
                            type: 'SHOW_MESSAGE',
                            speaker: 'system',
                            content: 'Phone Mode Active\n\nType CHECK MESSAGES to see voicemails.\nType CHECK EMAILS to read emails.\nType CALL <number> to dial.\nType TAKE PHOTO of ITEM for pictures.\n\nType PUT PHONE AWAY or CLOSE PHONE when done.'
                        }
                    ]
                }
            },

            // Call Handler - Dial phone numbers (only works in device focus mode)
            onCall: [
                {
                    // Default fallback - wrong number (plays automated message)
                    phoneNumber: '*',
                    conditions: [],
                    success: {
                        message: "You dial the number.\n\n[Automated voice]: \"The number you have dialed is currently not available. Please check the number and try again.\"\n\nThe line goes dead.",
                        media: {
                            url: 'https://res.cloudinary.com/dg912bwcc/video/upload/v1762705354/wrong_number_kazuze.mp3',
                            description: 'Automated wrong number message',
                            hint: 'Number not available'
                        }
                    }
                }
            ],

            // Check Messages Handler
            onCheckMessages: [
                {
                    // Already checked messages
                    conditions: [
                        { type: 'HAS_ITEM', itemId: 'item_audio_message' as ItemId }
                    ],
                    success: {
                        message: "You've already listened to your voicemail. Martinez mentioned checking your email for the case file."
                    }
                },
                {
                    // First time checking - reveal voice message
                    conditions: [],
                    success: {
                        message: "You tap the voicemail icon.\n\n**(1) New Voicemail**\n\nFrom: Martinez (FBI)\nReceived: Today, 8:47 AM\n\nYou play the message.",
                        effects: [
                            { type: 'ADD_ITEM', itemId: 'item_audio_message' as ItemId }
                        ]
                    }
                }
            ],

            // Check Emails Handler
            onCheckEmails: [
                {
                    // Default - no emails
                    conditions: [],
                    success: {
                        message: "You check your email inbox. Mostly spam and routine FBI updates. Nothing urgent.\n\nYou should focus on the voice message from Sarah about the gray van on Elm Street."
                    }
                }
            ],

            // Fallback
            defaultFailMessage: "The phone's a tool. Try USING it ON something that needs it, or CALL a phone number."
        },
        hints: {
            subtle: "Your FBI phone is a versatile tool. It can read media and take photos.",
            medium: "Use your phone to read documents, take photos of objects, or make calls.",
            direct: "Use phone to activate it, then take photos, read documents, or call phone numbers you find."
        },
        design: {
            authorNotes: "Universal tool/key for media devices and locked objects throughout the game.",
            tags: ['phone', 'device', 'tool', 'key']
        },
        version: { schema: "1.0", content: "3.0" }
    },

    'item_invoice': {
        id: 'item_invoice' as ItemId,
        name: 'Invoice',
        description: 'A crumpled invoice lying near the bus station bench.',
        capabilities: { isTakable: true, isReadable: true, isUsable: false, isCombinable: false, isConsumable: false, isScannable: false, isAnalyzable: false, isPhotographable: false },
        startingLocation: 'loc_street' as LocationId,
        parentId: 'obj_bench' as GameObjectId,
        revealMethod: 'REVEAL_FROM_PARENT',
        handlers: {
            onRead: {
                message: 'INVOICE #8847\nFlorist Express - Fresh Bouquets Daily\n47 Elm Street\nDelivery: 3:30 PM\nRecipient: [Smudged]\n\nThe invoice is dated today. Someone ordered flowers delivered to this street around the time Lili disappeared.',
                media: undefined
            },
            onExamine: {
                message: 'A crumpled piece of paper. It looks like a florist\'s invoice.',
                media: undefined
            }
        },
        version: { schema: '1.0.0', content: '1.0.0' }
    },

    'item_crowbar': {
        id: 'item_crowbar' as ItemId,
        name: 'Crowbar',
        description: 'A heavy steel crowbar. Rust-spotted but still solid. Good for prying things open.',
        capabilities: { isTakable: true, isReadable: false, isUsable: true, isCombinable: false, isConsumable: false, isScannable: false, isAnalyzable: false, isPhotographable: true },
        attributes: {
            force: 5,
            prying: 5,
            reusable: true
        },
        startingLocation: 'loc_street' as LocationId,
        parentId: 'obj_tire_stack' as GameObjectId,
        revealMethod: 'REVEAL_FROM_PARENT',
        handlers: {
            onTake: {
                success: {
                    message: 'You heft the crowbar. Cold steel. Three, maybe four pounds of rust-spotted persuasion.\n\nIt\'s yours now. For better or worse.\n\nIn this city, a crowbar\'s either a tool or a confession waiting to happen. You pocket it anyway. Because when you\'re hunting someone who hides things in tire stacks, you don\'t ask questions—you just take what you can get.\n\nBesides, it\'s not like the tires were using it.',
                    media: undefined
                }
            },
            onExamine: {
                success: {
                    message: 'Two feet of solid steel. A crowbar—the kind you find in toolboxes, garages, construction sites. One end curves into a claw for pulling nails. The other tapers to a flat wedge for prying.\n\nThe steel is rust-spotted, oxidation blooming in orange patches where the protective coating wore away. But underneath, it\'s still sound. Solid. You test it with your hand—no give, no flex. This thing could pry open a car door, lever up floorboards, shift heavy objects.\n\nIt\'s heavy. Maybe three, four pounds. You feel the weight in your hand, the cold metal warming slowly against your palm.\n\nSomeone hid this in the tire stack. Deliberately wedged it inside where it wouldn\'t be found unless you were looking.\n\nWhy hide a crowbar? What did they need it for?\n\nOr maybe the better question: what do you need it for?',
                    media: undefined
                }
            },
            onUse: {
                fail: {
                    message: 'The crowbar is a tool for leverage—prying, lifting, shifting heavy objects. You need a target to use it on.',
                    media: undefined
                }
            },
            onRead: {
                fail: {
                    message: 'It\'s a crowbar. Steel. No text. No markings. Just a tool. If you want to know more about it, try EXAMINING it.',
                    media: undefined
                }
            }
        },
        version: { schema: '1.0.0', content: '1.0.0' }
    },

    'item_crumpled_note': {
        id: 'item_crumpled_note' as ItemId,
        name: 'Crumpled Note',
        description: 'A handwritten note, crumpled and stained. Found in the dumpster.',
        capabilities: { isTakable: true, isReadable: true, isUsable: false, isCombinable: false, isConsumable: false, isScannable: false, isAnalyzable: false, isPhotographable: false },
        startingLocation: 'loc_street' as LocationId,
        parentId: 'obj_dumpster' as GameObjectId,
        revealMethod: 'REVEAL_FROM_PARENT',
        handlers: {
            onRead: {
                success: {
                    message: 'You smooth out the crumpled paper and read the handwriting. Blue ink, hurried strokes. Someone wrote this fast, under pressure maybe.\n\n"Check where the van was parked. The answer\'s in the tracks."\n\nThat\'s it. Just one sentence. Direct. Specific.\n\nBut below the text, someone scratched out a number. Heavy pen strokes, back and forth, obliterating whatever was written there. You can barely make it out through the scribbles:\n\n~~1940~~\n\nSomeone didn\'t want that number readable. Deliberately obscured it. But why write it down in the first place if you\'re just going to cross it out?\n\nThe message about the van tracks is clear though. Whoever wrote this note knew something. Knew the van left evidence. Knew where to look.\n\nAnd now you know too.',
                    media: undefined
                }
            },
            onExamine: {
                success: {
                    message: 'A piece of lined notebook paper, the kind you buy in cheap spiral notebooks at convenience stores. The edges are torn—ripped out hastily, not carefully removed along the perforations.\n\nIt\'s crumpled. Someone balled it up and threw it away. The creases are sharp, permanent. When you try to flatten it, it springs back into wrinkles.\n\nDirt stains the surface—coffee maybe, or just grime from being in the dumpster. The paper feels slightly damp, like it\'s been exposed to moisture.\n\nThere\'s handwriting on it. Blue ballpoint pen, the cheap kind. The writing is hurried, slanted, pressing hard into the paper. You can feel the indentations on the back where the pen dug in.\n\nWhoever wrote this was in a hurry. Or stressed. Or both.',
                    media: undefined
                }
            },
            onUse: {
                fail: {
                    message: 'It\'s a note. Information. Not a tool. If you want to know what it says, try READING it.',
                    media: undefined
                }
            }
        },
        version: { schema: '1.0.0', content: '1.0.0' }
    },

    'item_photo_tire_marks': {
        id: 'item_photo_tire_marks' as ItemId,
        name: 'Photo of Tire Marks',
        description: 'A photograph of tire marks left in the alley. Clear tread pattern visible.',
        capabilities: { isTakable: false, isReadable: false, isUsable: false, isCombinable: false, isConsumable: false, isScannable: false, isAnalyzable: false, isPhotographable: false },
        startingLocation: 'player',
        handlers: {
            onExamine: {
                success: {
                    message: 'You pull up the photo on your phone, zooming in to examine the details.\n\nThe tire marks are captured clearly. Two parallel tracks, tread pattern visible in sharp relief against the dirt. The diagonal crosshatch design stands out—commercial-grade tires, heavy-duty.\n\nYou zoom in further. The grooves are deep—you can see the depth even in the photo, shadows cast by the ridges. New rubber. Barely worn.\n\nThis is forensic-quality documentation. Clear enough to match against manufacturer specifications. Clear enough to identify the tire model.\n\nThe police report mentioned tire analysis. They cataloged the van\'s tire type—P225/60R16, forensics identified the tread pattern.\n\nYou should compare this photo to that specification. Match the pattern. Extract the numbers.\n\nThe code is in the tires. You just need to see it.',
                    media: undefined
                }
            },
            onRead: {
                fail: {
                    message: 'It\'s a photograph, not text. There\'s nothing to READ. Try EXAMINING it to analyze the tire tread pattern.',
                    media: undefined
                }
            },
            onUse: {
                fail: {
                    message: 'A photograph is evidence, not a tool. You can\'t USE it. You can EXAMINE it to analyze the details, or compare it to the police report\'s tire specifications.',
                    media: undefined
                }
            }
        },
        version: { schema: '1.0.0', content: '1.0.0' }
    },

    'item_box_cutter': {
        id: 'item_box_cutter' as ItemId,
        name: 'Box Cutter',
        alternateNames: ['box cutter', 'utility knife', 'cutter', 'knife', 'blade'],
        description: 'A small utility knife with an orange handle and retractable blade. Standard box cutter.',
        capabilities: { isTakable: true, isReadable: false, isUsable: true, isCombinable: false, isConsumable: false, isScannable: false, isAnalyzable: false, isPhotographable: false },
        attributes: {
            cutting: 5,
            reusable: true
        },
        startingLocation: 'loc_street' as LocationId,
        parentId: 'obj_old_suitcase' as GameObjectId,
        revealMethod: 'REVEAL_FROM_PARENT',
        tags: ['tool', 'sharp', 'blade'],
        handlers: {
            onExamine: {
                success: {
                    message: 'A standard utility knife. Orange plastic handle, cheap but functional. The kind you buy at hardware stores for a couple dollars.\n\nThe blade is retractable—currently extended about half an inch. Sharp edge, clean. No rust, no damage. Fresh blade, maybe.\n\nThere\'s a slider on the side to extend or retract the blade. Simple mechanism. Reliable.\n\nThe handle has no markings, no branding. Generic. Disposable. The kind of tool you use once and throw away.\n\nOr leave behind. In a cleaned-out suitcase. In a dumpster.\n\nWhy?',
                    media: undefined
                }
            },
            onUse: {
                fail: {
                    message: 'You need to specify what you want to use the box cutter on.',
                    media: undefined
                }
            },
            onTake: {
                success: {
                    message: 'You pick up the box cutter. Light. Compact. The orange handle fits comfortably in your palm.\n\nThe blade is sharp. Could be useful for cutting through tape, rope, cardboard. Opening sealed containers.\n\nYou pocket it.',
                    media: undefined
                }
            },
            onRead: {
                fail: {
                    message: 'It\'s a tool, not text. No markings, no serial numbers. Generic utility knife. Nothing to read.',
                    media: undefined
                }
            }
        },
        version: { schema: '1.0.0', content: '1.0.0' }
    },

    'item_picture_frame': {
        id: 'item_picture_frame' as ItemId,
        name: 'Picture Frame',
        alternateNames: ['picture frame', 'frame', 'empty frame', 'photo frame'],
        description: 'An empty wooden picture frame. No photo inside.',
        capabilities: { isTakable: true, isReadable: false, isUsable: false, isCombinable: false, isConsumable: false, isScannable: false, isAnalyzable: false, isPhotographable: false },
        startingLocation: 'loc_street' as LocationId,
        parentId: 'obj_old_suitcase' as GameObjectId,
        revealMethod: 'REVEAL_FROM_PARENT',
        tags: ['junk'],
        handlers: {
            onExamine: {
                success: {
                    message: 'A cheap wooden picture frame, the kind you see stacked in dollar store clearance bins. Thin wood, painted dark brown to mimic walnut or mahogany. The paint is chipping at the corners, exposing lighter wood underneath.\n\nThe frame is about 5x7 inches. Standard photo size. Mass-produced. Generic.\n\nBut here\'s what\'s strange: there\'s no photo inside.\n\nNo glass either. The frame is empty. Just the backing board, held in place by small metal tabs bent inward.\n\nWhy pack an empty picture frame in a suitcase? Why throw it away in a dumpster?\n\nIt\'s worthless. Decorative junk. The kind of thing you buy to fill space on a shelf.\n\nUnless it wasn\'t always empty.',
                    media: undefined
                }
            },
            onSearch: {
                success: {
                    message: 'You turn the frame over in your hands, examining every angle.\n\nThe backing is cardboard, thin and flimsy. You pry at the metal tabs holding it in place. They bend easily—too easily. Someone\'s opened this before. Recently.\n\nYou pull the backing free and check behind it.\n\nNothing.\n\nNo hidden photo. No secret compartment. No note tucked away.\n\nJust an empty frame. Hollow. Meaningless.\n\nOr maybe that\'s the point. Remove the photo. Destroy the evidence. Leave the frame behind as a shell—proof that something was here, once, but now it\'s gone.',
                    media: undefined
                }
            },
            onTake: {
                success: {
                    message: 'You pick up the empty picture frame. Lightweight. Worthless.\n\nBut you take it anyway. Sometimes the absence of something is more important than its presence.',
                    media: undefined
                }
            }
        },
        version: { schema: '1.0.0', content: '1.0.0' }
    },

    'item_candle': {
        id: 'item_candle' as ItemId,
        name: 'Decorative Candle',
        alternateNames: ['candle', 'decorative candle', 'unused candle'],
        description: 'An unused decorative candle. Still has the price sticker.',
        capabilities: { isTakable: true, isReadable: false, isUsable: false, isCombinable: false, isConsumable: false, isScannable: false, isAnalyzable: false, isPhotographable: false },
        startingLocation: 'loc_street' as LocationId,
        parentId: 'obj_old_suitcase' as GameObjectId,
        revealMethod: 'REVEAL_FROM_PARENT',
        tags: ['junk'],
        handlers: {
            onExamine: {
                success: {
                    message: 'A decorative candle. Pillar style, about four inches tall, two inches wide. The wax is cream-colored, molded to look like it\'s been hand-dipped—those little ridges and imperfections that mass-produced candles use to fake artisanal charm.\n\nIt\'s never been lit. The wick is pristine, white cotton, perfectly centered. No burn marks. No melted wax. Not even dust on the surface.\n\nYou turn it over. There\'s a price sticker on the bottom: $2.99. The kind of generic home decor you buy at discount stores to fill empty shelves. Make a space look lived-in. Cozy. Normal.\n\nBut it smells wrong.\n\nNot the wax itself—that\'s vanilla, artificial but pleasant. It\'s the smell underneath. Faint. Chemical. Sharp.\n\nBleach.\n\nThe candle absorbed it. Sitting in this suitcase, packed next to whatever else was in here, soaking up the fumes.',
                    media: undefined
                }
            },
            onSearch: {
                success: {
                    message: 'You roll the candle between your palms, checking the surface for seams, hidden compartments, anything unusual.\n\nNothing.\n\nSolid wax all the way through. You press your thumbnail into the side—it dents easily. Cheap paraffin wax. No hollow core. No hidden objects inside.\n\nYou check the wick. It\'s just cotton, unburned, standard issue.\n\nThe bottom is flat, smooth. Just the price sticker and a barcode. Generic product. Mass-produced.\n\nIt\'s exactly what it looks like: worthless home decor. Filler. The kind of item you pack when you\'re trying to make a suitcase look normal. Innocent.\n\nBecause who hides evidence in a suitcase full of cheap candles and picture frames?\n\nSomeone who wants you to think there\'s nothing worth finding.',
                    media: undefined
                }
            },
            onTake: {
                success: {
                    message: 'You pick up the candle. Light. Waxy. The vanilla scent clings to your fingers.\n\nCompletely useless as evidence. But maybe that\'s exactly why it\'s here.',
                    media: undefined
                }
            }
        },
        version: { schema: '1.0.0', content: '1.0.0' }
    },

    'item_tiny_silver_key': {
        id: 'item_tiny_silver_key' as ItemId,
        name: 'Tiny Silver Key',
        alternateNames: ['tiny silver key', 'silver key', 'tiny key', 'small key', 'key'],
        description: 'A small silver key, tarnished with age. No markings or labels. Delicate and precise.',
        capabilities: { isTakable: true, isReadable: false, isUsable: true, isCombinable: false, isConsumable: false, isScannable: false, isAnalyzable: false, isPhotographable: false },
        attributes: {
            unlocking: 1,
            reusable: true
        },
        startingLocation: 'loc_street' as LocationId,
        parentId: 'obj_pocket' as GameObjectId,
        revealMethod: 'REVEAL_FROM_PARENT',
        tags: ['key', 'tool'],
        handlers: {
            onExamine: {
                success: {
                    message: 'A tiny silver key. Delicate. Precise. The kind used for small locks—jewelry boxes, luggage, filing cabinets.\n\nThe silver is tarnished, darkened with age. No manufacturer marks. No serial number. Just a key.\n\nSomeone hid this in a coat lining. Deliberately. Carefully.\n\nWhat does it open?',
                    media: undefined
                }
            },
            onUse: {
                fail: {
                    message: 'You need to specify what you want to use the key on.',
                    media: undefined
                }
            },
            onTake: {
                success: {
                    message: 'You pick up the tiny silver key. It\'s light, almost weightless. You slip it into your pocket.\n\nA key hidden in a coat, hidden in a backpack, thrown in a dumpster.\n\nThe police overlooked this detail. But your instincts led you right here.',
                    media: undefined
                }
            },
            onRead: {
                fail: {
                    message: 'It\'s a key. Small. Silver. Tarnished. No writing, no markings, no serial numbers. Nothing to read.',
                    media: undefined
                }
            }
        },
        version: { schema: '1.0.0', content: '1.0.0' }
    },

    // ============================================
    // DARK ALLEY ITEMS
    // ============================================

    'obj_sealed_bag': {
        id: 'obj_sealed_bag' as GameObjectId,
        name: 'Sealed Black Bag',
        alternateNames: ['sealed backpack'],
        archetype: 'Container',
        description: 'A backpack, sealed tight with tape.',
        capabilities: { openable: true, lockable: false, breakable: false, movable: false, powerable: false, container: true, readable: false, inputtable: false },
        state: { isOpen: false, isLocked: false, isBroken: false, isPoweredOn: false, currentStateId: 'default' },
        inventory: { items: [], capacity: 3, allowTags: [], denyTags: [] },
        requirements: {
            options: [
                { attributes: { cutting: 3 } }
            ]
        },
        parentId: 'obj_alley_dumpster' as GameObjectId,
        revealMethod: 'REVEAL_FROM_PARENT',
        children: {
            items: ['item_cleaning_invoice' as ItemId],
            objects: []
        },
        handlers: {
            onExamine: [
                {
                    conditions: [{ type: 'STATE', entityId: 'obj_sealed_bag', key: 'isOpen', equals: true }],
                    success: {
                        message: 'The bag is torn open. The invoice inside is visible.',
                        media: undefined
                    }
                },
                {
                    conditions: [],
                    success: {
                        message: 'Black plastic bag, sealed with packing tape. Something\'s inside—feels like paper.',
                        media: undefined
                    }
                }
            ],
            onOpen: [
                {
                    conditions: [{ type: 'STATE', entityId: 'obj_sealed_bag', key: 'isOpen', equals: true }],
                    success: {
                        message: 'Already open.',
                        media: undefined
                    }
                },
                {
                    conditions: [],
                    success: {
                        message: 'You tear the tape off and rip the bag open.\n\nInside: a printed invoice from "Elite Cleaning Services." Address: 447 Elm Street. Timestamp: 11:47 PM.\n\nThat\'s after the supposed abduction time. Someone cleaned up after.',
                        media: undefined,
                        effects: [
                            { type: 'SET_ENTITY_STATE', entityId: 'obj_sealed_bag', patch: { isOpen: true } },
                            { type: 'REVEAL_FROM_PARENT', entityId: 'item_cleaning_invoice', parentId: 'obj_sealed_bag' }
                        ]
                    }
                }
            ]
        },
        design: {
            authorNotes: "Found in dumpster after climbing in. Contains cleaning invoice showing post-crime cleanup.",
            tags: ['evidence', 'container']
        },
        version: { schema: "1.0", content: "1.0" }
    },

    'item_cleaning_invoice': {
        id: 'item_cleaning_invoice' as ItemId,
        name: 'Cleaning Invoice',
        archetype: 'Document',
        description: 'A printed invoice from Elite Cleaning Services.',
        capabilities: { isTakable: true, isReadable: true, isUsable: false, isCombinable: false, isConsumable: false, isScannable: false, isAnalyzable: false, isPhotographable: false },
        tags: ['document', 'evidence', 'clue'],
        handlers: {
            onExamine: {
                success: {
                    message: 'Elite Cleaning Services\n447 Elm Street\nService Date: [REDACTED]\nTime: 11:47 PM\n\nServices Rendered:\n- Deep sterilization\n- Biohazard disposal\n- Surface decontamination\n\nTotal: $2,400 (PAID)\n\nThis was professional. Thorough. Someone wanted that scene clean.',
                    media: undefined
                }
            },
            onRead: {
                success: {
                    message: 'The invoice shows a cleaning crew was at 447 Elm Street at 11:47 PM. That\'s after the abduction supposedly happened at 11:30 PM.\n\nThey weren\'t cleaning a crime scene. They were erasing evidence of staging.',
                    media: undefined
                }
            }
        },
        design: {
            authorNotes: "Key evidence showing the scene was cleaned after the staged crime. Timestamp is crucial.",
            tags: ['evidence', 'timeline']
        },
        version: { schema: "1.0", content: "1.0" }
    },

    'obj_cashbox': {
        id: 'obj_cashbox' as GameObjectId,
        name: 'Metal Cashbox',
        alternateNames: ['metal cashbox', 'cashbox', 'cash box', 'metal box', 'box'],
        archetype: 'Container',
        description: 'A small locked metal cashbox, dented and scratched.',
        capabilities: { openable: false, lockable: true, breakable: true, movable: false, powerable: false, container: true, readable: false, inputtable: false },
        state: { isOpen: false, isLocked: true, isBroken: false, isPoweredOn: false, currentStateId: 'default' },
        inventory: { items: [], capacity: 3, allowTags: [], denyTags: [] },
        children: {
            items: ['item_contact_sheet' as ItemId],
            objects: []
        },
        handlers: {
            onExamine: [
                {
                    conditions: [{ type: 'STATE', entityId: 'obj_cashbox', key: 'isBroken', equals: true }],
                    success: {
                        message: 'The cashbox is smashed open, lid bent back. A printed contact sheet is inside.',
                        media: undefined
                    }
                },
                {
                    conditions: [],
                    success: {
                        message: 'Small metal cashbox. Locked tight. No keyhole—just a cheap combination latch that\'s rusted shut.\n\nYou could break it open.',
                        media: undefined
                    }
                }
            ],
            onBreak: [
                {
                    conditions: [{ type: 'STATE', entityId: 'obj_cashbox', key: 'isBroken', equals: true }],
                    success: {
                        message: 'Already smashed open.',
                        media: undefined
                    }
                },
                {
                    conditions: [],
                    success: {
                        message: 'You swing the crowbar down hard.\n\nCRUNCH. Metal buckles. The lid tears free.\n\nInside: a printed contact sheet with phone numbers and codenames.',
                        media: undefined,
                        effects: [
                            { type: 'SET_ENTITY_STATE', entityId: 'obj_cashbox', patch: { isBroken: true } },
                            { type: 'SET_ENTITY_STATE', entityId: 'obj_cashbox', patch: { isOpen: true } },
                            { type: 'REVEAL_FROM_PARENT', entityId: 'item_contact_sheet', parentId: 'obj_cashbox' },
                            { type: 'SET_FLAG', flag: 'found_contact_sheet', value: true }
                        ]
                    }
                }
            ],
            onUse: [
                {
                    itemId: 'item_alley_crowbar',
                    conditions: [{ type: 'STATE', entityId: 'obj_cashbox', key: 'isBroken', equals: true }],
                    success: {
                        message: 'Already smashed.',
                        media: undefined
                    }
                },
                {
                    itemId: 'item_alley_crowbar',
                    conditions: [],
                    success: {
                        message: 'You wedge the crowbar under the lid and twist.\n\nSNAP. Metal rips. Lid tears off.\n\nInside: a printed contact sheet with phone numbers and codenames.',
                        media: undefined,
                        effects: [
                            { type: 'SET_ENTITY_STATE', entityId: 'obj_cashbox', patch: { isBroken: true } },
                            { type: 'SET_ENTITY_STATE', entityId: 'obj_cashbox', patch: { isOpen: true } },
                            { type: 'REVEAL_FROM_PARENT', entityId: 'item_contact_sheet', parentId: 'obj_cashbox' },
                            { type: 'SET_FLAG', flag: 'found_contact_sheet', value: true }
                        ]
                    }
                }
            ]
        },
        design: {
            authorNotes: "Onion layer 2. Found in locker. Must be broken with crowbar. Contains contact sheet.",
            tags: ['container', 'breakable', 'onion-chain']
        },
        version: { schema: "1.0", content: "1.0" }
    },

    'item_contact_sheet': {
        id: 'item_contact_sheet' as ItemId,
        name: 'Contact Sheet',
        archetype: 'Document',
        description: 'A printed sheet with phone numbers and codenames.',
        capabilities: { isTakable: true, isReadable: true, isUsable: false, isCombinable: false, isConsumable: false, isScannable: false, isAnalyzable: false, isPhotographable: false },
        tags: ['document', 'evidence', 'clue'],
        handlers: {
            onExamine: {
                success: {
                    message: 'Contact Sheet - Internal Network\n\n"Florist" - (555) 0147\n"Cleaner" - (555) 0891\n"Watcher" - (555) 0234\n"Stage Hand" - (555) 0412\n\nOne of these numbers—"Watcher"—matches the network ID from the CCTV system logs. The same people who shut down the cameras also had a stash in this alley.\n\nThis wasn\'t random. It was coordinated.',
                    media: undefined
                }
            },
            onRead: {
                success: {
                    message: 'Four codenames. Four numbers. "Watcher" is the one that matters—it ties directly to the surveillance logs.\n\nThe operation had multiple roles. Florist. Cleaner. Watcher. Stage Hand.\n\nYou\'re looking at an organized team.',
                    media: undefined
                }
            }
        },
        design: {
            authorNotes: "Final onion layer. Cross-references CCTV logs. Proves coordination between alley operation and camera shutdown.",
            tags: ['evidence', 'cross-reference', 'endgame']
        },
        version: { schema: "1.0", content: "1.0" }
    },

    'obj_burner_phone': {
        id: 'obj_burner_phone' as GameObjectId,
        name: 'Burner Phone',
        alternateNames: ['burner phone', 'phone', 'burner', 'prepaid phone', 'cheap phone'],
        archetype: 'Device',
        description: 'A cheap prepaid phone with a cracked screen.',
        capabilities: { openable: false, lockable: false, breakable: false, movable: false, powerable: true, container: false, readable: false, inputtable: false },
        state: { isOpen: false, isLocked: false, isBroken: false, isPoweredOn: false, currentStateId: 'default' },
        handlers: {
            onExamine: {
                success: {
                    message: 'Cheap burner phone. Screen cracked. No SIM card visible.\n\nIt might still have call logs or messages if you can power it on.',
                    media: undefined
                }
            }
        },
        design: {
            authorNotes: "TODO: Add power-on handler to reveal call logs linking to contact sheet numbers.",
            tags: ['evidence', 'device', 'TODO']
        },
        version: { schema: "1.0", content: "1.0" }
    },

    'item_script_sheet': {
        id: 'item_script_sheet' as ItemId,
        name: 'Scene Script Sheet',
        archetype: 'Document',
        description: 'A printed scene script with blocking notes and codes.',
        capabilities: { isTakable: true, isReadable: true, isUsable: false, isCombinable: false, isConsumable: false, isScannable: false, isAnalyzable: false, isPhotographable: false },
        tags: ['document', 'evidence', 'clue'],
        handlers: {
            onExamine: {
                success: {
                    message: 'SCENE BREAKDOWN - CAFE ABDUCTION\n\nACT 1: Setup\n- Victim enters @ 11:15 PM\n- Barista on shift (paid)\n- Manager off-site (confirmed)\n\nACT 2: Event\n- Staged struggle 11:30 PM\n- CCTV offline 11:28-11:45 PM\n- Witness cued @ 11:32 PM\n\nACT 3: Cleanup\n- Cleaning crew @ 11:47 PM\n- Evidence planted by 12:00 AM\n\nNOTES:\n- Backdoor code = SB year\n- Confirm all props removed\n\nThis is a script. The whole thing was theater.',
                    media: undefined
                }
            },
            onRead: {
                success: {
                    message: 'You read the script carefully.\n\nEvery detail was planned. The timing. The witness. The cleanup.\n\nAnd there—"Backdoor code = SB year."\n\nYou saw "SB 1984" spray-painted in the alley. That\'s the code.\n\n1984.',
                    media: undefined,
                    effects: [
                        { type: 'SET_FLAG', flag: 'knows_backdoor_code', value: true }
                    ]
                }
            }
        },
        design: {
            authorNotes: "Provides the backdoor code hint (SB year = 1984). Cross-references with graffiti in alley.",
            tags: ['clue', 'puzzle', 'cross-reference']
        },
        version: { schema: "1.0", content: "1.0" }
    },

    // =====================================
    // NEW EVIDENCE ITEMS (Chapter 1 Design)
    // =====================================

    'item_cctv_screenshot': {
        id: 'item_cctv_screenshot' as ItemId,
        name: 'CCTV Screenshot',
        alternateNames: ['cctv screenshot', 'screenshot', 'cctv photo', 'gray van photo', 'van screenshot'],
        archetype: 'Evidence',
        description: 'Printed screenshot from CCTV footage showing gray van with license plate LKJ-9472 on Elm Street.',
        capabilities: { isTakable: true, isReadable: true, isUsable: false, isCombinable: false, isConsumable: false, isScannable: false, isAnalyzable: false, isPhotographable: true },
        startingLocation: 'loc_street' as LocationId,
        parentId: 'obj_cctv_monitor' as GameObjectId,
        revealMethod: 'REVEAL_FROM_PARENT',
        tags: ['evidence', 'photo', 'clue'],
        media: {
            images: {
                default: {
                    url: '',
                    description: 'CCTV screenshot showing gray van with license plate LKJ-9472',
                    hint: 'gray van license plate'
                }
            }
        },
        handlers: {
            onExamine: {
                success: {
                    message: 'A printed screenshot from CCTV footage dated April 15, 6:15 PM. The image shows a gray cargo van parked on Elm Street.\n\nThe license plate is clearly visible: **LKJ-9472**\n\nThis contradicts the police report - this van was on Elm Street repeatedly before the abduction. The numeric portion of the plate (9472) might be useful.',
                    media: {
                        url: '',
                        description: 'CCTV screenshot showing gray van with license plate LKJ-9472',
                        hint: 'gray van license plate'
                    }
                }
            },
            onRead: {
                success: {
                    message: 'You study the screenshot carefully.\n\nTimestamp: April 15, 6:15 PM\nLocation: Elm Street (Traffic Camera #4)\nVehicle: Gray cargo van\nLicense Plate: **LKJ-9472**\n\nThe timestamp matches the time of Lili\'s alleged abduction. This van was here. The plate number is clear - remember those digits: 9472.',
                    media: undefined
                }
            },
            onTake: {
                success: {
                    message: 'You take the CCTV screenshot. Evidence #1.\n\nThe license plate LKJ-9472 is now documented. The four-digit portion (9472) stands out - it might be a code or PIN for something.',
                    media: undefined
                }
            }
        },
        hints: {
            subtle: "The license plate has a four-digit number that might be useful elsewhere.",
            medium: "The numeric portion of the plate (9472) could unlock something.",
            direct: "Use 9472 as a PIN code when you find a digital keypad."
        },
        design: {
            authorNotes: "Evidence 1 (EASY). Provides PIN 9472 for Garage #3. Found in CCTV Building monitor station.",
            tags: ['evidence', 'puzzle-key', 'pin-code']
        },
        version: { schema: "1.0", content: "1.0" }
    },

    'item_van_registration': {
        id: 'item_van_registration' as ItemId,
        name: 'Van Registration Card',
        alternateNames: ['van registration', 'registration card', 'registration', 'vehicle registration'],
        archetype: 'Evidence',
        description: 'Vehicle registration card for gray van (plate LKJ-9472). Owner: Jeremy Miller, 447 Willow Lane.',
        capabilities: { isTakable: true, isReadable: true, isUsable: false, isCombinable: false, isConsumable: false, isScannable: false, isAnalyzable: false, isPhotographable: true },
        startingLocation: 'loc_street' as LocationId,
        parentId: 'obj_garage_3_glove_box' as GameObjectId,
        revealMethod: 'REVEAL_FROM_PARENT',
        tags: ['evidence', 'document', 'clue'],
        media: {
            images: {
                default: {
                    url: '',
                    description: 'Vehicle registration card showing owner Jeremy Miller',
                    hint: 'van registration'
                }
            }
        },
        handlers: {
            onExamine: {
                success: {
                    message: 'A vehicle registration card for the gray van.\n\nYou examine the details carefully.',
                    media: {
                        url: '',
                        description: 'Vehicle registration card showing owner Jeremy Miller',
                        hint: 'van registration'
                    }
                }
            },
            onRead: {
                success: {
                    message: 'VEHICLE REGISTRATION\n\nMake/Model: 2024 Ford Transit Cargo Van\nColor: Gray\nPlate: LKJ-9472\n\nOwner: **Jeremy Miller**\nAddress: **447 Willow Lane, Bloodhaven**\n\nRegistration Date: March 2026\n\nThis is it. The van owner\'s name and address. Jeremy Miller was operating this van on Elm Street for weeks before April 15th. This connects directly to the hardware receipt signed "J. Miller."',
                    media: undefined
                }
            },
            onTake: {
                success: {
                    message: 'You take the van registration card. Evidence #2.\n\nJeremy Miller, 447 Willow Lane. You now have a suspect name and address. This is the breakthrough Sarah was hoping for.',
                    media: undefined
                }
            }
        },
        hints: {
            subtle: "The address on Willow Lane might lead to more answers.",
            medium: "Jeremy Miller's address could be investigated in future chapters.",
            direct: "This registration connects the van to Jeremy Miller at 447 Willow Lane - a lead for Chapter 2."
        },
        design: {
            authorNotes: "Evidence 2 (HARD). Found in Garage #3 glove compartment (requires PIN 9472 from Evidence 1). Provides suspect name and address for future chapters.",
            tags: ['evidence', 'critical-lead', 'chapter-connector']
        },
        version: { schema: "1.0", content: "1.0" }
    },

    'item_witness_statement_audio': {
        id: 'item_witness_statement_audio' as ItemId,
        name: 'Recorded Witness Statement',
        alternateNames: ['witness statement', 'recorded statement', 'audio statement', 'margaret statement', 'florist statement'],
        archetype: 'Evidence',
        description: 'Audio recording of witness statement from Margaret Chen (florist) describing Lili\'s relationship with an obsessed young man.',
        capabilities: { isTakable: false, isReadable: false, isUsable: false, isCombinable: false, isConsumable: false, isScannable: false, isAnalyzable: false, isPhotographable: false },
        zone: 'personal',
        revealMethod: 'MANUAL',
        tags: ['evidence', 'audio', 'witness'],
        media: {
            audio: {
                url: '',
                description: 'Margaret Chen witness statement recording'
            }
        },
        handlers: {
            onExamine: {
                success: {
                    message: 'An audio recording of Margaret Chen\'s witness statement. You can play it back to review the details.',
                    media: {
                        url: '',
                        description: 'Margaret Chen witness statement recording',
                        hint: 'audio recording'
                    }
                }
            },
            onListen: {
                success: {
                    message: '[Audio Recording - Margaret Chen, Petal & Stem Florist]\n\n"My name is Margaret Chen, owner of Petal & Stem Florist on Elm Street. I\'ve seen the woman in this photo—Lili—multiple times over the past two months.\n\nShe always came with a young man who appeared obsessively devoted to her. Mid-twenties, I\'d say. Quiet type. But... intense. The way he looked at her—completely devoted. Hung on her every word.\n\nShe seemed more... reserved. Calculating, almost. Always looking over her shoulder. But him? He\'d do anything she asked. Anything. I\'ve seen that look before. It\'s... obsession."\n\n[End Recording]\n\nThis proves Lili had a relationship with someone - an obsessed young man who would "do anything she asked." This wasn\'t a random abduction.',
                    media: {
                        url: '',
                        description: 'Margaret Chen witness statement recording',
                        hint: 'audio recording'
                    }
                }
            }
        },
        hints: {
            subtle: "This statement proves Lili knew her alleged abductor.",
            medium: "Margaret's testimony establishes a pre-existing relationship - this wasn't random.",
            direct: "This witness statement proves the abduction was staged - Lili knew an obsessed man who would do anything for her."
        },
        design: {
            authorNotes: "Evidence 3 (MEDIUM). Created via phone recording mechanic when player shows Lili's photo to Margaret Chen NPC at florist shop.",
            tags: ['evidence', 'npc-interaction', 'relationship-proof']
        },
        version: { schema: "1.0", content: "1.0" }
    },

    'item_hardware_receipt': {
        id: 'item_hardware_receipt' as ItemId,
        name: 'Hardware Store Receipt',
        alternateNames: ['hardware receipt', 'receipt', 'hardware store receipt', 'j miller receipt'],
        archetype: 'Evidence',
        description: 'Receipt from hardware store showing J. Miller purchased zip ties, duct tape, and drop cloth on April 10.',
        capabilities: { isTakable: true, isReadable: true, isUsable: false, isCombinable: false, isConsumable: false, isScannable: false, isAnalyzable: false, isPhotographable: true },
        startingLocation: 'loc_street' as LocationId,
        parentId: 'obj_electrician_toolbox' as GameObjectId,
        revealMethod: 'REVEAL_FROM_PARENT',
        tags: ['evidence', 'document', 'receipt'],
        media: {
            images: {
                default: {
                    url: '',
                    description: 'Hardware store receipt for abduction supplies',
                    hint: 'receipt'
                }
            }
        },
        handlers: {
            onExamine: {
                success: {
                    message: 'A folded receipt from "Bloodhaven Hardware & Supply." It\'s crumpled but readable.',
                    media: {
                        url: '',
                        description: 'Hardware store receipt for abduction supplies',
                        hint: 'receipt'
                    }
                }
            },
            onRead: {
                success: {
                    message: 'BLOODHAVEN HARDWARE & SUPPLY\n\nDate: April 10, 2026 (5 days before April 15)\nTime: 2:47 PM\n\nItems Purchased:\n- Zip Ties (Heavy Duty, 100-pack) ......... $12.99\n- Duct Tape (Industrial, 2-pack) ......... $8.49\n- Drop Cloth (9x12 plastic) .............. $6.99\n\nSubtotal: $28.47\nTax: $2.28\nTotal: $30.75\n\nPayment: Credit Card\nCardholder: **J. Miller**\n\n---\n\nYour stomach tightens. Zip ties. Duct tape. Drop cloth.\n\nThese are abduction supplies. Purchased five days before Lili\'s alleged disappearance. By "J. Miller" - the same name on the van registration.\n\nThis wasn\'t random. This was premeditated.',
                    media: undefined
                }
            },
            onTake: {
                success: {
                    message: 'You take the hardware receipt. Evidence #4.\n\nJ. Miller bought abduction supplies five days early. Combined with the van registration, this proves premeditation. Someone planned this.',
                    media: undefined
                }
            }
        },
        hints: {
            subtle: "The date is five days before the abduction - this was planned in advance.",
            medium: "J. Miller matches the van owner's name. These supplies were bought for the staged abduction.",
            direct: "This receipt proves Jeremy Miller planned the abduction days in advance - it wasn't spontaneous."
        },
        design: {
            authorNotes: "Evidence 4 (MEDIUM). Found in Electrician truck toolbox (requires distracting Mike Kowalski first). Proves premeditation and connects to van registration.",
            tags: ['evidence', 'premeditation', 'name-match']
        },
        version: { schema: "1.0", content: "1.0" }
    }
};

// =====================================
// GAME OBJECTS
// =====================================

const gameObjects: Record<GameObjectId, GameObject> = {
    // ZONE 1: Bus Station - Main Structure
    'obj_bus_stop': {
        id: 'obj_bus_stop' as GameObjectId,
        name: 'Bus Stop',
        alternateNames: ['bus stop', 'bus station', 'stop', 'shelter', 'bus shelter'],
        archetype: 'Structure',
        description: 'The bus stop where Lili Morgenstern was allegedly taken. A weathered shelter with an old bench, a trash bin, and a timetable board.',
        transitionNarration: 'You approach the bus stop. The rusted shelter looms ahead—where Lili Morgenstern claims the abduction took place.',
        capabilities: { openable: false, lockable: false, breakable: false, movable: false, powerable: false, container: true, readable: false, inputtable: false },
        state: { isOpen: false, isLocked: false, isBroken: false, isPoweredOn: false, currentStateId: 'default' },
        children: {
            items: [],
            objects: ['obj_bench' as GameObjectId, 'obj_info_board' as GameObjectId, 'obj_bus_sign' as GameObjectId]
        },
        handlers: {
            onExamine: {
                message: 'The bus stop stands under a rusted metal shelter. Paint peels from the frame in long, pale strips. An old wooden bench occupies most of the space, its surface stained dark from decades of use. A trash bin leans against one support beam, overflowing with discarded wrappers and newspapers. The information board—scratched plexiglass over faded paper—displays bus routes and a missing person poster.\n\nThis is where it happened. Where an eight-year-old girl vanished in broad daylight. The ordinary becomes sinister when you know what occurred here. Every detail—bench, bin, timetable—takes on weight, significance. One of these elements holds a clue. You just have to find it.',
                media: {
                    url: '',
                    description: 'Bus stop with bench, bin, and information board',
                    hint: 'crime scene location'
                },
                effects: [
                    { type: 'REVEAL_FROM_PARENT', entityId: 'obj_bench', parentId: 'obj_bus_stop' },
                    { type: 'REVEAL_FROM_PARENT', entityId: 'obj_info_board', parentId: 'obj_bus_stop' },
                    { type: 'REVEAL_FROM_PARENT', entityId: 'obj_bus_sign', parentId: 'obj_bus_stop' }
                ]
            },
            onSearch: {
                message: 'You methodically scan the bus stop, detective instincts sharp. The trash bin—nothing unusual, just refuse. The shelter frame—weathered but unremarkable. The information board catches your eye briefly, but it\'s the bench that draws your attention.\n\nAccording to the police report, witnesses mentioned seeing Lili sitting on the bench moments before she disappeared. The florist\'s delivery was at 3:30 PM—the same time as the abduction. Something about that timing feels deliberate. Too precise to be coincidence.\n\nThe bench. Check the bench closer.',
                media: undefined
            }
        },
        version: { schema: '1.0.0', content: '1.0.0' }
    },

    'obj_bench': {
        id: 'obj_bench' as GameObjectId,
        name: 'Bench',
        alternateNames: ['bench', 'wooden bench', 'weathered bench', 'seat', 'bus bench'],
        archetype: 'Furniture',
        description: 'A weathered wooden bench at the bus station, its surface darkened by years of use and weather.',
        transitionNarration: 'You move closer to the bench. This is where Lili sat moments before she disappeared.',
        capabilities: { openable: false, lockable: false, breakable: false, movable: true, powerable: false, container: false, readable: false, inputtable: false },
        state: { isOpen: false, isLocked: false, isBroken: false, isPoweredOn: false, currentStateId: 'default' },
        children: {
            items: ['item_invoice' as ItemId],
            objects: []
        },
        handlers: {
            onExamine: [
                {
                    // Before moving bench - invoice still hidden
                    conditions: [
                        { type: 'STATE', entityId: 'obj_bench', key: 'isMoved', equals: false }
                    ],
                    success: {
                        message: 'The bench is simple—weathered wood bolted to a metal frame. Decades of rain and sun have turned the planks gray-brown, the grain raised like old scars. Names and initials carved into the surface speak of bored teenagers and restless waits.\n\nYou crouch down, examining the legs. One of them—the front-right—has something caught beneath it. A corner of paper, wedged between wood and concrete. The wind must have pushed it there, or maybe someone kicked it aside without noticing.\n\nIt looks like a receipt or invoice. Partially hidden, easy to miss unless you were looking for it.',
                        media: {
                            url: '',
                            description: 'Wooden bench with paper visible under leg',
                            hint: 'receipt partially hidden under bench leg'
                        }
                    }
                },
                {
                    // After moving bench - invoice revealed but not taken
                    conditions: [
                        { type: 'STATE', entityId: 'obj_bench', key: 'isMoved', equals: true },
                        { type: 'NOT_HAS_ITEM', itemId: 'item_invoice' }
                    ],
                    success: {
                        message: 'The bench sits slightly askew from where you moved it. The invoice lies on the ground next to the bench leg, fully visible now—wrinkled and dirt-smudged but readable.',
                        media: {
                            url: '',
                            description: 'Bench with invoice lying on ground',
                            hint: 'receipt on ground next to bench'
                        }
                    }
                },
                {
                    // After taking invoice
                    conditions: [
                        { type: 'HAS_ITEM', itemId: 'item_invoice' }
                    ],
                    success: {
                        message: 'The bench sits where you moved it, slightly off-center. The spot where the invoice was is now just bare concrete, a faint dust outline marking where it lay.',
                        media: {
                            url: '',
                            description: 'Bench with empty ground beneath',
                            hint: 'invoice taken, nothing underneath'
                        }
                    }
                },
                {
                    // Default fallback
                    conditions: [],
                    success: {
                        message: 'The bench is worn and weathered, its wood darkened by years of exposure.',
                        media: undefined
                    }
                }
            ],
            onMove: {
                message: 'You grip the bench and shift it to the side. The metal legs scrape against concrete with a harsh sound. The invoice slides free, now fully visible on the ground—crumpled, dirt-stained, but readable.\n\nFlorist Express. Delivery timestamp: 3:30 PM. The same time Lili vanished.',
                media: {
                    url: '',
                    description: 'Bench moved, invoice on ground',
                    hint: 'receipt revealed'
                },
                effects: [
                    { type: 'REVEAL_FROM_PARENT', entityId: 'item_invoice', parentId: 'obj_bench' }
                ]
            },
            onSearch: {
                message: 'You run your hands along the bench slats, checking for anything hidden or carved beneath the surface. Nothing. Just smooth wood, worn soft by countless hands. But when you check underneath, you spot it—that corner of paper wedged beneath the front-right leg.',
                media: undefined
            },
            onUse: {
                message: 'You sit down on the bench, the wood hard and slightly uneven beneath you. Not comfortable, but not unbearable either. How many people have sat here? Thousands, probably. Tens of thousands over the decades.\n\nOrdinary people waiting for ordinary buses. Families. Workers. Students. But also—statistically speaking—criminals. Thieves. Maybe even murderers. This bench has held them all, made no distinction. Wood doesn\'t judge.\n\nYou imagine Lili sitting here, eight years old, backpack on her lap. Waiting. Trusting. And then—what? Someone approached. Said something. Offered something. And she went with them. Just like that.\n\nThe ordinariness of it haunts you. Evil doesn\'t announce itself. It wears a familiar face, speaks in calm tones, moves through the world undetected. Until it\'s too late.',
                media: undefined
            }
        },
        version: { schema: '1.0.0', content: '1.0.0' }
    },

    'obj_info_board': {
        id: 'obj_info_board' as GameObjectId,
        name: 'Info Board',
        alternateNames: ['info board', 'information board', 'board', 'schedule board', 'bus schedule'],
        archetype: 'Readable',
        description: 'A plastic-covered information board displaying bus schedules and a missing person poster.',
        transitionNarration: 'You step up to the information board. Bus schedules and a missing person poster stare back at you through scratched plexiglass.',
        capabilities: { openable: false, lockable: false, breakable: false, movable: false, powerable: false, container: true, readable: true, inputtable: false },
        state: { isOpen: false, isLocked: false, isBroken: false, isPoweredOn: false, currentStateId: 'default' },
        children: {
            items: [],
            objects: ['obj_missing_poster' as GameObjectId]
        },
        handlers: {
            onExamine: {
                message: 'The information board is scratched and yellowed, protected by a sheet of cloudy plexiglass. Behind the plastic: bus route maps, timetables, and—prominently displayed—a missing person poster. Lili Morgenstern\'s face stares out from the poster, a recent photo showing a young woman in her mid-twenties.',
                media: {
                    url: '',
                    description: 'Bus stop information board with schedules and missing poster',
                    hint: 'information board with timetables'
                }
            },
            onRead: {
                message: 'BUS SCHEDULE - ROUTE 42\nMonday - Friday: Every 30 minutes\n3:00 PM - Elm & 5th (This Stop)\n3:30 PM - Oak & 3rd\n4:00 PM - Maple & 7th\n\nWeekends: Every 45 minutes\n\nThe 3:30 PM bus would have arrived here right around the time Lili disappeared. Did the abductor time it deliberately? Use the crowd, the movement, the distraction of people boarding and departing?',
                media: undefined
            }
        },
        version: { schema: '1.0.0', content: '1.0.0' }
    },

    'obj_missing_poster': {
        id: 'obj_missing_poster' as GameObjectId,
        name: 'Missing Poster',
        archetype: 'Readable',
        description: 'A freshly printed missing person poster for Lili Morgenstern.',
        capabilities: { openable: false, lockable: false, breakable: false, movable: false, powerable: false, container: false, readable: true, inputtable: false },
        state: { isOpen: false, isLocked: false, isBroken: false, isPoweredOn: false, currentStateId: 'default' },
        parentId: 'obj_info_board' as GameObjectId,
        revealMethod: 'REVEAL_FROM_PARENT',
        handlers: {
            onExamine: {
                message: 'MISSING: LILI MORGENSTERN, Age 24\n\nThe poster is crisp, recently printed. Lili\'s photo shows a young woman with dark hair, a slight smile. The text below lists her height, weight, last known clothing. A phone number for tips.\n\n"Last seen: Bus station, Elm Street area, April 15th, 6:15 PM"\n\nBut something about the poster feels... off. The photo is slightly overexposed, washed out. The plea—"Please help us find her"—reads flat, mechanical. Like it was written by someone going through motions rather than feeling desperation.\n\nWeird. You\'ve seen hundreds of these posters. This one looks cold. Professional, but cold.',
                media: {
                    url: '',
                    description: 'Missing person poster for Lili Morgenstern',
                    hint: 'missing person poster'
                }
            },
            onRead: {
                message: 'You read the details carefully:\n\nMISSING PERSON\nName: Lili Morgenstern\nAge: 24 years old\nHeight: 5\'6"\nLast Seen: 6:15 PM, bus station, Elm Street area\nClothing: Black jacket, jeans, white sneakers\n\nContact: (555) 0147\n\nThe timestamp bothers you. 6:15 PM. Right when the bus station cameras went offline. Everything about this alleged abduction feels choreographed.',
                media: undefined
            }
        },
        version: { schema: '1.0.0', content: '1.0.0' }
    },

    'obj_bus_sign': {
        id: 'obj_bus_sign' as GameObjectId,
        name: 'Bus Sign',
        archetype: 'Decoration',
        description: 'A simple metal sign marking the bus stop.',
        transitionNarration: 'You approach the bus sign. Simple, direct—BUS. Nothing more.',
        capabilities: { openable: false, lockable: false, breakable: false, movable: false, powerable: false, container: false, readable: false, inputtable: false },
        state: { isOpen: false, isLocked: false, isBroken: false, isPoweredOn: false, currentStateId: 'default' },
        handlers: {
            onExamine: {
                message: 'A simple metal sign bolted to the shelter post. White letters on blue background: BUS.\n\nThat\'s it. No route numbers, no additional information. Just BUS.\n\nSomehow, the blunt simplicity of it feels appropriate. This is a bus stop. People wait here. Sometimes they never arrive at their destinations.',
                media: {
                    url: '',
                    description: 'Blue metal sign reading BUS',
                    hint: 'simple bus stop sign'
                }
            }
        },
        version: { schema: '1.0.0', content: '1.0.0' }
    },

    // ZONE 3: Gray Building
    'obj_gray_building_door': {
        id: 'obj_gray_building_door' as GameObjectId,
        name: 'Locked Door',
        alternateNames: ['locked door', 'door', 'gray building', 'gray building door', 'grey building', 'steel door', 'metal door'],
        archetype: 'Door',
        description: 'A heavy metal door on the gray building. It\'s locked tight.',
        transitionNarration: 'You walk over to the gray building. The steel door stands imposing, locked tight. No nameplate, no signage.',
        capabilities: { openable: true, lockable: true, breakable: false, movable: false, powerable: false, container: false, readable: false, inputtable: false },
        state: { isOpen: false, isLocked: true, isBroken: false, isPoweredOn: false, currentStateId: 'default' },
        handlers: {
            onExamine: {
                message: 'A solid steel door painted gray. There\'s no nameplate or signage. The lock looks industrial-grade.',
                media: undefined
            },
            onOpen: {
                message: 'The door is locked. You\'ll need a key or another way to get inside.',
                media: undefined
            }
        },
        version: { schema: '1.0.0', content: '1.0.0' }
    },

    // ZONE 4: Florist
    'obj_florist_shop': {
        id: 'obj_florist_shop' as GameObjectId,
        name: 'Florist Shop',
        alternateNames: ['florist shop', 'florist', 'flower shop', 'shop', 'flower store', 'florist store'],
        archetype: 'Structure',
        description: 'A small flower shop with a colorful awning. Fresh bouquets line the windows.',
        transitionNarration: 'You move toward the florist shop. The bright colors and fresh flowers contrast sharply with the grim nature of your investigation.',
        capabilities: { openable: false, lockable: false, breakable: false, movable: false, powerable: false, container: false, readable: false, inputtable: false },
        state: { isOpen: false, isLocked: false, isBroken: false, isPoweredOn: false, currentStateId: 'default' },
        handlers: {
            onExamine: {
                message: 'The shop is bright and cheerful. Roses, lilies, and daisies fill the window display. A florist tends to the flowers inside.',
                media: undefined
            }
        },
        version: { schema: '1.0.0', content: '1.0.0' }
    },

    // ZONE 5: Kiosk - Parent Container
    'obj_kiosk_counter': {
        id: 'obj_kiosk_counter' as GameObjectId,
        name: 'Kiosk',
        alternateNames: ['kiosk', 'counter', 'kiosk counter', 'news stand', 'newsstand', 'vendor stand', 'vendor'],
        archetype: 'Furniture',
        description: 'A small street kiosk with a cluttered counter. The elderly vendor watches you from behind the counter.',
        transitionNarration: 'You approach the kiosk. The elderly vendor looks up from behind his counter cluttered with newspapers and snacks.',
        capabilities: { openable: false, lockable: false, breakable: false, movable: false, powerable: false, container: true, readable: false, inputtable: false },
        state: { isOpen: false, isLocked: false, isBroken: false, isPoweredOn: false, currentStateId: 'default' },
        children: {
            items: [],
            objects: ['obj_kiosk_drawer' as GameObjectId]
        },
        handlers: {
            onExamine: {
                message: 'The kiosk counter is cluttered with candy bars, lottery tickets, and today\'s newspapers. A cash register sits at one end. Behind the counter, you notice a small wooden drawer—the kind vendors use for receipts and small items.',
                media: {
                    url: '',
                    description: 'Street kiosk with cluttered counter and elderly vendor',
                    hint: 'kiosk counter'
                },
                effects: [
                    { type: 'REVEAL_FROM_PARENT', entityId: 'obj_kiosk_drawer', parentId: 'obj_kiosk_counter' }
                ]
            }
        },
        version: { schema: '1.0.0', content: '1.0.0' }
    },

    'obj_kiosk_drawer': {
        id: 'obj_kiosk_drawer' as GameObjectId,
        name: 'Drawer',
        archetype: 'Container',
        description: 'A small drawer behind the kiosk counter.',
        isRevealed: false,
        transitionNarration: 'You lean in closer to inspect the drawer behind the counter.',
        capabilities: { openable: true, lockable: false, breakable: false, movable: false, powerable: false, container: true, readable: false, inputtable: false },
        state: { isOpen: false, isLocked: false, isBroken: false, isPoweredOn: false, currentStateId: 'default' },
        inventory: { items: [], capacity: 5, allowTags: [], denyTags: [] },
        handlers: {
            onExamine: {
                message: 'A simple wooden drawer. The kiosk vendor keeps receipts and papers in here.',
                media: undefined
            },
            onOpen: {
                message: 'You pull open the drawer. It\'s mostly empty—just some old receipts and a rubber band.',
                media: undefined
            }
        },
        version: { schema: '1.0.0', content: '1.0.0' }
    },

    // ZONE 6: Side Alley - Main Parent Structure
    'obj_side_alley': {
        id: 'obj_side_alley' as GameObjectId,
        name: 'Side Alley',
        alternateNames: ['side alley', 'alley', 'dark alley', 'narrow alley', 'side street'],
        archetype: 'Structure',
        description: 'A narrow side alley branching off Elm Street. The smell of decay hangs in the air, and shadows obscure the details.',
        zone: 'zone_side_alley' as ZoneId,
        transitionNarration: 'You step into the side alley. The narrow passage is darker here, away from the street lights. Crates are stacked against one wall, and a rusted dumpster sits heavily in the shadows.',
        capabilities: { openable: false, lockable: false, breakable: false, movable: false, powerable: false, container: true, readable: false, inputtable: false },
        state: { isOpen: false, isLocked: false, isBroken: false, isPoweredOn: false, currentStateId: 'default' },
        children: {
            items: [],
            objects: ['obj_crates' as GameObjectId, 'obj_dumpster' as GameObjectId, 'obj_tire_stack' as GameObjectId, 'obj_tire_marks' as GameObjectId, 'obj_brick_walls' as GameObjectId, 'obj_courtyard_door' as GameObjectId]
        },
        handlers: {
            onExamine: {
                success: {
                    message: 'You step into the alley and the smell hits you first—rotting food, stale piss, something sweet and chemical you can\'t quite place. Your shoes stick slightly to the concrete.\n\nYou don\'t want to know what that is.\n\nThe alley is narrow, maybe eight feet across. Brick walls on both sides, stained black with decades of city grime and rain runoff.\n\nOld wooden crates are stacked haphazardly against the left wall, their labels long faded. On the right, a rusted dumpster sits like a sleeping giant, its green paint peeling in long strips. In the corner, a pile of old car tires leans against the wall. And on the ground—fresh tire marks pressed into the grime.\n\nThis is the kind of place people walk past without looking. The kind of place where deals go down, where evidence gets dumped, where someone could disappear and no one would ask questions.\n\nIf you were planning something terrible and needed a place where no one would look, this is exactly where you would circle on the map.\n\nYour gut tells you something is off. This alley is not just neglected—it is forgotten. And in your line of work, forgotten places have a habit of hiding secrets.\n\nYou see:\n📦 Wooden crates\n🗑️ Rusted dumpster\n🛞 Pile of old tires\n🚗 Tire marks on ground\n🧱 Brick walls',
                    media: {
                        url: '',
                        description: 'Dark narrow alley with crates and dumpster',
                        hint: 'side alley with crates'
                    },
                    effects: [
                        { type: 'REVEAL_FROM_PARENT', entityId: 'obj_crates', parentId: 'obj_side_alley' },
                        { type: 'REVEAL_FROM_PARENT', entityId: 'obj_dumpster', parentId: 'obj_side_alley' },
                        { type: 'REVEAL_FROM_PARENT', entityId: 'obj_tire_stack', parentId: 'obj_side_alley' },
                        { type: 'REVEAL_FROM_PARENT', entityId: 'obj_tire_marks', parentId: 'obj_side_alley' },
                        { type: 'REVEAL_FROM_PARENT', entityId: 'obj_brick_walls', parentId: 'obj_side_alley' }
                    ]
                }
            },
            onSearch: {
                message: 'You scan the alley carefully. The crates—ordinary shipping crates, nothing special. The dumpster—heavy, full of trash. But wait... there\'s something odd about how the dumpster is positioned. It\'s not quite flush against the wall. Like it was moved recently.',
                media: undefined
            }
        },
        version: { schema: '1.0.0', content: '1.0.0' }
    },

    'obj_crates': {
        id: 'obj_crates' as GameObjectId,
        name: 'Crates',
        alternateNames: ['crates', 'wooden crates', 'boxes', 'stacked crates', 'shipping crates', 'panel', 'hidden panel', 'lever', 'mechanism'],
        archetype: 'Container',
        description: 'Stacked wooden crates in the alley. They look abandoned.',
        zone: 'zone_side_alley' as ZoneId,
        isRevealed: false,
        transitionNarration: 'You move closer to the stacked crates, examining their weathered surfaces.',
        capabilities: { openable: false, lockable: false, breakable: false, movable: true, powerable: false, container: false, readable: false, inputtable: false },
        state: {
            isOpen: false,
            isLocked: false,
            isBroken: false,
            isPoweredOn: false,
            currentStateId: 'default',
            panelDiscovered: false,
            panelOpened: false,
            leverPulled: false
        },
        handlers: {
            onExamine: [
                {
                    // State 1: UNTOUCHED - Door not revealed yet
                    conditions: [
                        { type: 'OBJECT_IN_WORLD', objectId: 'obj_courtyard_door', inWorld: false }
                    ],
                    success: {
                        message: 'Old wooden crates stacked haphazardly. Some are marked with faded shipping labels—delivery companies from decades ago. The wood is splintered and warped from moisture and age.\n\nThey\'re stacked against the wall, heavy and solid. Too heavy to move by hand. You\'d need leverage—a crowbar, maybe—to shift them.',
                        media: {
                            url: '',
                            description: 'Weathered wooden crates',
                            hint: 'old shipping crates'
                        }
                    }
                },
                {
                    // State 2: REVEALED - Door revealed, crates moved
                    conditions: [],
                    success: {
                        message: 'The crates sit where you moved them, shifted several feet to the side. The hidden door behind them is now fully visible—old, rusted, with that keypad on the frame.',
                        media: undefined
                    }
                }
            ],
            onPeek: [
                {
                    // Panel not discovered yet
                    conditions: [
                        { type: 'OBJECT_STATE', objectId: 'obj_crates', statePath: 'panelDiscovered', value: false }
                    ],
                    success: {
                        message: 'You crouch down, peering around the sides of the crate stack. Looking for gaps. Spaces. Anything hidden.\n\nMost of the crates are flush against the wall. But on the right side, near the bottom, you spot something.\n\nA wooden panel. Smaller than the crates. Different wood grain. It\'s been fitted into the stack—deliberately placed, not part of the original crates.\n\nSomeone built this. Someone hid something here.',
                        media: undefined,
                        effects: [
                            { type: 'SET_ENTITY_STATE', entityId: 'obj_crates', key: 'panelDiscovered', value: true }
                        ]
                    }
                },
                {
                    // Panel discovered but not opened
                    conditions: [
                        { type: 'OBJECT_STATE', objectId: 'obj_crates', statePath: 'panelDiscovered', value: true },
                        { type: 'OBJECT_STATE', objectId: 'obj_crates', statePath: 'panelOpened', value: false }
                    ],
                    success: {
                        message: 'The hidden panel is still there, fitted into the right side of the crate stack. You can see the seams now—someone carefully cut and installed this panel.\n\nIt\'s not nailed shut. It looks like you could pry it open.',
                        media: undefined
                    }
                },
                {
                    // Panel opened
                    conditions: [],
                    success: {
                        message: 'The panel hangs open, revealing the mechanical lever inside. Old. Rusted. Functional.',
                        media: undefined
                    }
                }
            ],
            onKnock: [
                {
                    // Before panel discovered
                    conditions: [
                        { type: 'OBJECT_STATE', objectId: 'obj_crates', statePath: 'panelDiscovered', value: false }
                    ],
                    success: {
                        message: 'You knock on the crates. Solid wood. Thunk thunk thunk. Nothing unusual.',
                        media: undefined
                    }
                },
                {
                    // After panel discovered but not opened
                    conditions: [
                        { type: 'OBJECT_STATE', objectId: 'obj_crates', statePath: 'panelDiscovered', value: true },
                        { type: 'OBJECT_STATE', objectId: 'obj_crates', statePath: 'panelOpened', value: false }
                    ],
                    success: {
                        message: 'You tap your knuckles on the hidden panel. Different sound. Lighter. Hollow.\n\nThere\'s a space behind this panel. Something hidden inside.',
                        media: undefined
                    }
                },
                {
                    // Panel opened
                    conditions: [],
                    success: {
                        message: 'The panel is already open. No need to knock.',
                        media: undefined
                    }
                }
            ],
            onPry: [
                {
                    // Panel not discovered yet
                    conditions: [
                        { type: 'OBJECT_STATE', objectId: 'obj_crates', statePath: 'panelDiscovered', value: false }
                    ],
                    success: {
                        message: 'You try prying at the crate edges. They\'re solid, waterlogged, heavy. Nothing budges.\n\nMaybe look around the crates more carefully first.',
                        media: undefined
                    }
                },
                {
                    // Panel discovered, has crowbar
                    conditions: [
                        { type: 'OBJECT_STATE', objectId: 'obj_crates', statePath: 'panelDiscovered', value: true },
                        { type: 'OBJECT_STATE', objectId: 'obj_crates', statePath: 'panelOpened', value: false },
                        { type: 'HAS_ITEM', itemId: 'item_crowbar' }
                    ],
                    success: {
                        message: 'You wedge the crowbar tip into the seam of the hidden panel. Leverage. You pull.\n\nThe panel pops free with a crack of splintering wood. Behind it: a small cavity. And inside that cavity, a mechanical lever. Old. Rusted. But functional.\n\nSomeone installed this. Someone hid a lever mechanism inside the crate stack.\n\nWhat does it do?',
                        media: undefined,
                        effects: [
                            { type: 'SET_ENTITY_STATE', entityId: 'obj_crates', key: 'panelOpened', value: true }
                        ]
                    }
                },
                {
                    // Panel discovered, no crowbar
                    conditions: [
                        { type: 'OBJECT_STATE', objectId: 'obj_crates', statePath: 'panelDiscovered', value: true },
                        { type: 'OBJECT_STATE', objectId: 'obj_crates', statePath: 'panelOpened', value: false }
                    ],
                    success: {
                        message: 'You try to pry the panel open with your fingers. It won\'t budge. Fitted tight. Nailed or glued in place.\n\nYou\'d need a tool. Something to leverage it open.',
                        media: undefined
                    }
                },
                {
                    // Panel already opened
                    conditions: [],
                    success: {
                        message: 'The panel is already pried open. The lever mechanism is visible inside.',
                        media: undefined
                    }
                }
            ],
            onPull: [
                {
                    // Panel not opened yet
                    conditions: [
                        { type: 'OBJECT_STATE', objectId: 'obj_crates', statePath: 'panelOpened', value: false }
                    ],
                    success: {
                        message: 'Pull what? The crates are too heavy to move by hand. If you mean something else, you\'ll need to find it first.',
                        media: undefined
                    }
                },
                {
                    // Lever not pulled yet
                    conditions: [
                        { type: 'OBJECT_STATE', objectId: 'obj_crates', statePath: 'panelOpened', value: true },
                        { type: 'OBJECT_STATE', objectId: 'obj_crates', statePath: 'leverPulled', value: false }
                    ],
                    success: {
                        message: 'You grip the rusted lever. Cold metal. Rough with corrosion.\n\nYou pull.\n\nThe lever resists at first—decades of rust and disuse. Then it gives. Slowly. Smoothly. You hear a mechanical sound from inside the wall behind the crates. A series of clicks. Metal sliding against metal.\n\nSomething unlocked. Something disengaged.\n\nBut the crates haven\'t moved. The lever mechanism isn\'t for moving the crates—it\'s for something behind them.\n\nYou\'ll still need the crowbar to shift the crates themselves.',
                        media: undefined,
                        effects: [
                            { type: 'SET_ENTITY_STATE', entityId: 'obj_crates', key: 'leverPulled', value: true }
                        ]
                    }
                },
                {
                    // Lever already pulled
                    conditions: [],
                    success: {
                        message: 'You already pulled the lever. It won\'t move again—it\'s locked in the down position. Whatever it unlocked is done.',
                        media: undefined
                    }
                }
            ],
            onMove: [
                {
                    // State 1: UNTOUCHED - Trying without crowbar
                    conditions: [
                        { type: 'OBJECT_IN_WORLD', objectId: 'obj_courtyard_door', inWorld: false }
                    ],
                    success: {
                        message: 'You try to shove the crates aside. They don\'t budge. Too heavy. Decades of moisture have made the wood waterlogged, dense.\n\nYou need leverage. Something to pry them loose.',
                        media: undefined
                    }
                },
                {
                    // State 2: REVEALED - Already moved
                    conditions: [],
                    success: {
                        message: 'The crates are already moved. The door is visible behind them.',
                        media: undefined
                    }
                }
            ],
            onSearch: [
                {
                    // Panel not discovered yet
                    conditions: [
                        { type: 'OBJECT_STATE', objectId: 'obj_crates', statePath: 'panelDiscovered', value: false }
                    ],
                    success: {
                        message: 'You check between the crates, looking for anything hidden in the gaps. Mostly empty spaces, cobwebs, dust.\n\nWait. On the right side, near the bottom—is that a panel? Different wood. Fitted into the stack. Not part of the original crates.',
                        media: undefined,
                        effects: [
                            { type: 'SET_ENTITY_STATE', entityId: 'obj_crates', key: 'panelDiscovered', value: true }
                        ]
                    }
                },
                {
                    // Panel discovered
                    conditions: [],
                    success: {
                        message: 'You already found the hidden panel on the right side of the crate stack. It looks like you could pry it open if you had the right tool.',
                        media: undefined
                    }
                }
            ],
            onUse: [
                {
                    // Using crowbar on crates
                    conditions: [
                        { type: 'HAS_ITEM', itemId: 'item_crowbar' },
                        { type: 'OBJECT_IN_WORLD', objectId: 'obj_courtyard_door', inWorld: false }
                    ],
                    success: {
                        message: 'You wedge the crowbar between the wall and the crate stack. Leverage. Physics. You pull.\n\nThe crates groan, wood scraping against brick. You pull harder.\n\nThey shift. Inch by inch, the whole stack slides to the side.\n\nAnd there it is.\n\nBehind the crates, hidden for years: a metal door. Old, rusted, paint peeling. No handle, just a keypad mounted on the frame. Someone deliberately stacked those crates to hide this door.\n\nWhy?',
                        media: undefined,
                        effects: [
                            { type: 'REVEAL_FROM_PARENT', entityId: 'obj_courtyard_door', parentId: 'obj_side_alley' }
                        ]
                    }
                },
                {
                    // Already revealed door
                    conditions: [
                        { type: 'OBJECT_IN_WORLD', objectId: 'obj_courtyard_door', inWorld: true }
                    ],
                    success: {
                        message: 'The crates are already moved. The hidden door is visible behind them.',
                        media: undefined
                    }
                },
                {
                    // No crowbar
                    conditions: [],
                    success: {
                        message: 'You need something to pry these crates loose. They\'re too heavy to move by hand.',
                        media: undefined
                    }
                }
            ],
            onTake: {
                fail: {
                    message: 'These aren\'t your standard cardboard moving boxes. Each crate is solid wood—probably three or four feet on a side—heavy enough that lifting even one would strain your back. The whole stack? Hundreds of pounds, easy. You can\'t take them with you.',
                    media: undefined
                }
            },
            onOpen: {
                fail: {
                    message: 'The crates aren\'t containers you can open. They\'re solid wooden shipping crates—nailed shut decades ago, the wood warped and splintered from moisture. Even if you could pry one open, it would be empty inside. These crates are obstacles, not treasure chests.',
                    media: undefined
                }
            }
        },
        version: { schema: '1.0.0', content: '1.0.0' }
    },

    'obj_dumpster': {
        id: 'obj_dumpster' as GameObjectId,
        name: 'Dumpster',
        alternateNames: ['dumpster', 'trash bin', 'garbage bin', 'rusted dumpster', 'metal dumpster'],
        archetype: 'Container',
        description: 'A rusted industrial dumpster. Heavy steel corroded by time and neglect.',
        zone: 'zone_at_dumpster' as ZoneId,
        isRevealed: false,
        transitionNarration: 'You approach the rusted dumpster in the alley. The smell hits you before you even get close.',
        capabilities: { openable: true, lockable: false, breakable: false, movable: true, powerable: false, container: true, readable: false, inputtable: false },
        state: { isOpen: false, isLocked: false, isBroken: false, isPoweredOn: false, currentStateId: 'default' },
        inventory: { items: [], capacity: 10, allowTags: [], denyTags: [] },
        parentId: 'obj_side_alley' as GameObjectId,
        revealMethod: 'REVEAL_FROM_PARENT',
        children: {
            items: ['item_crumpled_note' as ItemId],
            objects: ['obj_old_suitcase' as GameObjectId, 'obj_paper_carton' as GameObjectId, 'obj_backpack' as GameObjectId]
        },
        handlers: {
            onExamine: [
                {
                    // State: Inside dumpster - examining from within
                    conditions: [
                        { type: 'FLAG', flag: 'dumpster_climbed', value: true }
                    ],
                    success: {
                        message: 'You\'re standing in it. Ankle-deep in rot.\n\nThe garbage is layered. Decades, maybe. Old trash compacted under newer trash, creating strata of decay. Newspapers yellowed and pulped. Food containers crushed flat. Plastic bags melted together from heat and time.\n\nThe smell is suffocating. Rot, yes, but also chemicals—bleach, ammonia, solvents. Someone used this dumpster to dispose of more than just garbage.\n\nThe metal walls around you are corroded from the inside. Rust eating through steel. Liquid waste pooling in the corners, dark and viscous.\n\nIf you want to find anything specific, you\'ll need to search through this mess. Get your hands dirty.',
                        media: undefined
                    }
                },
                {
                    // State: Lid open - examining interior (but player is outside)
                    conditions: [
                        { type: 'STATE', entityId: 'obj_dumpster', key: 'isOpen', equals: true }
                    ],
                    success: {
                        message: 'The lid is up. Flies swarm around the opening, a black cloud of buzzing wings.\n\nFrom here, you can see the top layer of garbage—backpacks, food containers, newspapers soaked in unidentifiable liquid. The smell hits you in waves: rot, mildew, something chemical underneath.\n\nBut you\'re still outside. Looking down into the darkness. You can\'t see the bottom, can\'t see what\'s hidden beneath the surface garbage.\n\nIf you want to find anything, you\'ll need to get in there. Search properly.',
                        media: undefined
                    }
                },
                {
                    // State: Lid closed, door still hidden
                    conditions: [
                        { type: 'OBJECT_IN_WORLD', objectId: 'obj_courtyard_door', inWorld: false }
                    ],
                    success: {
                        message: 'A dumpster. Industrial size. Heavy-gauge steel painted dark green—or it was, once, back when the city still cared about appearances. Now it\'s rust-brown, corroded, eaten away by years of exposure and neglect. The metal is pitted with holes where rust chewed through, weeping orange stains down the sides like old blood.\n\nThe smell hits you before you even get close. Rot. Decay. That sweet-sour stench of organic matter breaking down in the summer heat. Your throat tightens. Your stomach clenches. This is what Bloodhaven smells like now—garbage left to fester while everyone looks the other way.\n\nThe lid is closed. Heavy metal, sagging on its hinges from decades of weight. Someone welded reinforcement bars across the back—crude, functional, the kind of patch job you see everywhere in this city. Everything breaking down. Everything held together with duct tape and prayers.\n\nLike your career. Like your reputation. Like the case they\'re building against you.\n\nThe dumpster sits oddly. Not quite flush against the brick wall. A gap, maybe six inches. Shadows in that gap. Darkness. The kind of space where things get hidden. Where evidence disappears.\n\nWhere your life might be buried.',
                        media: {
                            url: '',
                            description: 'Rusted dumpster not flush against wall',
                            hint: 'dumpster hiding something'
                        }
                    }
                },
                {
                    // State: Door revealed after moving
                    conditions: [
                        { type: 'OBJECT_IN_WORLD', objectId: 'obj_courtyard_door', inWorld: true }
                    ],
                    success: {
                        message: 'The dumpster sits where you pushed it, several feet from the wall. The old door behind it is now fully visible—rusted metal, peeling paint, locked tight.',
                        media: {
                            url: '',
                            description: 'Dumpster moved aside, door revealed',
                            hint: 'hidden door exposed'
                        }
                    }
                }
            ],
            onOpen: [
                {
                    conditions: [
                        { type: 'STATE', entityId: 'obj_dumpster', key: 'isOpen', equals: true }
                    ],
                    success: {
                        message: 'The lid\'s already up. Flies buzz around the opening. The smell hasn\'t improved.',
                        media: undefined
                    }
                },
                {
                    conditions: [],
                    success: {
                        message: 'You lift the heavy lid. The stench hits you immediately—rotting food and something worse. Black backpacks, food containers, newspapers.\n\nMostly garbage.',
                        media: undefined,
                        effects: [
                            { type: 'SET_ENTITY_STATE', entityId: 'obj_dumpster', patch: { isOpen: true } }
                        ]
                    }
                }
            ],
            onSmell: {
                success: {
                    message: 'You lean closer and inhale—carefully, through your mouth, because you\'re not an idiot.\n\nBut even filtered through shallow breaths, the smell hits you like a slap. Rot, yes. Decomposing food, mildew, decay—all the usual garbage perfume.\n\nBut underneath it? Something sharper. Chemical. Astringent.\n\nChlorine. Or maybe ammonia. The kind of harsh, industrial-strength smell you get from cleaning supplies. Bleach, maybe.\n\nWrong. Very wrong. Nobody throws cleaning chemicals in a dumpster like this. Not unless they were scrubbing something clean. Something they didn\'t want found.',
                    media: undefined
                }
            },
            onClose: [
                {
                    conditions: [
                        { type: 'STATE', entityId: 'obj_dumpster', key: 'isOpen', equals: false }
                    ],
                    success: {
                        message: 'The lid\'s already down. Heavy metal, sealed tight. The smell is contained—for now.',
                        media: undefined
                    }
                },
                {
                    conditions: [],
                    success: {
                        message: 'You grip the lid and lower it down. The hinges groan, protesting under the weight. The heavy metal lid settles into place with a dull thud.\n\nThe smell—rot, chemicals, decay—is mercifully contained. Your lungs thank you. Your sinuses thank you. Every person within fifty feet thanks you.\n\nBut smart? For the case?\n\nMaybe not. Evidence doesn\'t get less rotten if you ignore it. It just gets harder to find.',
                        media: undefined,
                        effects: [
                            { type: 'SET_ENTITY_STATE', entityId: 'obj_dumpster', patch: { isOpen: false } }
                        ]
                    }
                }
            ],
            onClimb: [
                {
                    conditions: [
                        { type: 'STATE', entityId: 'obj_dumpster', key: 'isOpen', equals: false }
                    ],
                    success: {
                        message: 'You reach for the rim of the dumpster, ready to haul yourself over—\n\n—but the lid\'s down. Heavy metal, latched tight.\n\nYou\'re athletic, sure, but you\'re not vaulting over a closed dumpster lid. Not without looking like an idiot, anyway.\n\nIt seems the dumpster\'s lid is closed. Maybe crack it open first.',
                        media: undefined
                    }
                },
                {
                    conditions: [
                        { type: 'FLAG', flag: 'dumpster_climbed', value: true }
                    ],
                    success: {
                        message: 'You\'ve already taken the plunge—literally. Once was enough. The bags are still there, waiting. You don\'t need to climb back in.',
                        media: undefined
                    }
                },
                {
                    conditions: [],
                    success: {
                        message: 'You grip the rim and haul yourself up. One leg over. Then the other.\n\nYou drop inside.\n\nThe smell is worse in here. Oppressive. Flies scatter as you land, your shoes sinking into something soft and wet. You don\'t look down.\n\nYou\'re standing in trash now. Ankle-deep in garbage, flies buzzing around your head. The metal walls of the dumpster rise on all sides, trapping you in this confined space of rot and decay.\n\nIf you want to find something, you should search through the contents.',
                        media: undefined,
                        effects: [
                            { type: 'SET_FLAG', flag: 'dumpster_climbed', value: true },
                            { type: 'SET_ZONE', zoneId: 'zone_inside_dumpster' as ZoneId }
                        ]
                    }
                }
            ],
            onSearch: [
                {
                    conditions: [
                        { type: 'STATE', entityId: 'obj_dumpster', key: 'isOpen', equals: false }
                    ],
                    success: {
                        message: 'You lean over the edge of the dumpster, peering at the closed lid.\n\nNothing to see here. Just rusted metal and the faint reek of garbage seeping through the seams.\n\nIt seems the dumpster\'s lid is shut tight. You could try opening it, or maybe climbing in if you\'re feeling bold.',
                        media: undefined
                    }
                },
                {
                    conditions: [
                        { type: 'FLAG', flag: 'dumpster_searched', value: true }
                    ],
                    success: {
                        message: 'You already sorted through the garbage. Three bags. You know what\'s here.',
                        media: undefined
                    }
                },
                {
                    conditions: [
                        { type: 'FLAG', flag: 'dumpster_climbed', value: false }
                    ],
                    success: {
                        message: 'You lean over the open dumpster, scanning the contents from above.\n\nBlack bags. Flies. Rot.\n\nBut from up here, you can\'t see much detail. The shadows inside are too deep, the smell too overwhelming to linger.\n\nYou can\'t search a dumpster from the outside. Not properly. If you want to find something, you\'ll need to get in there. Climb in.',
                        media: undefined
                    }
                },
                {
                    conditions: [
                        { type: 'FLAG', flag: 'dumpster_climbed', value: true }
                    ],
                    success: {
                        message: 'You\'re inside now. Might as well do this properly.\n\nYou start digging through the trash, pushing aside wet cardboard and food containers. The smell is overwhelming—rot and chemicals mixing into something toxic.\n\nBut beneath the surface garbage, you find something.\n\nYou find the following:\n\n💼 Old Suitcase\n📦 Paper Carton\n🎒 Backpack',
                        media: undefined,
                        effects: [
                            { type: 'SET_FLAG', flag: 'dumpster_searched', value: true },
                            { type: 'REVEAL_FROM_PARENT', entityId: 'obj_old_suitcase', parentId: 'obj_dumpster' },
                            { type: 'REVEAL_FROM_PARENT', entityId: 'obj_paper_carton', parentId: 'obj_dumpster' },
                            { type: 'REVEAL_FROM_PARENT', entityId: 'obj_backpack', parentId: 'obj_dumpster' }
                        ]
                    }
                }
            ],
            onMove: {
                success: {
                    message: 'You grip the dumpster\'s edge and push. It\'s heavy—really heavy—full of trash and years of rust. The metal scrapes against concrete, a harsh grinding sound echoing in the alley.\n\nYou push harder. Inch by inch, it slides away from the wall.\n\nAnd there it is. Behind the dumpster, hidden for who knows how long: an old metal door. Rusted, peeling paint, no handle—just a keyhole. Someone wanted this door hidden.\n\nWhy?',
                    media: {
                        url: '',
                        description: 'Dumpster moved aside revealing hidden door',
                        hint: 'secret door revealed'
                    },
                    effects: [
                        { type: 'REVEAL_FROM_PARENT', entityId: 'obj_courtyard_door', parentId: 'obj_side_alley' }
                    ]
                }
            },
            onTake: {
                fail: {
                    message: 'The dumpster is a massive metal container, probably weighing several hundred pounds even when empty. Full of trash like it is now? Half a ton, easy. You can\'t take it with you. You can MOVE it, OPEN it, or SEARCH through it, but you can\'t carry it away.',
                    media: undefined
                }
            },
            onUse: {
                fail: {
                    message: 'A dumpster isn\'t a tool. It\'s a container for waste. You can OPEN it, SEARCH it, or MOVE it if you need to shift it aside, but you can\'t use it.',
                    media: undefined
                }
            }
        },
        version: { schema: '1.0.0', content: '1.0.0' }
    },

    'obj_old_suitcase': {
        id: 'obj_old_suitcase' as GameObjectId,
        name: 'Old Suitcase',
        alternateNames: ['old suitcase', 'suitcase', 'suit case', 'case', 'luggage', 'old case', 'leather suitcase'],
        archetype: 'Container',
        description: 'A battered leather suitcase, decades old. Scuffed corners, tarnished brass latches. The leather is cracked and water-stained.',
        transitionNarration: 'You focus on the old suitcase. It looks like it\'s been here a while.',
        capabilities: { openable: true, lockable: true, breakable: false, movable: false, powerable: false, container: true, readable: false, inputtable: false },
        state: { isOpen: false, isLocked: true, isBroken: false, isPoweredOn: false, currentStateId: 'default' },
        inventory: { items: [], capacity: 5, allowTags: [], denyTags: [] },
        requirements: {
            options: [
                { attributes: { unlocking: 1 } },
                { attributes: { prying: 4 } }
            ]
        },
        parentId: 'obj_dumpster' as GameObjectId,
        revealMethod: 'REVEAL_FROM_PARENT',
        personal: false,
        children: {
            items: ['item_picture_frame' as ItemId, 'item_candle' as ItemId, 'item_box_cutter' as ItemId],
            objects: []
        },
        handlers: {
            onExamine: [
                {
                    conditions: [
                        { type: 'STATE', entityId: 'obj_old_suitcase', key: 'isOpen', equals: true }
                    ],
                    success: {
                        message: 'The old suitcase lies open, latches released. The interior is lined with faded silk, torn in places, stained dark in others.\n\nVarious items are packed inside.',
                        media: undefined
                    }
                },
                {
                    conditions: [
                        { type: 'STATE', entityId: 'obj_old_suitcase', key: 'isLocked', equals: true }
                    ],
                    success: {
                        message: 'A battered leather suitcase, the kind people used before wheeled luggage became standard. The leather is dark brown, cracked along the seams, water-stained in uneven patches that suggest years of exposure.\n\nThe corners are scuffed down to bare wood underneath—old-school construction, wood frame covered in leather. The brass latches are tarnished green, corroded but still intact.\n\nBetween the two latches, there\'s a small keyhole. A lock mechanism. The suitcase is locked.\n\nIt\'s heavy. Feels solid. Not empty.\n\nBut here\'s what strikes you: it\'s too clean. Everything else in this dumpster is rotting, covered in grime and decay. This suitcase? Dirty, yes, but not decomposing. Not like it\'s been here long.',
                        media: undefined
                    }
                },
                {
                    conditions: [],
                    success: {
                        message: 'A battered leather suitcase, the kind people used before wheeled luggage became standard. The leather is dark brown, cracked along the seams, water-stained in uneven patches that suggest years of exposure.\n\nThe corners are scuffed down to bare wood underneath—old-school construction, wood frame covered in leather. The brass latches are tarnished green, corroded but still intact.\n\nIt\'s heavy. Feels solid. Not empty.\n\nBut here\'s what strikes you: it\'s too clean. Everything else in this dumpster is rotting, covered in grime and decay. This suitcase? Dirty, yes, but not decomposing. Not like it\'s been here long.',
                        media: undefined
                    }
                }
            ],
            onOpen: [
                {
                    conditions: [
                        { type: 'STATE', entityId: 'obj_old_suitcase', key: 'isOpen', equals: true }
                    ],
                    success: {
                        message: 'Already open. The latches are released, the lid lifted. You can see the home decor items packed inside.',
                        media: undefined
                    }
                },
                {
                    conditions: [
                        { type: 'STATE', entityId: 'obj_old_suitcase', key: 'isLocked', equals: true }
                    ],
                    success: {
                        message: 'You press the brass latches, expecting them to click open.\n\nThey don\'t.\n\nYou press harder. Your thumbs dig into the tarnished metal, applying real pressure now, the kind that leaves dents in your skin.\n\nNothing. The latches are locked tight.\n\nYou pull at the lid anyway—because hope springs eternal, even when you\'re standing knee-deep in garbage—but the suitcase holds firm. The old leather creaks in protest, but the lock mechanism? Silent. Confident. Unmoved by your desperation.\n\nYou lean closer. Between the two latches, there\'s a small keyhole. Delicate. Precise. The kind that takes a tiny key—jewelry box size, luggage lock size. Something small enough to hide, easy enough to lose.\n\nOr easy enough to hide deliberately.\n\nThis suitcase isn\'t opening without that key.',
                        media: undefined
                    }
                },
                {
                    conditions: [],
                    success: {
                        message: 'You grip the tarnished brass latches and press the releases. They click open with surprising ease—no rust, no resistance.\n\nYou lift the lid.\n\nThe interior is lined with faded silk, torn in places, stained dark in others. You can see various items packed inside.',
                        media: undefined,
                        effects: [
                            { type: 'SET_ENTITY_STATE', entityId: 'obj_old_suitcase', patch: { isOpen: true } }
                        ]
                    }
                }
            ],
            onSearch: [
                {
                    conditions: [
                        { type: 'STATE', entityId: 'obj_old_suitcase', key: 'isOpen', equals: false }
                    ],
                    success: {
                        message: 'You run your fingers along the exterior, checking the seams, the corners, the underside.\n\nNothing hidden on the outside.',
                        media: undefined
                    }
                },
                {
                    conditions: [
                        { type: 'NO_FLAG', flag: 'suitcase_searched' }
                    ],
                    success: {
                        message: 'You search through the contents, checking each item:\n\n🖼️ Empty picture frame\n🕯️ Decorative candle (unused)\n🔪 Box cutter (orange handle)\n\nHome decor junk, mostly. But the box cutter—that could be useful.',
                        media: undefined,
                        effects: [
                            { type: 'REVEAL_FROM_PARENT', entityId: 'item_picture_frame', parentId: 'obj_old_suitcase' },
                            { type: 'REVEAL_FROM_PARENT', entityId: 'item_candle', parentId: 'obj_old_suitcase' },
                            { type: 'REVEAL_FROM_PARENT', entityId: 'item_box_cutter', parentId: 'obj_old_suitcase' },
                            { type: 'SET_FLAG', flag: 'suitcase_searched', value: true }
                        ]
                    }
                },
                {
                    conditions: [],
                    success: {
                        message: 'You already searched through everything. Just the picture frame, candle, and box cutter.',
                        media: undefined
                    }
                }
            ],
            onTake: {
                fail: {
                    message: 'The suitcase is too large and awkward to carry while you\'re standing inside a dumpster surrounded by trash. If you needed it, you\'d have to climb out first.\n\nBut honestly? It\'s empty. Cleaned. No use taking it.',
                    media: undefined
                }
            },
            onUse: [
                {
                    itemId: 'item_tiny_silver_key',
                    conditions: [
                        { type: 'STATE', entityId: 'obj_old_suitcase', key: 'isLocked', equals: false }
                    ],
                    success: {
                        message: 'The suitcase is already unlocked. No need for the key now.',
                        media: undefined
                    }
                },
                {
                    itemId: 'item_tiny_silver_key',
                    conditions: [],
                    success: {
                        message: 'You pull out the tiny silver key and slide it into the small keyhole between the latches.\n\nIt fits perfectly.\n\nYou turn it. The mechanism clicks—smooth, precise, well-maintained. The lock releases.\n\nThe latches are free now. You can open the suitcase.',
                        media: undefined,
                        effects: [
                            { type: 'SET_ENTITY_STATE', entityId: 'obj_old_suitcase', patch: { isLocked: false } }
                        ]
                    }
                }
            ]
        },
        version: { schema: '1.0.0', content: '1.0.0' }
    },

    'obj_paper_carton': {
        id: 'obj_paper_carton' as GameObjectId,
        name: 'Paper Carton',
        alternateNames: ['paper carton', 'carton', 'cardboard box', 'box', 'paper box'],
        archetype: 'Container',
        description: 'A large paper carton, soggy and partially collapsed. The kind used for moving or storage.',
        transitionNarration: 'You turn your attention to the soggy paper carton.',
        capabilities: { openable: true, lockable: false, breakable: true, movable: false, powerable: false, container: true, readable: false, inputtable: false },
        state: { isOpen: false, isLocked: false, isBroken: false, isPoweredOn: false, currentStateId: 'default' },
        inventory: { items: [], capacity: 10, allowTags: [], denyTags: [] },
        parentId: 'obj_dumpster' as GameObjectId,
        revealMethod: 'REVEAL_FROM_PARENT',
        personal: false,
        children: {
            items: [],
            objects: []
        },
        handlers: {
            onExamine: [
                {
                    conditions: [
                        { type: 'STATE', entityId: 'obj_paper_carton', key: 'isOpen', equals: true }
                    ],
                    success: {
                        message: 'The carton is open, flaps pulled apart. The cardboard is water-damaged, soft and weak.\n\nInside: shredded paper. Lots of it. White strips, densely packed. The kind of shredding you get from a cross-cut paper shredder—small confetti pieces, meant to be unreadable.\n\nSomeone didn\'t want these documents read.',
                        media: undefined
                    }
                },
                {
                    conditions: [],
                    success: {
                        message: 'A brown paper carton, the kind you get from moving companies or office supply stores. Standard issue.\n\nThe cardboard is dark with moisture, sagging in the middle, partially collapsed. The flaps are sealed with packing tape—thick, industrial-grade, wrapped multiple times around the seams.\n\nWhite strips of paper poke out from gaps where the cardboard has split.',
                        media: undefined
                    }
                }
            ],
            onOpen: {
                success: {
                    message: 'You reach for the flaps, ready to pull them apart like any ordinary box.\n\nBut your fingers meet resistance. Packing tape—thick, industrial-grade stuff, the kind movers use when they\'re paranoid about boxes bursting mid-transport. Someone wrapped this carton like they were sealing a tomb.\n\nYou tug. The cardboard underneath is soggy, weak, practically disintegrating under your grip. But the tape? The tape laughs at you. It stretches. It strains. It holds.\n\nYou pull harder. The wet cardboard starts to tear—long splits opening in the brown paper, the structural integrity collapsing. But the tape just digs deeper into the pulp, anchoring itself like roots in rot.\n\nYou stop. This whole thing\'s going to burst like a wet piñata.\n\nNo. This needs precision. A clean cut. Something sharp.',
                    media: undefined
                }
            },
            onBreak: {
                success: {
                    message: 'You consider brute force. Just rip the whole thing apart. Tear through cardboard and tape like some kind of rage-fueled garbage archaeologist.\n\nBut the cardboard\'s waterlogged. Soft. Weak. One good yank and it\'ll disintegrate into pulp, and the shredded paper inside will explode outward like confetti at the world\'s saddest parade. It\'ll mix with the trash, the rot, the dumpster sludge. Whatever\'s in there—evidence, clues, answers—will be contaminated. Unreadable. Lost.\n\nNo. You need surgical precision here. Cut the tape. Open it clean.',
                    media: undefined
                }
            },
            onUse: [
                {
                    itemId: 'item_box_cutter',
                    conditions: [
                        { type: 'STATE', entityId: 'obj_paper_carton', key: 'isOpen', equals: true }
                    ],
                    success: {
                        message: 'The carton is already open. The tape has been cut away. No need for tools now.',
                        media: undefined
                    }
                },
                {
                    itemId: 'item_box_cutter',
                    conditions: [],
                    success: {
                        message: 'You pull out the box cutter and extend the blade. Sharp. Clean. Ready.\n\nYou press the blade against the packing tape and draw it along the seam. The tape parts cleanly—a surgical cut. No tearing, no mess.\n\nYou slice through the remaining layers. Three passes. Four. The tape falls away in strips.\n\nThe flaps are free now.',
                        media: undefined,
                        effects: [
                            { type: 'SET_ENTITY_STATE', entityId: 'obj_paper_carton', patch: { isOpen: true } }
                        ]
                    }
                },
                {
                    conditions: [],
                    fail: {
                        message: 'You need something sharp to cut through the packing tape. A box cutter or knife would work.',
                        media: undefined
                    }
                }
            ],
            onSearch: [
                {
                    conditions: [
                        { type: 'STATE', entityId: 'obj_paper_carton', key: 'isOpen', equals: false }
                    ],
                    success: {
                        message: 'You check the exterior, running your hands over the soggy cardboard. Nothing written on the outside. No labels, no markings.',
                        media: undefined
                    }
                },
                {
                    conditions: [],
                    success: {
                        message: 'You dig your hands into the shredded paper, sifting through the strips. It\'s slow work—the paper is wet, clumped together in dense, pulpy masses.\n\nMost of it is too shredded to read. Tiny fragments. Cross-cut confetti. Single letters. Bits of words.\n\nYou spend several minutes sorting through it, checking every piece.\n\nNothing. Nothing readable. Nothing useful.\n\nWhoever shredded these documents was thorough.',
                        media: undefined
                    }
                }
            ],
            onTake: {
                fail: {
                    message: 'The carton is waterlogged and falling apart. If you tried to lift it, the bottom would tear out and shredded paper would spill everywhere.\n\nNot worth taking. But you could search through it here.',
                    media: undefined
                }
            }
        },
        version: { schema: '1.0.0', content: '1.0.0' }
    },

    'obj_backpack': {
        id: 'obj_backpack' as GameObjectId,
        name: 'Backpack',
        alternateNames: ['backpack', 'back pack', 'bag', 'black backpack', 'torn backpack', 'damaged backpack'],
        archetype: 'Container',
        description: 'A black canvas backpack with a broken zipper. Canvas torn in places. Something bulky stuffed inside.',
        isRevealed: false,
        transitionNarration: 'You focus on the damaged backpack.',
        capabilities: { openable: false, lockable: false, breakable: true, movable: false, powerable: false, container: true, readable: false, inputtable: false },
        state: { isOpen: false, isLocked: false, isBroken: false, isPoweredOn: false, currentStateId: 'default' },
        inventory: { items: [], capacity: 5, allowTags: [], denyTags: [] },
        parentId: 'obj_dumpster' as GameObjectId,
        revealMethod: 'REVEAL_FROM_PARENT',
        personal: false,
        children: {
            items: [],
            objects: ['obj_pants' as GameObjectId, 'obj_shoes' as GameObjectId, 'obj_coat' as GameObjectId]
        },
        handlers: {
            onExamine: [
                {
                    conditions: [
                        { type: 'STATE', entityId: 'obj_backpack', key: 'isOpen', equals: true }
                    ],
                    success: {
                        message: 'The backpack lies torn open, canvas ripped apart at the seams. The zipper—already broken—dangles uselessly from one side.\n\nThe chemical smell—bleach—hangs in the air, acrid and harsh. Inside: clothes. Pants, shoes, a coat—all soaked in bleach.',
                        media: undefined
                    }
                },
                {
                    conditions: [],
                    success: {
                        message: 'A black canvas backpack, the kind students or commuters use. Standard issue. Nothing special about it—except it\'s been through hell.\n\nThe zipper is broken. Not stuck—broken. The slider is bent at an angle, teeth separated, the metal warped like someone forced it past its limit and it gave up entirely.\n\nThe canvas is torn in several places—long rips along the seams, frayed edges where the fabric has been stressed beyond its capacity. Water damage has stiffened the material.\n\nBut it\'s bulging. Packed full. You can see the outline of something bundled inside—fabric, clothes maybe. And there\'s a smell. Faint, chemical. Sharp. Bleach.',
                        media: undefined
                    }
                }
            ],
            onOpen: [
                {
                    conditions: [
                        { type: 'STATE', entityId: 'obj_backpack', key: 'isOpen', equals: true }
                    ],
                    success: {
                        message: 'The backpack is already torn open, canvas ripped apart at the seams. The contents are exposed—you can see the bleach-soaked clothes inside.\n\nNo need to open it again. It\'s accessible.',
                        media: undefined
                    }
                },
                {
                    conditions: [],
                    fail: {
                        message: 'You reach for the zipper out of instinct.\n\nIt doesn\'t budge. The metal slider is bent, warped, teeth separated. Someone forced this thing and broke it—deliberately or in desperation, you can\'t tell.\n\nThe zipper\'s not opening. Not now, not ever. If you want to see what\'s inside, you\'ll need to tear the bag open.',
                        media: undefined
                    }
                }
            ],
            onBreak: [
                {
                    conditions: [
                        { type: 'STATE', entityId: 'obj_backpack', key: 'isOpen', equals: true }
                    ],
                    success: {
                        message: 'Already torn open. The canvas is ripped apart, the broken zipper hanging loose. Bleach-soaked clothes visible inside.',
                        media: undefined
                    }
                },
                {
                    conditions: [],
                    success: {
                        message: 'You grip the torn canvas with both hands, fingers digging into the frayed edges.\n\nYou pull. Hard.\n\nThe fabric resists for a moment—water damage has made it stiff, stubborn—but then it gives. The tear widens with a harsh ripping sound, canvas splitting along the seams.\n\nYou don\'t stop. You drive your hands into the opening and tear it wider, feeling the fabric give way under your grip. The backpack splits open like a wound.\n\nThe chemical smell hits you immediately—bleach, harsh and acrid. Strong enough to make your eyes water, your throat burn.\n\nThe backpack is open. Whatever\'s inside, you can reach it now.',
                        media: undefined,
                        effects: [
                            { type: 'SET_ENTITY_STATE', entityId: 'obj_backpack', patch: { isOpen: true } }
                        ]
                    }
                }
            ],
            onSearch: [
                {
                    conditions: [
                        { type: 'STATE', entityId: 'obj_backpack', key: 'isOpen', equals: false }
                    ],
                    success: {
                        message: 'You press on the damaged backpack, feeling the contents shift through the torn canvas. Heavy. Solid. Fabric, maybe? Hard to tell without opening it first.',
                        media: undefined
                    }
                },
                {
                    conditions: [],
                    success: {
                        message: 'You search through the bleach-soaked contents, pulling them out one by one:\n\n👖 A pair of pants\n👞 A pair of shoes\n🧥 A coat\n\nAll soaked in bleach. All deliberately hidden in this backpack.',
                        media: undefined,
                        effects: [
                            { type: 'REVEAL_FROM_PARENT', entityId: 'obj_pants', parentId: 'obj_backpack' },
                            { type: 'REVEAL_FROM_PARENT', entityId: 'obj_shoes', parentId: 'obj_backpack' },
                            { type: 'REVEAL_FROM_PARENT', entityId: 'obj_coat', parentId: 'obj_backpack' }
                        ]
                    }
                }
            ],
            onTake: {
                fail: {
                    message: 'The backpack is soaked with bleach and torn apart. If you tried to lift it, the whole thing would fall apart and chemical-soaked clothes would spill everywhere.\n\nYou\'re standing in a dumpster. Not exactly equipped for evidence collection. But you could search through it here.',
                    media: undefined
                }
            }
        },
        version: { schema: '1.0.0', content: '1.0.0' }
    },

    'obj_pants': {
        id: 'obj_pants' as GameObjectId,
        name: 'Pants',
        alternateNames: ['pants', 'trousers', 'slacks', 'pair of pants', 'dress pants', 'dark pants'],
        archetype: 'Container',
        description: 'A pair of dark dress pants, soaked in bleach. The fabric is stiff and discolored.',
        transitionNarration: 'You examine the bleach-soaked pants.',
        capabilities: { openable: false, lockable: false, breakable: false, movable: false, powerable: false, container: true, readable: false, inputtable: false },
        state: { isOpen: false, isLocked: false, isBroken: false, isPoweredOn: false, currentStateId: 'default' },
        inventory: { items: [], capacity: 3, allowTags: [], denyTags: [] },
        parentId: 'obj_backpack' as GameObjectId,
        revealMethod: 'REVEAL_FROM_PARENT',
        personal: false,
        children: {
            items: [],
            objects: []
        },
        handlers: {
            onExamine: {
                success: {
                    message: 'Dark dress pants. Men\'s, size 34 waist. The fabric—once black or navy—is now mottled gray and white from bleach damage.\n\nThe material is stiff, chemical-soaked. The seams are intact, but the color is destroyed. Whatever these pants looked like originally, they\'re ruined now.\n\nTwo front pockets. Two back pockets. Belt loops.',
                    media: undefined
                }
            },
            onSearch: {
                success: {
                    message: 'You check the pockets methodically:\n\nFront left: Three quarters. Two dimes.\nFront right: A stick of chewing gum, wrapper torn.\nBack left: Empty.\nBack right: A lint ball.\n\nNothing useful. Just pocket debris. Whoever dumped these pants emptied them first—or almost did.',
                    media: undefined
                }
            },
            onTake: {
                fail: {
                    message: 'The pants are soaked with bleach and smell terrible. You\'re not taking those with you. If there\'s something in the pockets, you can search them here.',
                    media: undefined
                }
            }
        },
        version: { schema: '1.0.0', content: '1.0.0' }
    },

    'obj_shoes': {
        id: 'obj_shoes' as GameObjectId,
        name: 'Shoes',
        alternateNames: ['shoes', 'pair of shoes', 'dress shoes', 'leather shoes', 'black shoes'],
        archetype: 'Container',
        description: 'A pair of leather dress shoes, scuffed and worn. Size 11½.',
        transitionNarration: 'You examine the shoes.',
        capabilities: { openable: false, lockable: false, breakable: false, movable: false, powerable: false, container: true, readable: false, inputtable: false },
        state: { isOpen: false, isLocked: false, isBroken: false, isPoweredOn: false, currentStateId: 'default' },
        inventory: { items: [], capacity: 2, allowTags: [], denyTags: [] },
        parentId: 'obj_backpack' as GameObjectId,
        revealMethod: 'REVEAL_FROM_PARENT',
        personal: false,
        children: {
            items: [],
            objects: []
        },
        handlers: {
            onExamine: {
                success: {
                    message: 'Black leather dress shoes. Oxford style. Size 11½.\n\nThe leather is scuffed, worn at the heels. The soles are thin—worn down from walking. These shoes have miles on them.\n\nAnd the smell—god, the smell. Sweat. Mildew. Rot. Like they were worn hard, then thrown in the trash without being cleaned.\n\nThe laces are still tied. Whoever took these off didn\'t bother to unlace them. Just kicked them off and tossed them.',
                    media: undefined
                }
            },
            onSearch: {
                success: {
                    message: 'You check inside both shoes, running your fingers along the insoles, checking for hidden compartments or items.\n\nNothing.\n\nJust worn leather, sweat stains, and that terrible smell. If there was anything hidden here, it\'s long gone.',
                    media: undefined
                }
            },
            onTake: {
                fail: {
                    message: 'The shoes smell awful—sweat and mildew mixed with the bleach from the bag. You\'re not taking those with you. Leave them in the dumpster where they belong.',
                    media: undefined
                }
            }
        },
        version: { schema: '1.0.0', content: '1.0.0' }
    },

    'obj_coat': {
        id: 'obj_coat' as GameObjectId,
        name: 'Coat',
        alternateNames: ['coat', 'jacket', 'suit jacket', 'blazer', 'suit coat'],
        archetype: 'Container',
        description: 'A dark suit jacket, stained and soaked in bleach. The fabric is damaged, but still recognizable.',
        transitionNarration: 'You examine the bleach-damaged coat.',
        capabilities: { openable: false, lockable: false, breakable: false, movable: false, powerable: false, container: true, readable: false, inputtable: false },
        state: { isOpen: false, isLocked: false, isBroken: false, isPoweredOn: false, currentStateId: 'default' },
        inventory: { items: [], capacity: 3, allowTags: [], denyTags: [] },
        parentId: 'obj_backpack' as GameObjectId,
        revealMethod: 'REVEAL_FROM_PARENT',
        personal: false,
        children: {
            items: [],
            objects: ['obj_pocket' as GameObjectId]
        },
        handlers: {
            onExamine: {
                success: {
                    message: 'A suit jacket. Dark fabric—navy or black, hard to tell now that the bleach has discolored it. The shoulders are structured, the cut is tailored. Expensive, once.\n\nNow? Ruined. The fabric is stiff with chemical damage. Dark stains—blood? oil?—still visible despite the bleach treatment. Whatever these stains were, someone wanted them gone badly enough to destroy the entire jacket.\n\nYou can see the lining through the torn fabric.',
                    media: undefined
                }
            },
            onSearch: [
                {
                    conditions: [
                        { type: 'NO_FLAG', flag: 'coat_searched' }
                    ],
                    success: {
                        message: 'You run your hands over the coat, checking methodically.\n\nThe fabric is stiff from bleach, chemical-damaged. The shoulders are structured, tailored. Quality construction, once.\n\nYou check the lining—and there. Hidden inside. A concealed pocket.\n\nSomeone went to effort to hide this.',
                        media: undefined,
                        effects: [
                            { type: 'REVEAL_FROM_PARENT', entityId: 'obj_pocket', parentId: 'obj_coat' },
                            { type: 'SET_FLAG', flag: 'coat_searched', value: true }
                        ]
                    }
                },
                {
                    conditions: [],
                    success: {
                        message: 'You check the coat again. The hidden pocket is still there—you can search it if you want.',
                        media: undefined
                    }
                }
            ],
            onTake: {
                fail: {
                    message: 'The coat is soaked with bleach and reeks of chemicals. You\'re not taking it with you. If there\'s something hidden in it, you can search it here.',
                    media: undefined
                }
            }
        },
        version: { schema: '1.0.0', content: '1.0.0' }
    },

    'obj_pocket': {
        id: 'obj_pocket' as GameObjectId,
        name: 'Pocket',
        alternateNames: ['pocket', 'coat pocket', 'jacket pocket', 'inside pocket', 'inner pocket'],
        archetype: 'Container',
        description: 'A hidden pocket inside the coat lining.',
        isRevealed: false,
        transitionNarration: 'You examine the pocket closely.',
        capabilities: { openable: false, lockable: false, breakable: false, movable: false, powerable: false, container: true, readable: false, inputtable: false },
        state: { isOpen: true, isLocked: false, isBroken: false, isPoweredOn: false, currentStateId: 'default' },
        inventory: { items: ['item_tiny_silver_key' as ItemId], capacity: 2, allowTags: [], denyTags: [] },
        parentId: 'obj_coat' as GameObjectId,
        revealMethod: 'REVEAL_FROM_PARENT',
        personal: false,
        children: {
            items: ['item_tiny_silver_key' as ItemId],
            objects: []
        },
        handlers: {
            onExamine: {
                success: {
                    message: 'A hidden pocket sewn into the coat\'s lining. Deeper than you\'d expect. Someone put effort into concealing this.\n\nYou can feel something inside—something small, hard, metallic.',
                    media: undefined
                }
            },
            onSearch: [
                {
                    conditions: [
                        { type: 'NO_FLAG', flag: 'pocket_searched' }
                    ],
                    success: {
                        message: 'You slide your hand into the hidden pocket, fingers probing carefully.\n\nThe pocket is deep. Your fingers brush against silk lining, smooth and cool.\n\nThen—there. At the bottom. Something small. Metal.\n\nYou pinch it between two fingers and pull it out:\n\nA tiny silver key.\n\nDelicate. Precise. Tarnished with age. No markings, no labels.\n\nThe kind of key that opens something small. Something locked. Something hidden.',
                        media: undefined,
                        effects: [
                            { type: 'REVEAL_FROM_PARENT', entityId: 'item_tiny_silver_key', parentId: 'obj_pocket' },
                            { type: 'SET_FLAG', flag: 'pocket_searched', value: true }
                        ]
                    }
                },
                {
                    conditions: [],
                    success: {
                        message: 'You check the pocket again, running your fingers along the silk lining.\n\nNothing else. Just the key you already found.',
                        media: undefined
                    }
                }
            ]
        },
        version: { schema: '1.0.0', content: '1.0.0' }
    },

    'obj_tire_stack': {
        id: 'obj_tire_stack' as GameObjectId,
        name: 'Tire Stack',
        alternateNames: ['tire stack', 'tires', 'old tires', 'stacked tires', 'car tires', 'pile of tires', 'tire pile', 'third tire', 'top tire', 'bottom tire'],
        archetype: 'Container',
        description: 'A pile of old car tires stacked haphazardly in the corner. Cracked rubber, weeds growing through the centers.',
        zone: 'zone_side_alley' as ZoneId,
        transitionNarration: 'You move closer to the pile of old tires. They smell like burnt rubber and decay.',
        capabilities: { openable: false, lockable: false, breakable: false, movable: true, powerable: false, container: true, readable: false, inputtable: false },
        state: {
            isOpen: false,
            isLocked: false,
            isBroken: false,
            isPoweredOn: false,
            currentStateId: 'default',
            tiresRemoved: 0  // Track how many tires player has lifted/removed
        },
        children: {
            items: ['item_crowbar' as ItemId],
            objects: []
        },
        handlers: {
            onExamine: [
                {
                    // State 3: TAKEN - After taking crowbar
                    conditions: [
                        { type: 'HAS_ITEM', itemId: 'item_crowbar' }
                    ],
                    success: {
                        message: 'The tire pile sits where you left it, slightly disturbed from your search. The crowbar is gone—you took it. Just old rubber remains, cracked and weathered, weeds growing through the centers.\n\nNothing else hidden here. You checked.',
                        media: undefined
                    }
                },
                {
                    // State 2: REVEALED - Crowbar found but not taken yet
                    conditions: [
                        { type: 'HAS_FLAG', flag: 'tires_moved' }
                    ],
                    success: {
                        message: 'The tire pile sits slightly disturbed from your search. The crowbar you found is still here, lying where you pulled it out—two feet of rust-spotted steel wedged between the third and fourth tire.',
                        media: undefined
                    }
                },
                {
                    // State 1: UNTOUCHED - Before finding crowbar (fallback/default)
                    conditions: [],
                    success: {
                        message: 'Five or six old car tires, stacked haphazardly against the brick wall like someone tossed them there and forgot. The rubber is cracked, dry-rotted from years of exposure. Deep fissures run along the treads where the material split and separated. Black flakes dust your fingers when you touch them.\n\nWeeds have colonized the centers—dandelions gone to seed, scraggly grass pushing through the holes. Nature reclaiming what was abandoned.\n\nThe smell is distinct: burnt rubber mixed with decay, that chemical petroleum stench that never fully fades. It clings to the back of your throat.\n\nThey\'re heavier than they look. Decades of moisture absorbed into the rubber, making them dense, waterlogged. Someone would need to roll them aside one by one if they wanted to move them.\n\nBut why would anyone? They\'re just trash. Forgotten debris in a forgotten alley.\n\nUnless they\'re hiding something.',
                        media: undefined
                    }
                }
            ],
            onKick: [
                {
                    // Already moved/taken
                    conditions: [
                        { type: 'HAS_ITEM', itemId: 'item_crowbar' }
                    ],
                    success: {
                        message: 'You kick the scattered tires. They shift a few inches. Nothing new to discover—you already got the crowbar.',
                        media: undefined
                    }
                },
                {
                    // Before first kick
                    conditions: [
                        { type: 'NO_FLAG', flag: 'kicked_tires' }
                    ],
                    success: {
                        message: 'You kick the bottom tire. Not hard—just enough to test the stack\'s stability.\n\nThe whole pile wobbles. The tires shift against each other, rubber scraping, settling back with a dull thud.\n\nAnd then you hear it.\n\nFaint. Metallic. A clink. Like metal tapping against metal, muffled by rubber.\n\nSomething inside the stack. Something hard. Hidden.',
                        media: undefined,
                        effects: [
                            { type: 'SET_FLAG', flag: 'kicked_tires', value: true }
                        ]
                    }
                },
                {
                    // After kicking once
                    conditions: [],
                    success: {
                        message: 'You kick the pile again. Same wobble. Same scraping sound. You already know there\'s metal hidden inside.\n\nKicking it more won\'t help. You need to figure out which tire it\'s in.',
                        media: undefined
                    }
                }
            ],
            onListen: [
                {
                    // Before kicking
                    conditions: [
                        { type: 'NO_FLAG', flag: 'kicked_tires' }
                    ],
                    success: {
                        message: 'You press your ear against the rubber. Silence. Just the distant hum of traffic from Elm Street, wind whistling through the alley.\n\nThe tires themselves are quiet. Inert. Dead rubber sitting in a forgotten corner.\n\nMaybe disturb them first. See if they make any sounds.',
                        media: undefined
                    }
                },
                {
                    // After kicking
                    conditions: [
                        { type: 'HAS_FLAG', flag: 'kicked_tires' }
                    ],
                    success: {
                        message: 'You press your ear against different tires, listening for the source of that metallic clink you heard.\n\nTop tire: nothing. Just hollow rubber.\n\nSecond tire: nothing.\n\nThird tire: wait. You tap it gently. A faint rattle. Metallic. Something hard inside, wedged against the rim.\n\nThat\'s the one. The third tire from the top. Something metal is lodged inside it or pressed against it.',
                        media: undefined,
                        effects: [
                            { type: 'SET_FLAG', flag: 'identified_third_tire', value: true }
                        ]
                    }
                }
            ],
            onTilt: [
                {
                    // Before identifying third tire
                    conditions: [
                        { type: 'NO_FLAG', flag: 'identified_third_tire' }
                    ],
                    success: {
                        message: 'You try tilting the tire stack. They\'re heavy, waterlogged. You manage to shift them a few degrees, but they settle back.\n\nIf you\'re looking for something specific, maybe listen first. Figure out where the sound is coming from.',
                        media: undefined
                    }
                },
                {
                    // After identifying, before removing enough tires
                    conditions: [
                        { type: 'HAS_FLAG', flag: 'identified_third_tire' },
                        { type: 'OBJECT_STATE', objectId: 'obj_tire_stack', statePath: 'tiresRemoved', lessThan: 2 }
                    ],
                    success: {
                        message: 'You try to tilt the third tire to see what\'s inside. Can\'t. The tires above it are too heavy, pinning it down.\n\nYou\'d need to lift the top tires off first. Remove them one by one.',
                        media: undefined
                    }
                },
                {
                    // After removing enough tires
                    conditions: [],
                    success: {
                        message: 'The third tire is accessible now. You tilt it slightly, peering at the edges.\n\nThere—wedged between this tire and the one below it. Metal. Steel. A crowbar, you realize.\n\nYou should be able to pull it out now.',
                        media: undefined
                    }
                }
            ],
            onShake: [
                {
                    // Before identifying third tire
                    conditions: [
                        { type: 'NO_FLAG', flag: 'identified_third_tire' }
                    ],
                    success: {
                        message: 'You try shaking the tire stack. Too heavy. They barely move. Waterlogged rubber is dead weight.\n\nMaybe listen first. Figure out which tire has something inside.',
                        media: undefined
                    }
                },
                {
                    // After identifying third tire
                    conditions: [
                        { type: 'HAS_FLAG', flag: 'identified_third_tire' }
                    ],
                    success: {
                        message: 'You grip the third tire and try to shake it. Heavy. The rubber gives slightly under your hands—decades of rot making it soft—but the weight prevents real movement.\n\nYou hear that rattle again. Definite. Metal against rubber.\n\nWhatever\'s in there, you\'ll need to lift the tires above it first. Clear the weight.',
                        media: undefined
                    }
                }
            ],
            onLift: [
                {
                    // Haven't kicked yet
                    conditions: [
                        { type: 'NO_FLAG', flag: 'kicked_tires' },
                        { type: 'OBJECT_STATE', objectId: 'obj_tire_stack', statePath: 'tiresRemoved', equals: 0 }
                    ],
                    success: {
                        message: 'You could lift these tires one by one, sure. But why? They\'re just old rubber. Trash.\n\nUnless you have a reason to think something\'s hidden underneath...',
                        media: undefined
                    }
                },
                {
                    // First tire - removing top one
                    conditions: [
                        { type: 'OBJECT_STATE', objectId: 'obj_tire_stack', statePath: 'tiresRemoved', equals: 0 }
                    ],
                    success: {
                        message: 'You grip the top tire with both hands. Heavier than expected. Waterlogged rubber, dense and unwieldy.\n\nYou lift. The tire comes free with a wet sucking sound, rubber peeling away from rubber. You set it aside.\n\nOne down. The stack is shorter now. You can see the second tire clearly.',
                        media: undefined,
                        effects: [
                            { type: 'SET_ENTITY_STATE', entityId: 'obj_tire_stack', key: 'tiresRemoved', value: 1 }
                        ]
                    }
                },
                {
                    // Second tire - almost there
                    conditions: [
                        { type: 'OBJECT_STATE', objectId: 'obj_tire_stack', statePath: 'tiresRemoved', equals: 1 }
                    ],
                    success: {
                        message: 'Second tire. Same process. Grip. Lift. The rubber is slick with grime and moisture. You set it aside next to the first one.\n\nTwo tires removed. The third tire is now the top of the stack.\n\nThis is the one. The one that rattled. The one with metal inside.',
                        media: undefined,
                        effects: [
                            { type: 'SET_ENTITY_STATE', entityId: 'obj_tire_stack', key: 'tiresRemoved', value: 2 }
                        ]
                    }
                },
                {
                    // Third tire - revealing the crowbar
                    conditions: [
                        { type: 'OBJECT_STATE', objectId: 'obj_tire_stack', statePath: 'tiresRemoved', equals: 2 }
                    ],
                    success: {
                        message: 'You grip the third tire. The one that made the sound.\n\nYou lift.\n\nAs the tire comes away, you see it—wedged in the gap between the third and fourth tire, hidden all along:\n\nA crowbar.\n\nSteel. About two feet long. Rust-spotted but solid. The curved pry end catches the dim alley light.\n\nSomeone hid this here. Deliberately. Stashed it between tires where nobody would look unless they were methodical. Patient. Determined.\n\nThe kind of tool you use when you need leverage.\n\nIt\'s yours now.',
                        media: undefined,
                        effects: [
                            { type: 'REVEAL_FROM_PARENT', entityId: 'item_crowbar', parentId: 'obj_tire_stack' },
                            { type: 'SET_FLAG', flag: 'tires_moved', value: true },
                            { type: 'SET_ENTITY_STATE', entityId: 'obj_tire_stack', key: 'tiresRemoved', value: 3 }
                        ]
                    }
                },
                {
                    // After crowbar revealed
                    conditions: [],
                    success: {
                        message: 'You already lifted enough tires. The crowbar is revealed. Just take it.',
                        media: undefined
                    }
                }
            ],
            onSearch: [
                {
                    // State 3: TAKEN - Already found and taken
                    conditions: [
                        { type: 'HAS_ITEM', itemId: 'item_crowbar' }
                    ],
                    success: {
                        message: 'You\'ve already searched the tires. The crowbar is gone—you took it. Nothing else here but rubber and weeds.',
                        media: undefined
                    }
                },
                {
                    // State 2: REVEALED - Crowbar found but not taken
                    conditions: [
                        { type: 'HAS_FLAG', flag: 'tires_moved' }
                    ],
                    success: {
                        message: 'You already moved the tires apart. The crowbar is right there—you can see it lying between the rubber. Just take it if you need it.',
                        media: undefined
                    }
                },
                {
                    // State 1: UNTOUCHED - Hint only, don't reveal yet
                    conditions: [],
                    success: {
                        message: 'You crouch down and reach between the tires, fingers probing the gaps. Most are empty—just dead leaves, dirt compacted into paste, spider webs.\n\nBut wait.\n\nYour fingers brush something. Cold. Hard. Metal.\n\nIt\'s wedged tight between the third and fourth tire, deep in the gap. You can feel the shape—long, narrow, maybe two feet. A rod? A pipe?\n\nYou try to pull it out. Can\'t. Stuck. The tires are too heavy, pinning it in place.\n\nYou need to MOVE the tires apart if you want to get at whatever this is.',
                        media: undefined
                    }
                }
            ],
            onMove: [
                {
                    // State 3: TAKEN - Already moved and taken
                    conditions: [
                        { type: 'HAS_ITEM', itemId: 'item_crowbar' }
                    ],
                    success: {
                        message: 'You already moved the tires. The crowbar is gone—you took it. Nothing else here.',
                        media: undefined
                    }
                },
                {
                    // State 2: REVEALED - Already moved, crowbar visible
                    conditions: [
                        { type: 'HAS_FLAG', flag: 'tires_moved' }
                    ],
                    success: {
                        message: 'You already moved the tires apart. The crowbar is lying right there between the rubber. Take it if you need it.',
                        media: undefined
                    }
                },
                {
                    // State 1: UNTOUCHED - Moving reveals the crowbar (quick path)
                    conditions: [],
                    success: {
                        message: 'You grip the top tire and roll it aside. Heavy. The rubber is slick with grime, waterlogged from years of exposure. It hits the ground with a dull thud.\n\nSecond tire. Roll it away.\n\nThird tire. You pause. This is the one. You felt something metal wedged against it.\n\nYou push it aside, and there it is—\n\nA crowbar.\n\nSteel, about two feet long. Rust-spotted but solid. The curved pry end catches the dim light. The kind of tool you use when you need leverage.\n\nSomeone hid this here. Deliberately. Tucked it between the tires where no casual passerby would find it.\n\nWhy?\n\nYou should take it. Could be useful.',
                        media: undefined,
                        effects: [
                            { type: 'REVEAL_FROM_PARENT', entityId: 'item_crowbar', parentId: 'obj_tire_stack' },
                            { type: 'SET_FLAG', flag: 'tires_moved', value: true }
                        ]
                    }
                }
            ],
            onTake: {
                fail: {
                    message: 'The tires are too heavy and awkward to carry. Besides, what would you do with a pile of old rubber? Leave them here.\n\nIf you think something\'s hidden inside them, try SEARCHING first, then MOVE the tires apart to get at it.',
                    media: undefined
                }
            }
        },
        version: { schema: '1.0.0', content: '1.0.0' }
    },

    'obj_tire_marks': {
        id: 'obj_tire_marks' as GameObjectId,
        name: 'Tire Marks',
        alternateNames: ['tire marks', 'tire tracks', 'tracks', 'skid marks', 'tread marks', 'van tracks'],
        archetype: 'Evidence',
        description: 'Fresh tire marks on the cracked concrete. Someone drove through here recently.',
        transitionNarration: 'You crouch down to examine the tire marks more closely.',
        capabilities: { openable: false, lockable: false, breakable: false, movable: false, powerable: false, container: false, readable: false, inputtable: false },
        state: { isOpen: false, isLocked: false, isBroken: false, isPoweredOn: false, currentStateId: 'default' },
        handlers: {
            onExamine: [
                {
                    // After photographing
                    conditions: [
                        { type: 'HAS_ITEM', itemId: 'item_photo_tire_marks' }
                    ],
                    success: {
                        message: 'The tire marks remain pressed into the grime—two parallel tracks with that distinctive diagonal crosshatch tread. You\'ve already photographed them. The pattern\'s documented in your phone.\n\nNow you just need to match it to the police report.',
                        media: undefined
                    }
                },
                {
                    // Before photographing (fallback/default)
                    conditions: [],
                    success: {
                        message: 'You crouch down, knees cracking, and study the marks.\n\nTwo parallel tracks pressed into the layer of dirt and grime coating the alley concrete. The treads are distinct—deep grooves cut in a diagonal crosshatch pattern, the kind of aggressive tread you see on commercial vehicles. Not passenger cars. Something heavier. A van, most likely.\n\nThe marks are fresh. Recent. You can tell by the way the dirt hasn\'t settled back into the grooves yet. A week old, maybe less. Rain would have washed them away if they\'d been here longer.\n\nYou run your finger along one track. The groove is deep—eighth of an inch, maybe more. New tires. Someone replaced them recently, or the vehicle doesn\'t see much mileage.\n\nThe police report mentioned a gray van. Witnesses saw it near the bus stop around the time Lili disappeared. These could be from that van. The timing matches. The location matches.\n\nYou should photograph these. Document the tread pattern. Compare it to the forensic report—they always catalog tire types when there\'s vehicle involvement.\n\nSomething about these tracks bothers you. They\'re too clean. Too perfect. Like someone wanted them found.',
                        media: undefined
                    }
                }
            ],
            onPhotograph: [
                {
                    // Already photographed
                    conditions: [
                        { type: 'HAS_ITEM', itemId: 'item_photo_tire_marks' }
                    ],
                    success: {
                        message: 'You\'ve already photographed the tire marks. The images are stored in your phone—clear shots of the tread pattern.',
                        media: undefined
                    }
                },
                {
                    // First time photographing (fallback/default)
                    conditions: [],
                    success: {
                        message: 'You pull out your phone, angle it to get the best light, and snap several photos. The camera focuses, capturing the tread pattern in sharp detail.\n\nClick. Click. Click.\n\nYou review the images. Clear. Usable. The diagonal crosshatch pattern is visible, the depth of the grooves apparent even in the photo. Good enough for comparison.\n\n*Photo added to evidence.*\n\nNow check the police report. They mentioned tire analysis in the forensics section.',
                        media: undefined,
                        effects: [
                            { type: 'ADD_ITEM_TO_INVENTORY', itemId: 'item_photo_tire_marks' }
                        ]
                    }
                }
            ],
            onSearch: {
                success: {
                    message: 'You examine the ground around the tire marks, looking for anything else. Cigarette butts, footprints, dropped objects—anything that might connect to whoever drove through here.\n\nNothing.\n\nJust the tracks. Clean. Isolated. Almost too perfect.\n\nWhoever left these knew what they were doing.',
                    media: undefined
                }
            },
            onTake: {
                fail: {
                    message: 'You can\'t take tire marks off the ground. They\'re evidence, but they\'re not portable. Try PHOTOGRAPHING them instead—document the pattern so you can compare it to the police report.',
                    media: undefined
                }
            },
            onUse: {
                fail: {
                    message: 'Tire marks aren\'t a tool. They\'re evidence. PHOTOGRAPH them to document the tread pattern, then compare the image to the forensic analysis in the police report.',
                    media: undefined
                }
            }
        },
        version: { schema: '1.0.0', content: '1.0.0' }
    },

    'obj_brick_walls': {
        id: 'obj_brick_walls' as GameObjectId,
        name: 'Brick Walls',
        alternateNames: ['brick walls', 'walls', 'brick wall', 'bricks', 'wall', 'graffiti', 'rose', 'justice', 'number', '1973'],
        archetype: 'Decoration',
        description: 'Tall brick walls on both sides of the alley. Stained black with decades of city grime.',
        zone: 'zone_side_alley' as ZoneId,
        transitionNarration: 'You step closer to the brick wall, running your hand along its rough surface.',
        capabilities: { openable: false, lockable: false, breakable: false, movable: false, powerable: false, container: false, readable: true, inputtable: false },
        state: { isOpen: false, isLocked: false, isBroken: false, isPoweredOn: false, currentStateId: 'default' },
        handlers: {
            onExamine: {
                success: {
                    message: 'The brick walls rise on both sides of the alley—tall, imposing, hemming you in. Old industrial construction, probably 1940s or 50s based on the brick pattern and mortar style. Red clay brick beneath layers of black grime, decades of city pollution baked into the surface.\n\nThe mortar is crumbling. You can pick it out with your fingernail in places, the cement degraded to powder. Some bricks are loose, water damage having eroded the adhesive over the years. Rain runoff has left vertical streaks down the wall—clean channels through the filth where water flows during storms.\n\nGraffiti covers the left wall. Layers of it—spray-painted tags, gang symbols, indecipherable scrawls piled over each other like archaeological strata. Each generation adding their mark, covering the previous.\n\nBut three markings stand out.\n\nA wild spray-painted ROSE—red and black, thorny stems curling around the petals. Detailed work. Not a quick tag. Someone spent time on this. Below it, in aggressive tagged style, dripping letters: "JUSTICE." The kind of street art that makes a statement. Protest? Memorial? Gang territory?\n\nAnd beneath both, stenciled in faded white paint: the number "1973."\n\nYou stare at the markings. A rose. Justice. 1973. Could they mean something? A date? A code? A message left for someone?\n\nOr just street art—beautiful, angry, meaningless?\n\nYour detective instincts tell you: sometimes graffiti is just graffiti. Not everything connects to your case.',
                    media: undefined
                }
            },
            onSearch: {
                success: {
                    message: 'You run your hands along the bricks, checking for loose ones, hidden compartments, anything that might conceal evidence. Detective work 101: assume nothing is what it seems.\n\nYou press bricks around the rose graffiti. Pull on them. Check the mortar gaps near the "JUSTICE" tag. Trace your fingers around the "1973" stencil, looking for a hidden switch, a loose brick, anything.\n\nNothing.\n\nSolid wall. Crumbling in places, yes, but just age and weather. No secret passages. No hidden safes. No loose brick revealing a key taped inside.\n\nJust a wall. Old. Dirty. Forgotten.\n\nThe graffiti stares back at you—the rose, the word, the number. Beautiful. Angry. Meaningless.\n\nSometimes a wall is just a wall.',
                    media: undefined
                }
            },
            onRead: {
                success: {
                    message: 'You read the graffiti aloud, letting the words sit in the cold alley air.\n\n"JUSTICE."\n\nThe word is spray-painted in aggressive, dripping letters. Black over red, the paint still vivid despite years of weather. Someone was angry when they wrote this. Someone wanted to be heard.\n\nBelow it, stenciled in white: "1973."\n\nA year? A date? A code?\n\nAnd above both, the rose—red and black petals, thorny stems spiraling outward. Beautiful. Deliberate. Defiant.\n\nYou stand there, waiting for meaning to crystallize. Waiting for the pieces to click into place.\n\nNothing clicks.\n\nMaybe it means something. Maybe it\'s just art. Street anger. A memorial. A warning.\n\nOr maybe it\'s nothing at all.',
                    media: undefined
                }
            },
            onPeek: {
                success: {
                    message: 'You lean in close to the graffiti, squinting at the details. Looking for hidden layers. Patterns. Messages within messages.\n\nThe rose: each petal is carefully outlined, shaded. The thorns are sharp, deliberate. You can see where the artist lifted the spray can nozzle between strokes, varying the pressure to create depth. This wasn\'t vandalism. This was art.\n\n"JUSTICE": the letters drip downward, paint running like blood. Or tears. Intentional? Or just gravity doing its work?\n\n"1973": stenciled, not sprayed freehand. Someone made a template. Cut it out. Held it against the wall and painted through it. Precise. Planned.\n\nYou look closer at the paint itself. Faded. Weathered. These markings are old. Years old. Maybe decades.\n\nBut you find nothing else. No hidden symbols. No coded messages. Just graffiti.',
                    media: undefined
                }
            },
            onKnock: {
                success: {
                    message: 'You rap your knuckles against the bricks around the graffiti. Tap tap tap. Listening for hollow spaces. Secret chambers. Hidden compartments behind the wall.\n\nSolid brick. Dense. No echo. No hollow sound.\n\nYou knock around the rose. Solid.\n\nYou knock around "JUSTICE." Solid.\n\nYou knock around "1973." Solid.\n\nIt\'s just a wall. Brick and mortar. Decades old. No hidden spaces. No secret doors.\n\nThe graffiti might mean something, but the wall beneath it is exactly what it appears to be: a wall.',
                    media: undefined
                }
            },
            onListen: {
                success: {
                    message: 'You press your ear against the cold brick, listening. Straining to hear anything beyond the normal city sounds.\n\nTraffic hum from Elm Street. Distant sirens. Wind whistling through the alley entrance.\n\nYou move to the graffiti. Press your ear against the rose. Listen.\n\nNothing.\n\nAgainst "JUSTICE." Nothing.\n\nAgainst "1973." Nothing.\n\nNo mechanical sounds. No hidden machinery. No whispers or movement behind the wall.\n\nJust brick. Cold. Silent. Dead.\n\nWhatever the graffiti means—if it means anything at all—there\'s nothing hidden behind it.',
                    media: undefined
                }
            },
            onTake: {
                fail: {
                    message: 'You can\'t take a brick wall with you. Even if you could pry loose one of the deteriorating bricks, what would you do with it? It\'s just brick. Old clay and mortar. Not evidence.',
                    media: undefined
                }
            },
            onUse: {
                fail: {
                    message: 'A brick wall isn\'t a tool. It\'s a barrier. It defines the alley, contains the space. You can EXAMINE it or SEARCH it if you think there\'s something hidden, but you can\'t use it.',
                    media: undefined
                }
            }
        },
        version: { schema: '1.0.0', content: '1.0.0' }
    },

    'obj_courtyard_door': {
        id: 'obj_courtyard_door' as GameObjectId,
        name: 'Courtyard Door',
        alternateNames: ['courtyard door', 'door', 'hidden door', 'metal door', 'rusted door', 'old door', 'hinges', 'rust'],
        archetype: 'Door',
        description: 'A hidden rusted metal door behind the dumpster. Old, locked, deliberately concealed.',
        zone: 'zone_side_alley' as ZoneId,
        isRevealed: false,
        transitionNarration: 'You step closer to the hidden door. Rust flakes off at your touch. This door hasn\'t been opened in years.',
        capabilities: { openable: true, lockable: true, breakable: true, movable: false, powerable: false, container: false, readable: false, inputtable: true },
        state: { isOpen: false, isLocked: true, isBroken: false, isPoweredOn: false, currentStateId: 'default' },
        leadsToLocationId: 'loc_courtyard' as LocationId,
        handlers: {
            onExamine: [
                {
                    // Door is locked, lever pulled (hinges compromised)
                    conditions: [
                        { type: 'OBJECT_STATE', objectId: 'obj_courtyard_door', statePath: 'isLocked', value: true },
                        { type: 'OBJECT_STATE', objectId: 'obj_crates', statePath: 'leverPulled', value: true }
                    ],
                    success: {
                        message: 'A heavy metal door, hidden behind the crates. The paint is peeling in long strips, revealing layers of rust beneath. No handle—just a numeric keypad mounted on the frame.\n\nYou study the hinges on the right edge. Rusted. Badly rusted. The metal is corroded, brittle, flaking apart in places. When you pulled that lever, something disengaged inside the wall—you can see the effects now. The hinge pins have shifted slightly, no longer seated properly.\n\nThe door is still locked by the keypad mechanism, but those hinges... they look weak. Compromised. Maybe you could force it.',
                        media: undefined
                    }
                },
                {
                    // Door is locked (normal state)
                    conditions: [
                        { type: 'OBJECT_STATE', objectId: 'obj_courtyard_door', statePath: 'isLocked', value: true }
                    ],
                    success: {
                        message: 'A heavy metal door, hidden behind the crates. The paint is peeling in long strips, revealing layers of rust beneath. No handle—just a numeric keypad mounted on the frame. Old, weathered, but still functional.\n\nSomeone deliberately hid this door. Someone wanted to keep people out. Or keep something in.\n\nThe door is locked. You need the right code to open it.',
                        media: {
                            url: '',
                            description: 'Rusted locked door with keyhole',
                            hint: 'locked door needs key'
                        }
                    }
                },
                {
                    // Door is unlocked/open
                    conditions: [],
                    success: {
                        message: 'The hidden door stands open now, revealing the dark courtyard beyond.',
                        media: undefined
                    }
                }
            ],
            onListen: [
                {
                    // Lever pulled, hinges compromised
                    conditions: [
                        { type: 'OBJECT_STATE', objectId: 'obj_crates', statePath: 'leverPulled', value: true }
                    ],
                    success: {
                        message: 'You press your ear against the cold metal. Listen.\n\nA faint sound. Mechanical. Inside the wall behind the door, something shifts. A slow creaking—metal under stress. The hinges, you realize. They\'re no longer properly supported.\n\nWhen you pulled that lever, it disengaged something structural. The hinge mechanisms. They\'re loose now. Unstable.\n\nThe door might still be locked, but it\'s weak.',
                        media: undefined
                    }
                },
                {
                    // Normal state
                    conditions: [],
                    success: {
                        message: 'You press your ear against the metal door. Silence. Just the faint hum of the city beyond—traffic, sirens, wind.\n\nNothing mechanical. Nothing moving inside. The door is solid, sealed, waiting.',
                        media: undefined
                    }
                }
            ],
            onKnock: {
                success: {
                    message: 'You rap your knuckles against the metal. A hollow, ringing sound echoes back.\n\nHeavy gauge steel, but hollow-core construction. The door is industrial, meant to secure a space, not withstand a serious assault.\n\nIf you had the right leverage, the right tool, you might be able to force it. But brute force alone won\'t work.',
                    media: undefined
                }
            },
            onOpen: [
                {
                    // Door is locked - can't open
                    conditions: [
                        { type: 'OBJECT_STATE', objectId: 'obj_courtyard_door', statePath: 'isLocked', value: true }
                    ],
                    success: {
                        message: 'You try the door. It doesn\'t budge. Locked tight. The keypad displays a blinking cursor, waiting for input.\n\nYou need the right code to unlock it.',
                        media: undefined
                    }
                },
                {
                    // Door is unlocked - opens successfully
                    conditions: [
                        { type: 'OBJECT_STATE', objectId: 'obj_courtyard_door', statePath: 'isLocked', value: false }
                    ],
                    success: {
                        message: 'The door creaks open on rusted hinges, the sound sharp in the quiet alley. Beyond is a small courtyard—neglected, overgrown, forgotten. Three garage doors line the far wall, each painted a different faded color: blue, red, green.\n\nThis is it. This is where the trail leads.',
                        media: {
                            url: '',
                            description: 'Open door revealing courtyard with garages',
                            hint: 'courtyard with three garages'
                        },
                        effects: [
                            { type: 'REVEAL_LOCATION', locationId: 'loc_courtyard' }
                        ]
                    }
                }
            ],
            onInput: {
                correctPasswords: ['225'],
                onSuccess: {
                    message: 'You punch in the code: 2-2-5.\n\nThe keypad beeps. Green light.\n\nA mechanical click echoes from inside the door. The lock disengages.\n\nThe door is unlocked.',
                    media: undefined,
                    effects: [
                        { type: 'SET_OBJECT_STATE', objectId: 'obj_courtyard_door', statePath: 'isLocked', value: false }
                    ]
                },
                onFailure: {
                    message: 'You enter the code. The keypad beeps. Red light. Wrong code.\n\nThe door remains locked.',
                    media: undefined
                }
            },
            onPry: [
                {
                    // Lever pulled, has crowbar, door still locked - CAN FORCE IT OPEN
                    conditions: [
                        { type: 'OBJECT_STATE', objectId: 'obj_crates', statePath: 'leverPulled', value: true },
                        { type: 'HAS_ITEM', itemId: 'item_crowbar' },
                        { type: 'OBJECT_STATE', objectId: 'obj_courtyard_door', statePath: 'isLocked', value: true }
                    ],
                    success: {
                        message: 'You wedge the crowbar into the gap between the door and the frame, right at the hinges. The rusted metal gives slightly—those hinge pins are loose, compromised by whatever mechanism that lever controlled.\n\nYou pull. Hard.\n\nThe hinges scream. Metal tears. Rust flakes rain down like red snow.\n\nYou pull harder.\n\nCRACK.\n\nThe top hinge shears off completely, bolts ripping through corroded metal. The door sags, held now only by the bottom hinge and the keypad lock.\n\nOne more pull.\n\nCRRRRACK.\n\nThe bottom hinge tears free. The door swings inward violently, still attached to the frame by the electronic lock mechanism, but the path is open—a gap wide enough to slip through.\n\nYou\'re in.\n\nBeyond the broken door: a small courtyard. Neglected. Overgrown. Forgotten. Three garage doors line the far wall—blue, red, green.\n\nThis is it. This is where the trail leads.',
                        media: {
                            url: '',
                            description: 'Broken door revealing courtyard with garages',
                            hint: 'forced entry courtyard'
                        },
                        effects: [
                            { type: 'SET_OBJECT_STATE', objectId: 'obj_courtyard_door', statePath: 'isBroken', value: true },
                            { type: 'SET_OBJECT_STATE', objectId: 'obj_courtyard_door', statePath: 'isLocked', value: false },
                            { type: 'REVEAL_LOCATION', locationId: 'loc_courtyard' }
                        ]
                    }
                },
                {
                    // Lever NOT pulled - hinges too strong
                    conditions: [
                        { type: 'HAS_ITEM', itemId: 'item_crowbar' },
                        { type: 'OBJECT_STATE', objectId: 'obj_courtyard_door', statePath: 'isLocked', value: true }
                    ],
                    success: {
                        message: 'You try wedging the crowbar into the door frame, looking for leverage. The hinges are rusted, sure, but they\'re still seated properly. Industrial bolts. Heavy duty.\n\nYou pull. The crowbar bends slightly under the strain, but the door doesn\'t budge. The hinges hold.\n\nYou\'d need those hinges compromised first—loosened, disengaged, weakened somehow—before you could pry this door open.',
                        media: undefined
                    }
                },
                {
                    // No crowbar
                    conditions: [],
                    success: {
                        message: 'You try to pry the door with your bare hands. It doesn\'t move. You\'d need a tool—something with leverage.',
                        media: undefined
                    }
                }
            ],
            onKick: [
                {
                    // Lever pulled - hinges weak, but still need crowbar
                    conditions: [
                        { type: 'OBJECT_STATE', objectId: 'obj_crates', statePath: 'leverPulled', value: true },
                        { type: 'OBJECT_STATE', objectId: 'obj_courtyard_door', statePath: 'isLocked', value: true }
                    ],
                    success: {
                        message: 'You step back and kick the door hard. Your foot connects with a metallic BANG.\n\nThe door shudders. The hinges rattle—you can hear the looseness, the give in the mechanism. But it doesn\'t break.\n\nYou kick again. Harder.\n\nThe top hinge shifts, scraping metal against metal, but holds.\n\nYou could damage it further with enough kicks, but you\'d risk injury. A crowbar would be smarter—leverage the weak hinges, pry them apart instead of battering them.',
                        media: undefined
                    }
                },
                {
                    // Normal state
                    conditions: [],
                    success: {
                        message: 'You kick the door. Your foot bounces off solid metal. The door doesn\'t budge.\n\nThis isn\'t a cheap interior door. It\'s industrial steel. Kicking it is just going to hurt your foot.',
                        media: undefined
                    }
                }
            ],
            onBreak: [
                {
                    // Lever pulled, has crowbar - suggest PRY instead
                    conditions: [
                        { type: 'OBJECT_STATE', objectId: 'obj_crates', statePath: 'leverPulled', value: true },
                        { type: 'HAS_ITEM', itemId: 'item_crowbar' }
                    ],
                    success: {
                        message: 'The hinges are compromised—you can see that. Rusted, loose, barely holding. If you\'re going to break this door, you should PRY it open with the crowbar. Leverage the weak hinges. That\'s the smart way.',
                        media: undefined
                    }
                },
                {
                    // Normal state
                    conditions: [],
                    fail: {
                        message: 'You consider trying to break down the door. Kick it in. Shoulder it. Force it open.\n\nBut this isn\'t some hollow-core apartment door. It\'s solid metal. Industrial grade. Even if you had a battering ram, you\'d make noise loud enough to wake the whole neighborhood.\n\nYou\'re a detective, not a demolition crew. Find the code. That\'s the smart way in.',
                        media: undefined
                    }
                }
            ],
            onTake: {
                fail: {
                    message: 'It\'s a door. A heavy metal door bolted into a concrete frame. You can\'t take it with you any more than you could carry away a section of brick wall. It\'s architecture.',
                    media: undefined
                }
            },
            onUse: {
                fail: {
                    message: 'A door isn\'t a tool—it\'s a barrier, a passage. If it\'s locked, you need the right code for the keypad. If it\'s unlocked, you can OPEN it. You can\'t use it.',
                    media: undefined
                }
            }
        },
        version: { schema: '1.0.0', content: '1.0.0' }
    },

    // COURTYARD OBJECTS
    'obj_old_tires': {
        id: 'obj_old_tires' as GameObjectId,
        name: 'Old Tires',
        archetype: 'Decoration',
        description: 'A pile of old car tires stacked in the corner of the courtyard. Weathered, cracked, forgotten.',
        transitionNarration: 'You approach the pile of old tires. They\'re stacked haphazardly, black rubber cracked from years of exposure.',
        capabilities: { openable: false, lockable: false, breakable: false, movable: true, powerable: false, container: false, readable: false, inputtable: false },
        state: { isOpen: false, isLocked: false, isBroken: false, isPoweredOn: false, currentStateId: 'default' },
        handlers: {
            onExamine: {
                message: 'Old car tires, stacked in a corner. The rubber is cracked and weathered. Some have weeds growing through the center holes.\n\nNothing special here. Just debris from years of neglect.',
                media: undefined
            },
            onMove: {
                message: 'You roll the tires aside. Nothing hidden beneath—just more cracked concrete.',
                media: undefined
            }
        },
        version: { schema: '1.0.0', content: '1.0.0' }
    },

    'obj_garage_blue_door': {
        id: 'obj_garage_blue_door' as GameObjectId,
        name: 'Blue Garage Door',
        archetype: 'Door',
        description: 'A garage door painted faded blue. The paint is peeling, revealing rust beneath.',
        transitionNarration: 'You walk up to the blue garage door. Paint flakes off at your touch.',
        capabilities: { openable: true, lockable: true, breakable: false, movable: false, powerable: false, container: false, readable: false, inputtable: true },
        state: { isOpen: false, isLocked: true, isBroken: false, isPoweredOn: false, currentStateId: 'default' },
        leadsToLocationId: 'loc_garage_blue' as LocationId,
        handlers: {
            onExamine: {
                message: 'The blue garage door is old and weathered. A small keypad is mounted next to it—requires a code. The paint is so faded you can barely tell it was once blue.',
                media: {
                    url: '',
                    description: 'Faded blue garage door with keypad',
                    hint: 'locked garage needs code'
                }
            },
            onOpen: [
                {
                    conditions: [
                        { type: 'OBJECT_STATE', objectId: 'obj_garage_blue_door', statePath: 'isLocked', value: true }
                    ],
                    success: {
                        message: 'The garage door is locked. The keypad blinks, waiting for a code.',
                        media: undefined
                    }
                },
                {
                    conditions: [],
                    success: {
                        message: 'The garage door rolls open with a grinding mechanical sound. Inside, darkness waits.',
                        media: undefined,
                        effects: [
                            { type: 'REVEAL_LOCATION', locationId: 'loc_garage_blue' }
                        ]
                    }
                }
            ]
        },
        version: { schema: '1.0.0', content: '1.0.0' }
    },

    'obj_garage_red_door': {
        id: 'obj_garage_red_door' as GameObjectId,
        name: 'Red Garage Door',
        archetype: 'Door',
        description: 'A garage door painted faded red. Rust stains streak down from the hinges.',
        transitionNarration: 'You step toward the red garage door. Rust flakes fall as you approach.',
        capabilities: { openable: true, lockable: true, breakable: false, movable: false, powerable: false, container: false, readable: false, inputtable: true },
        state: { isOpen: false, isLocked: true, isBroken: false, isPoweredOn: false, currentStateId: 'default' },
        leadsToLocationId: 'loc_garage_red' as LocationId,
        handlers: {
            onExamine: {
                message: 'The red garage door is heavily rusted. A keypad sits beside it, its numbers worn smooth from use—or disuse.',
                media: {
                    url: '',
                    description: 'Rusted red garage door with keypad',
                    hint: 'locked garage needs code'
                }
            },
            onOpen: [
                {
                    conditions: [
                        { type: 'OBJECT_STATE', objectId: 'obj_garage_red_door', statePath: 'isLocked', value: true }
                    ],
                    success: {
                        message: 'The garage door won\'t budge. Locked. The keypad awaits input.',
                        media: undefined
                    }
                },
                {
                    conditions: [],
                    success: {
                        message: 'The red garage door groans open, revealing the cluttered space beyond.',
                        media: undefined,
                        effects: [
                            { type: 'REVEAL_LOCATION', locationId: 'loc_garage_red' }
                        ]
                    }
                }
            ]
        },
        version: { schema: '1.0.0', content: '1.0.0' }
    },

    'obj_garage_green_door': {
        id: 'obj_garage_green_door' as GameObjectId,
        name: 'Green Garage Door',
        archetype: 'Door',
        description: 'A garage door painted faded green. The cleanest of the three, but still weathered.',
        transitionNarration: 'You approach the green garage door. It looks slightly newer than the others.',
        capabilities: { openable: true, lockable: true, breakable: false, movable: false, powerable: false, container: false, readable: false, inputtable: true },
        state: { isOpen: false, isLocked: true, isBroken: false, isPoweredOn: false, currentStateId: 'default' },
        leadsToLocationId: 'loc_garage_green' as LocationId,
        handlers: {
            onExamine: {
                message: 'The green garage door is the least weathered of the three. Still old, still faded, but maintained—at least compared to the others. A keypad is mounted on the wall.',
                media: {
                    url: '',
                    description: 'Faded green garage door with keypad',
                    hint: 'locked garage needs code'
                }
            },
            onOpen: [
                {
                    conditions: [
                        { type: 'OBJECT_STATE', objectId: 'obj_garage_green_door', statePath: 'isLocked', value: true }
                    ],
                    success: {
                        message: 'Locked. The keypad waits for a code.',
                        media: undefined
                    }
                },
                {
                    conditions: [],
                    success: {
                        message: 'The green garage door opens smoothly—someone oiled these hinges. The empty space inside beckons.',
                        media: undefined,
                        effects: [
                            { type: 'REVEAL_LOCATION', locationId: 'loc_garage_green' }
                        ]
                    }
                }
            ]
        },
        version: { schema: '1.0.0', content: '1.0.0' }
    },

    // ============================================
    // DARK ALLEY OBJECTS
    // ============================================

    'obj_graffiti': {
        id: 'obj_graffiti' as GameObjectId,
        name: 'Graffiti',
        alternateNames: ['graffiti', 'spray paint', 'wall art', 'rose graffiti', 'rose drawing', 'tag', 'sb tag'],
        archetype: 'Static',
        description: 'Spray-painted graffiti on the brick wall: a crude rose drawing, the tag "SB", and the number "1984".',
        capabilities: { openable: false, lockable: false, breakable: false, movable: false, powerable: false, container: false, readable: false, inputtable: false },
        state: { isOpen: false, isLocked: false, isBroken: false, isPoweredOn: false, currentStateId: 'default' },
        handlers: {
            onExamine: {
                success: {
                    message: 'Spray paint on faded brick. Someone put care into this.\n\nA rose, painted in red and black—petals wilting. Below it: the tag "SB" in angular letters. Below that: "1984" in block numbers.\n\nStreet art or something more?',
                    media: undefined
                }
            }
        },
        design: {
            authorNotes: "Provides part of the code for the hidden door. Cross-references with Script Sheet in Garage.",
            tags: ['clue', 'visual']
        },
        version: { schema: "1.0", content: "1.0" }
    },

    'obj_alley_dumpster': {
        id: 'obj_alley_dumpster' as GameObjectId,
        name: 'Dumpster',
        alternateNames: ['dumpster', 'rusty dumpster', 'rusted dumpster', 'green dumpster', 'trash bin', 'bin'],
        archetype: 'Container',
        description: 'A large green dumpster. Its lid is slightly ajar. The smell is... wrong.',
        capabilities: { openable: true, lockable: false, breakable: false, movable: false, powerable: false, container: true, readable: false, inputtable: false },
        state: { isOpen: false, isLocked: false, isBroken: false, isPoweredOn: false, currentStateId: 'default' },
        inventory: { items: [] as ItemId[], capacity: 10, allowTags: [], denyTags: [] },
        children: {
            items: [],
            objects: ['obj_sealed_bag' as GameObjectId]
        },
        handlers: {
            onSmell: {
                success: {
                    message: 'You lean closer and inhale.\n\nNot rot. Not garbage. Chemical. Bleach, maybe. Something sharp and sterile.\n\nWrong for a dumpster. Very wrong.',
                    media: undefined
                }
            },
            onClimb: [
                {
                    conditions: [{ type: 'FLAG', flag: 'dumpster_searched', value: true }],
                    success: {
                        message: 'You\'ve already searched the dumpster. Nothing more to find in there.',
                        media: undefined
                    }
                },
                {
                    conditions: [],
                    success: {
                        message: 'You haul yourself up and over the edge, dropping into the dumpster.\n\nThe smell hits harder inside—that chemical tang. Your shoes squelch on something damp.\n\nMost of the contents are gone. Too clean for a city dumpster. But there—tucked against the corner—a sealed backpack.',
                        media: undefined,
                        effects: [
                            { type: 'SET_FLAG', flag: 'dumpster_searched', value: true },
                            { type: 'REVEAL_FROM_PARENT', entityId: 'obj_sealed_bag', parentId: 'obj_alley_dumpster' }
                        ]
                    }
                }
            ],
            onSearch: [
                {
                    conditions: [{ type: 'FLAG', flag: 'dumpster_searched', value: true }],
                    success: {
                        message: 'You\'ve already searched inside. The sealed bag is the only thing worth noting.',
                        media: undefined
                    }
                },
                {
                    conditions: [],
                    success: {
                        message: 'You lean over the edge and peer inside.\n\nToo dark to see much. You\'ll need to climb in to search properly.',
                        media: undefined
                    }
                }
            ],
            onExamine: {
                success: {
                    message: 'Big green dumpster, lid half-open. You can smell it from here—but it doesn\'t smell like garbage.\n\nSmells like someone cleaned something. Thoroughly.',
                    media: undefined
                }
            }
        },
        design: {
            authorNotes: "First object in Alley. Smell reveals chemical cleaning. Climb/search reveals sealed bag with invoice evidence.",
            tags: ['container', 'clue', 'sensory']
        },
        version: { schema: "1.0", content: "1.0" }
    },

    'obj_alley_crates': {
        id: 'obj_alley_crates' as GameObjectId,
        name: 'Wooden Crates',
        alternateNames: ['wooden crates', 'crates', 'boxes', 'wooden boxes', 'stack of crates'],
        archetype: 'Furniture',
        description: 'Several wooden crates stacked against the wall.',
        capabilities: { openable: false, lockable: false, breakable: false, movable: true, powerable: false, container: false, readable: false, inputtable: false },
        state: { isOpen: false, isLocked: false, isBroken: false, isPoweredOn: false, currentStateId: 'default' },
        children: {
            items: [],
            objects: ['obj_alley_metal_door'] as GameObjectId[]
        },
        handlers: {
            onExamine: {
                success: {
                    message: 'Old wooden crates stacked against the far wall. Weathered, splintered. They look like they\'ve been sitting here for months.',
                    media: undefined
                }
            },
            onMove: [
                {
                    conditions: [{ type: 'FLAG', flag: 'crates_moved', value: true }],
                    success: {
                        message: 'The crates are already shoved aside. The hidden door in the wall is visible.',
                        media: undefined
                    }
                },
                {
                    conditions: [],
                    success: {
                        message: 'You push the crates aside. Wood scrapes on concrete.\n\nThe wall behind them isn\'t brick—it\'s a metal door, painted to blend with the alley wall. A small keypad gleams next to the handle.\n\nFour digits. Someone wanted this entrance very hidden.',
                        media: undefined,
                        effects: [
                            { type: 'SET_FLAG', flag: 'crates_moved', value: true },
                            { type: 'REVEAL_FROM_PARENT', entityId: 'obj_alley_metal_door', parentId: 'obj_alley_crates' }
                        ]
                    }
                }
            ]
        },
        design: {
            authorNotes: "Hides the metal door with keypad. Player must move crates to discover the door.",
            tags: ['movable', 'concealment']
        },
        version: { schema: "1.0", content: "1.0" }
    },

    'obj_alley_metal_door': {
        id: 'obj_alley_metal_door' as GameObjectId,
        name: 'Metal Door',
        alternateNames: ['metal door', 'hidden door', 'door', 'keypad door', 'alley door', 'backdoor'],
        archetype: 'Door',
        description: 'A metal door painted to match the alley wall. A keypad sits beside the handle.',
        capabilities: { openable: true, lockable: true, breakable: false, movable: false, powerable: false, container: false, readable: false, inputtable: true },
        state: { isOpen: false, isLocked: true, isBroken: false, isPoweredOn: false, currentStateId: 'default' },
        input: { type: 'pin', validation: '1984', hint: 'Four-digit code', attempts: null, lockout: null },
        handlers: {
            onExamine: [
                {
                    conditions: [{ type: 'STATE', entityId: 'obj_alley_metal_door', key: 'isOpen', equals: true }],
                    success: {
                        message: 'The door stands open, revealing the hidden room beyond. The keypad glows green.',
                        media: undefined
                    }
                },
                {
                    conditions: [{ type: 'STATE', entityId: 'obj_alley_metal_door', key: 'isLocked', equals: false }],
                    success: {
                        message: 'The door is unlocked. The keypad shows a green light. You can open it now.',
                        media: undefined
                    }
                },
                {
                    conditions: [],
                    success: {
                        message: 'Solid metal door, keypad-locked. Four-digit PIN. The handle won\'t budge without the right code.',
                        media: undefined
                    }
                }
            ],
            onOpen: [
                {
                    conditions: [
                        { type: 'STATE', entityId: 'obj_alley_metal_door', key: 'isLocked', equals: false },
                        { type: 'STATE', entityId: 'obj_alley_metal_door', key: 'isOpen', equals: false }
                    ],
                    success: {
                        message: 'You pull the handle. The door swings open with a pneumatic hiss.\n\nA small room beyond. Hidden. Secret.\n\nThis is where they operated.',
                        media: undefined,
                        effects: [
                            { type: 'SET_ENTITY_STATE', entityId: 'obj_alley_metal_door', patch: { isOpen: true } },
                            { type: 'SET_FLAG', flag: 'hidden_room_discovered', value: true }
                        ]
                    }
                },
                {
                    conditions: [{ type: 'STATE', entityId: 'obj_alley_metal_door', key: 'isLocked', equals: true }],
                    success: {
                        message: 'The door is locked. The keypad blinks red. You need the code.',
                        media: undefined
                    },
                    fail: {
                        message: 'The door won\'t budge. Locked tight.',
                        media: undefined
                    }
                }
            ],
            onPasswordSuccess: {
                success: {
                    message: 'The keypad beeps. Green light.\n\nClunk. The door unlocks.\n\n1984. Of course.',
                    media: undefined,
                    effects: [
                        { type: 'SET_ENTITY_STATE', entityId: 'obj_alley_metal_door', patch: { isLocked: false } }
                    ]
                }
            },
            onPasswordFail: {
                success: {
                    message: 'Wrong code. The keypad buzzes, red light flashing.',
                    media: undefined
                }
            }
        },
        design: {
            authorNotes: "Locked with PIN 1984. Code comes from Graffiti (SB + 1984) + Script Sheet in Garage ('Backdoor code = SB year'). Opens to Hidden Room.",
            tags: ['door', 'locked', 'puzzle']
        },
        version: { schema: "1.0", content: "1.0" }
    },

    'obj_rusty_locker': {
        id: 'obj_rusty_locker' as GameObjectId,
        name: 'Rusty Metal Locker',
        alternateNames: ['rusty metal locker', 'rusty locker', 'metal locker', 'locker', 'old locker'],
        archetype: 'Container',
        description: 'An old metal locker, rusted and bent but still latched shut.',
        capabilities: { openable: true, lockable: false, breakable: false, movable: false, powerable: false, container: true, readable: false, inputtable: false },
        state: { isOpen: false, isLocked: false, isBroken: false, isPoweredOn: false, currentStateId: 'locked' },
        inventory: { items: [], capacity: 1, allowTags: [], denyTags: [] },
        requirements: {
            options: [
                { attributes: { prying: 3 } }
            ]
        },
        children: {
            items: [],
            objects: ['obj_cashbox' as GameObjectId]
        },
        handlers: {
            onExamine: [
                {
                    conditions: [{ type: 'STATE', entityId: 'obj_rusty_locker', key: 'isOpen', equals: true }],
                    success: {
                        message: 'The locker door hangs open, bent from the crowbar. Inside is empty now—you already took the cashbox.',
                        media: undefined
                    }
                },
                {
                    conditions: [],
                    success: {
                        message: 'Rusty metal locker against the alley wall. The door is bent and warped, but still closed. A simple latch holds it shut.\n\nYou could pry it open with the right tool.',
                        media: undefined
                    }
                }
            ],
            onOpen: [
                {
                    conditions: [{ type: 'STATE', entityId: 'obj_rusty_locker', key: 'isOpen', equals: true }],
                    success: {
                        message: 'It\'s already open.',
                        media: undefined
                    }
                },
                {
                    conditions: [],
                    success: {
                        message: 'The latch is bent shut. You\'ll need to pry it open.',
                        media: undefined
                    }
                }
            ],
            onUse: [
                {
                    itemId: 'item_alley_crowbar',
                    conditions: [{ type: 'STATE', entityId: 'obj_rusty_locker', key: 'isOpen', equals: true }],
                    success: {
                        message: 'Already pried open. No need to hit it again.',
                        media: undefined
                    }
                },
                {
                    itemId: 'item_alley_crowbar',
                    conditions: [],
                    success: {
                        message: 'You wedge the crowbar into the gap and lever it hard.\n\nMetal screams. The latch tears free.\n\nInside: a locked metal cashbox. Small, dented, heavy.',
                        media: undefined,
                        effects: [
                            { type: 'SET_ENTITY_STATE', entityId: 'obj_rusty_locker', patch: { isOpen: true } },
                            { type: 'REVEAL_FROM_PARENT', entityId: 'obj_cashbox', parentId: 'obj_rusty_locker' }
                        ]
                    }
                }
            ]
        },
        design: {
            authorNotes: "Onion-chain start: Locker → Cashbox → Evidence Bag → Contact Sheet. Requires crowbar from tire pile.",
            tags: ['container', 'onion-chain', 'requires-tool']
        },
        version: { schema: "1.0", content: "1.0" }
    },

    // ============================================
    // HIDDEN ROOM OBJECTS
    // ============================================

    'obj_hidden_table': {
        id: 'obj_hidden_table' as GameObjectId,
        name: 'Metal Table',
        archetype: 'Furniture',
        description: 'A small metal table in the center of the room. Its surface is scratched and stained.',
        capabilities: { openable: false, lockable: false, breakable: false, movable: false, powerable: false, container: false, readable: false, inputtable: false },
        state: { isOpen: false, isLocked: false, isBroken: false, isPoweredOn: false, currentStateId: 'default' },
        children: {
            items: [],
            objects: ['obj_burner_phone' as GameObjectId]
        },
        handlers: {
            onExamine: {
                success: {
                    message: 'Metal table, bolted to the floor. Surface covered in scratches. Someone worked here.\n\nA cheap burner phone sits on top, screen dark.',
                    media: undefined,
                    effects: [
                        { type: 'REVEAL_FROM_PARENT', entityId: 'obj_burner_phone', parentId: 'obj_hidden_table' }
                    ]
                }
            }
        },
        design: {
            authorNotes: "Holds burner phone, key evidence linking to the operation network.",
            tags: ['furniture', 'evidence']
        },
        version: { schema: "1.0", content: "1.0" }
    },

    'obj_hidden_shelf': {
        id: 'obj_hidden_shelf' as GameObjectId,
        name: 'Metal Shelf',
        archetype: 'Furniture',
        description: 'A metal shelf mounted on the back wall. Mostly empty.',
        capabilities: { openable: false, lockable: false, breakable: false, movable: false, powerable: false, container: false, readable: false, inputtable: false },
        state: { isOpen: false, isLocked: false, isBroken: false, isPoweredOn: false, currentStateId: 'default' },
        handlers: {
            onExamine: {
                success: {
                    message: 'Empty metal shelf on the wall. A few dust marks show where things used to sit. Cleared out recently.',
                    media: undefined
                }
            }
        },
        design: {
            authorNotes: "Flavor object for Hidden Room atmosphere. Shows evidence of recent activity.",
            tags: ['furniture', 'atmosphere']
        },
        version: { schema: "1.0", content: "1.0" }
    },

    // ============================================
    // GARAGE OBJECTS
    // ============================================

    'obj_workbench': {
        id: 'obj_workbench' as GameObjectId,
        name: 'Workbench',
        archetype: 'Furniture',
        description: 'A cluttered workbench covered in tools and papers.',
        capabilities: { openable: false, lockable: false, breakable: false, movable: false, powerable: false, container: false, readable: false, inputtable: false },
        state: { isOpen: false, isLocked: false, isBroken: false, isPoweredOn: false, currentStateId: 'default' },
        children: {
            items: ['item_script_sheet'] as ItemId[],
            objects: []
        },
        handlers: {
            onExamine: [
                {
                    conditions: [{ type: 'HAS_ITEM', itemId: 'item_script_sheet' }],
                    success: {
                        message: 'The workbench is a mess of tools and grease-stained rags. Nothing else interesting.',
                        media: undefined
                    }
                },
                {
                    conditions: [],
                    success: {
                        message: 'Workbench covered in old newspapers, tools, shop rags.\n\nOne paper stands out—folded and clean. A scene script sheet. Someone left it here deliberately.',
                        media: undefined,
                        effects: [
                            { type: 'REVEAL_FROM_PARENT', entityId: 'item_script_sheet', parentId: 'obj_workbench' }
                        ]
                    }
                }
            ]
        },
        design: {
            authorNotes: "Contains the Script Sheet which provides the hint for the hidden door code (Backdoor code = SB year).",
            tags: ['furniture', 'clue']
        },
        version: { schema: "1.0", content: "1.0" }
    },

    'obj_tool_cabinet': {
        id: 'obj_tool_cabinet' as GameObjectId,
        name: 'Tool Cabinet',
        archetype: 'Container',
        description: 'A tall metal cabinet with pegboard doors. Tools hang inside and out.',
        capabilities: { openable: true, lockable: false, breakable: false, movable: false, powerable: false, container: true, readable: false, inputtable: false },
        state: { isOpen: false, isLocked: false, isBroken: false, isPoweredOn: false, currentStateId: 'default' },
        inventory: { items: [] as ItemId[], capacity: 5, allowTags: [], denyTags: [] },
        handlers: {
            onExamine: {
                success: {
                    message: 'Standard tool cabinet. Wrenches, screwdrivers, a coil of wire. Nothing unusual.',
                    media: undefined
                }
            }
        },
        design: {
            authorNotes: "Placeholder Garage object for atmosphere. Can be expanded later.",
            tags: ['container', 'placeholder']
        },
        version: { schema: "1.0", content: "1.0" }
    },

    // =====================================
    // ZONE STORAGE CONTAINERS
    // Designated containers for dropped items per zone
    // =====================================

    'obj_street_storage': {
        id: 'obj_street_storage' as GameObjectId,
        name: 'Dropped Items',
        alternateNames: ['dropped items', 'stored items', 'stashed items', 'my items', 'storage'],
        archetype: 'Container',
        description: 'A collection of items you temporarily set aside in this area.',
        capabilities: { openable: false, lockable: false, breakable: false, movable: false, powerable: false, container: true, readable: false, inputtable: false },
        state: { isOpen: true, isLocked: false, isBroken: false, isPoweredOn: false, currentStateId: 'default' },
        inventory: { items: [], capacity: null, allowTags: [], denyTags: [] },
        isRevealed: false,  // Hidden until items are dropped
        personal: false,
        children: {
            items: [],
            objects: []
        },
        handlers: {
            onExamine: {
                success: {
                    message: 'These are the items you set aside here. You can pick them up anytime.',
                    media: undefined
                }
            }
        },
        design: {
            authorNotes: "Zone storage container for Street location. Collects dropped items in a persistent, visible storage area.",
            tags: ['storage', 'system']
        },
        version: { schema: "1.0", content: "1.0" }
    },

    'obj_side_alley_storage': {
        id: 'obj_side_alley_storage' as GameObjectId,
        name: 'Dropped Items',
        alternateNames: ['dropped items', 'stored items', 'stashed items', 'my items', 'storage'],
        archetype: 'Container',
        description: 'A collection of items you temporarily set aside in this area.',
        capabilities: { openable: false, lockable: false, breakable: false, movable: false, powerable: false, container: true, readable: false, inputtable: false },
        state: { isOpen: true, isLocked: false, isBroken: false, isPoweredOn: false, currentStateId: 'default' },
        inventory: { items: [], capacity: null, allowTags: [], denyTags: [] },
        isRevealed: false,  // Hidden until items are dropped
        personal: false,
        children: {
            items: [],
            objects: []
        },
        handlers: {
            onExamine: {
                success: {
                    message: 'These are the items you set aside here. You can pick them up anytime.',
                    media: undefined
                }
            }
        },
        design: {
            authorNotes: "Zone storage container for Side Alley. Collects dropped items in a persistent, visible storage area.",
            tags: ['storage', 'system']
        },
        version: { schema: "1.0", content: "1.0" }
    },

    'obj_dark_alley_storage': {
        id: 'obj_dark_alley_storage' as GameObjectId,
        name: 'Dropped Items',
        alternateNames: ['dropped items', 'stored items', 'stashed items', 'my items', 'storage'],
        archetype: 'Container',
        description: 'A collection of items you temporarily set aside in this area.',
        capabilities: { openable: false, lockable: false, breakable: false, movable: false, powerable: false, container: true, readable: false, inputtable: false },
        state: { isOpen: true, isLocked: false, isBroken: false, isPoweredOn: false, currentStateId: 'default' },
        inventory: { items: [], capacity: null, allowTags: [], denyTags: [] },
        isRevealed: false,  // Hidden until items are dropped
        personal: false,
        children: {
            items: [],
            objects: []
        },
        handlers: {
            onExamine: {
                success: {
                    message: 'These are the items you set aside here. You can pick them up anytime.',
                    media: undefined
                }
            }
        },
        design: {
            authorNotes: "Zone storage container for Dark Alley. Collects dropped items in a persistent, visible storage area.",
            tags: ['storage', 'system']
        },
        version: { schema: "1.0", content: "1.0" }
    },

    // =====================================
    // NEW EVIDENCE-CONTAINING OBJECTS
    // =====================================

    'obj_cctv_monitor': {
        id: 'obj_cctv_monitor' as GameObjectId,
        name: 'CCTV Monitor Station',
        alternateNames: ['cctv monitor', 'monitor station', 'monitors', 'security monitors', 'cctv system'],
        archetype: 'Device',
        description: 'A bank of security monitors displaying live CCTV feeds from Elm Street cameras. Archive system accessible.',
        capabilities: { openable: false, lockable: false, breakable: false, movable: false, powerable: true, container: true, readable: false, inputtable: false },
        state: { isOpen: false, isLocked: false, isBroken: false, isPoweredOn: true, currentStateId: 'default' },
        inventory: { items: [], capacity: 5, allowTags: ['evidence'], denyTags: [] },
        startingLocation: 'loc_street' as LocationId,
        children: {
            items: ['item_cctv_screenshot' as ItemId],
            objects: []
        },
        handlers: {
            onExamine: {
                success: {
                    message: 'A bank of six monitors mounted on a desk, each showing different camera angles from Elm Street. The screens flicker with live feeds - the bus stop, the alley entrance, the florist shop.\n\nBelow the monitors: a keyboard and mouse for accessing archived footage. A small printer sits on the side for printing screenshots.\n\nThe system is powered on, blinking green LEDs indicating active recording.',
                    media: undefined
                }
            },
            onSearch: [
                {
                    // Already printed screenshot
                    conditions: [
                        { type: 'HAS_ITEM', itemId: 'item_cctv_screenshot' as ItemId }
                    ],
                    success: {
                        message: 'You\'ve already searched the CCTV archives and printed the screenshot showing the gray van. The evidence is in your inventory.',
                        media: undefined
                    }
                },
                {
                    // First time searching - reveal screenshot
                    conditions: [],
                    success: {
                        message: 'You sit down at the monitor station and access the archive system.\n\n"Show me Elm Street footage from April 15, 6:00 PM to 6:30 PM," you type.\n\nThe system loads. Multiple camera angles appear, timestamped.\n\nYou scan through the feeds. Bus stop. Kiosk. Florist shop. Alley entrance.\n\nThen you see it.\n\n**6:15 PM - Camera #4**: A gray cargo van parked on Elm Street. The angle is perfect - you can see the license plate clearly.\n\n**LKJ-9472**\n\nYou freeze the frame. Zoom in. The plate is crisp, readable.\n\nThis is it. The van Sarah mentioned from the traffic cams. And it was here at the exact time of Lili\'s alleged abduction.\n\nYou hit PRINT. The small printer whirs to life, spitting out a high-resolution screenshot.',
                        media: undefined,
                        effects: [
                            { type: 'REVEAL_FROM_PARENT', entityId: 'item_cctv_screenshot', parentId: 'obj_cctv_monitor' },
                            {
                                type: 'SHOW_MESSAGE',
                                speaker: 'system',
                                content: '**EVIDENCE 1 ACQUIRED**: CCTV Screenshot\n\nThe printed screenshot shows the gray van (plate LKJ-9472) on Elm Street at 6:15 PM on April 15. This van was here during the abduction.\n\nNote: The four-digit portion of the license plate (9472) might be useful as a code or PIN somewhere.'
                            }
                        ]
                    }
                }
            ],
            onUse: {
                success: {
                    message: 'The monitors are already on and displaying live feeds. Try SEARCHING the system to access archived footage.',
                    media: undefined
                }
            }
        },
        design: {
            authorNotes: "Contains Evidence 1 (CCTV Screenshot). Player searches archived footage to find gray van and print screenshot. Located in CCTV Building.",
            tags: ['evidence-container', 'cctv', 'puzzle']
        },
        version: { schema: "1.0", content: "1.0" }
    },

    'obj_garage_3_glove_box': {
        id: 'obj_garage_3_glove_box' as GameObjectId,
        name: 'Glove Compartment',
        alternateNames: ['glove box', 'glove compartment', 'van glove box', 'compartment'],
        archetype: 'Container',
        description: 'The glove compartment of the gray van. Locked.',
        capabilities: { openable: true, lockable: true, breakable: false, movable: false, powerable: false, container: true, readable: false, inputtable: false },
        state: { isOpen: false, isLocked: true, isBroken: false, isPoweredOn: false, currentStateId: 'default' },
        inventory: { items: [], capacity: 3, allowTags: ['document', 'evidence'], denyTags: [] },
        startingLocation: 'loc_street' as LocationId,
        parentId: 'obj_garage_3' as GameObjectId,
        revealMethod: 'REVEAL_FROM_PARENT',
        children: {
            items: ['item_van_registration' as ItemId],
            objects: []
        },
        handlers: {
            onExamine: [
                {
                    conditions: [{ type: 'STATE', entityId: 'obj_garage_3_glove_box', key: 'isOpen', equals: true }],
                    success: {
                        message: 'The glove compartment is open. Inside you can see the van registration card.',
                        media: undefined
                    }
                },
                {
                    conditions: [],
                    success: {
                        message: 'The van\'s glove compartment. Standard push-button latch. Currently closed.',
                        media: undefined
                    }
                }
            ],
            onOpen: [
                {
                    conditions: [{ type: 'STATE', entityId: 'obj_garage_3_glove_box', key: 'isOpen', equals: true }],
                    success: {
                        message: 'Already open.',
                        media: undefined
                    }
                },
                {
                    conditions: [],
                    success: {
                        message: 'You press the button and the glove compartment pops open.\n\nInside: owner\'s manual, insurance card, and - most importantly - the vehicle registration.\n\nYou pull out the registration card.',
                        media: undefined,
                        effects: [
                            { type: 'SET_ENTITY_STATE', entityId: 'obj_garage_3_glove_box', patch: { isOpen: true } },
                            { type: 'REVEAL_FROM_PARENT', entityId: 'item_van_registration', parentId: 'obj_garage_3_glove_box' }
                        ]
                    }
                }
            ]
        },
        design: {
            authorNotes: "Contains Evidence 2 (Van Registration). Located inside gray van in Garage #3. Reveals owner: Jeremy Miller, 447 Willow Lane.",
            tags: ['evidence-container', 'garage', 'van']
        },
        version: { schema: "1.0", content: "1.0" }
    },

    'obj_electrician_toolbox': {
        id: 'obj_electrician_toolbox' as GameObjectId,
        name: 'Toolbox',
        alternateNames: ['toolbox', 'tool box', 'electrician toolbox', 'work toolbox'],
        archetype: 'Container',
        description: 'A large red metal toolbox in the back of the electrician\'s van. Contains various tools and supplies.',
        capabilities: { openable: true, lockable: false, breakable: false, movable: false, powerable: false, container: true, readable: false, inputtable: false },
        state: { isOpen: false, isLocked: false, isBroken: false, isPoweredOn: false, currentStateId: 'default' },
        inventory: { items: [], capacity: 10, allowTags: [], denyTags: [] },
        startingLocation: 'loc_street' as LocationId,
        parentId: 'obj_electrician_van' as GameObjectId,
        revealMethod: 'REVEAL_FROM_PARENT',
        children: {
            items: ['item_hardware_receipt' as ItemId],
            objects: []
        },
        handlers: {
            onExamine: [
                {
                    conditions: [{ type: 'STATE', entityId: 'obj_electrician_toolbox', key: 'isOpen', equals: true }],
                    success: {
                        message: 'The toolbox is open. You can see various tools inside - wire cutters, voltage tester, electrical tape, and a crumpled receipt.',
                        media: undefined
                    }
                },
                {
                    conditions: [],
                    success: {
                        message: 'A large red metal toolbox, the kind electricians use. Latches on the front, handle on top. Well-used but maintained.',
                        media: undefined
                    }
                }
            ],
            onOpen: [
                {
                    conditions: [{ type: 'STATE', entityId: 'obj_electrician_toolbox', key: 'isOpen', equals: true }],
                    success: {
                        message: 'Already open.',
                        media: undefined
                    }
                },
                {
                    conditions: [],
                    success: {
                        message: 'You flip the latches and open the toolbox.\n\nInside: wire cutters, voltage tester, electrical tape, spare wire, cable ties. Standard electrician kit.\n\nBut wedged in the corner, crumpled between the tools: a folded receipt from "Bloodhaven Hardware & Supply."\n\nYou pull it out carefully.',
                        media: undefined,
                        effects: [
                            { type: 'SET_ENTITY_STATE', entityId: 'obj_electrician_toolbox', patch: { isOpen: true } },
                            { type: 'REVEAL_FROM_PARENT', entityId: 'item_hardware_receipt', parentId: 'obj_electrician_toolbox' }
                        ]
                    }
                }
            ],
            onSearch: {
                success: {
                    message: 'You search through the toolbox carefully. Tools, supplies, and that hardware receipt. Nothing else unusual.',
                    media: undefined
                }
            }
        },
        design: {
            authorNotes: "Contains Evidence 4 (Hardware Receipt). Located in electrician's van. Requires distracting Mike Kowalski (electrician NPC) first to access van.",
            tags: ['evidence-container', 'electrician', 'toolbox']
        },
        version: { schema: "1.0", content: "1.0" }
    }
};

// =====================================
// NPCs
// =====================================

const npcs: Record<NpcId, NPC> = {
    'npc_electrician': {
        id: 'npc_electrician' as NpcId,
        name: 'Electrician',
        archetype: 'Type1-Scripted',
        description: 'A middle-aged man in work coveralls standing by his van.',
        personality: 'Gruff but helpful. He keeps to himself but notices everything on this street.',
        location: 'loc_street' as LocationId,
        image: {
            url: '',
            description: 'Electrician in work clothes',
            hint: 'electrician worker'
        },
        proximity: { minDistance: 0, maxDistance: 10 },
        topics: [
            {
                topicId: 'topic_greeting',
                keywords: ['hello', 'hi', 'hey'],
                response: 'The electrician nods. "Help you with something? I\'m just finishing up a job here."',
                once: false
            },
            {
                topicId: 'topic_lili',
                keywords: ['lili', 'girl', 'missing', 'abduction'],
                response: 'He frowns. "Yeah, I heard about that. Saw a gray van parked here earlier, around 3:30. Didn\'t think much of it at the time."',
                once: true
            }
        ],
        handlers: {
            onTalk: {
                message: 'The electrician wipes his hands on a rag and looks up. "Yeah? What do you need?"'
            }
        },
        npcType: 'type1',
        importance: 'key',
        initialState: {
            stage: 'active',
            isRevealed: true
        },
        version: { schema: '1.0.0', content: '1.0.0' }
    },

    'npc_florist': {
        id: 'npc_florist' as NpcId,
        name: 'Margaret Chen',
        alternateNames: ['margaret', 'margaret chen', 'florist', 'flower shop owner', 'shop owner'],
        archetype: 'Type1-Scripted',
        description: 'Margaret Chen, owner of Petal & Stem florist shop. Middle-aged woman in a floral apron, arranging flowers behind the counter.',
        personality: 'Warm and observant. She\'s been running this flower shop for years and notices the people who come and go on Elm Street.',
        location: 'loc_street' as LocationId,
        image: {
            url: '',
            description: 'Margaret Chen, florist with apron arranging flowers',
            hint: 'flower shop owner'
        },
        proximity: { minDistance: 0, maxDistance: 10 },
        topics: [
            {
                topicId: 'topic_greeting',
                keywords: ['hello', 'hi', 'hey', 'greet'],
                response: 'She smiles warmly. "Good afternoon! Welcome to Petal & Stem. Can I help you with anything?"',
                once: false
            },
            {
                topicId: 'topic_flowers',
                keywords: ['flowers', 'bouquet', 'shop', 'business'],
                response: 'Her eyes light up. "We\'ve been here on Elm Street for fifteen years. Fresh flowers daily - roses, lilies, tulips. I take pride in remembering my regular customers."',
                once: false
            },
            {
                topicId: 'topic_neighborhood',
                keywords: ['street', 'neighborhood', 'elm street', 'area'],
                response: 'She nods thoughtfully. "This street has changed over the years. Used to be quieter. Now there\'s always something happening. I try to keep an eye out - you notice things when you work the same corner every day."',
                once: false
            }
        ],
        handlers: {
            onTalk: {
                success: {
                    message: 'Margaret Chen looks up from arranging a bouquet of white roses. She smiles warmly.\n\n"Hello there! Welcome to Petal & Stem. Beautiful day, isn\'t it? Can I help you find something?"',
                    media: undefined
                }
            },
            onShowPhoto: [
                {
                    // Already gave statement
                    conditions: [
                        { type: 'HAS_ITEM', itemId: 'item_witness_statement_audio' as ItemId }
                    ],
                    success: {
                        message: 'Margaret glances at the photo and nods. "Yes, I already told you everything I know about her and that young man. I hope my statement helps your investigation."',
                        media: undefined
                    }
                },
                {
                    // First time showing photo - trigger witness statement
                    conditions: [],
                    success: {
                        message: 'You pull out a photo of Lili and show it to Margaret.\n\nHer eyes widen slightly in recognition. She sets down her pruning shears.\n\n"Oh my. Yes, I\'ve seen her. She comes in sometimes. Not alone, though. Always with a young man."\n\nYou lean in. "Can you describe him?"\n\nMargaret\'s expression becomes serious. "Mid-twenties, I\'d say. Quiet type. But... intense. The way he looked at her—completely devoted. Hung on her every word. She seemed more... reserved. Calculating, almost. Always looking over her shoulder.\n\nBut him? He\'d do anything she asked. Anything. I\'ve seen that look before. It\'s... obsession."\n\nYou ask, "Would you be willing to give an official statement?"\n\nMargaret nods firmly. "Of course. If this helps you, Detective, I\'m happy to go on record."\n\nYou pull out your phone and start recording.',
                        media: undefined,
                        effects: [
                            { type: 'ADD_ITEM', itemId: 'item_witness_statement_audio' as ItemId },
                            {
                                type: 'SHOW_MESSAGE',
                                speaker: 'system',
                                content: '[Recording Started]\n\nMargaret Chen clears her throat and speaks clearly:\n\n"My name is Margaret Chen, owner of Petal & Stem Florist on Elm Street. I\'ve seen the woman in this photo—Lili—multiple times over the past two months. She always came with a young man who appeared obsessively devoted to her. She seemed detached, but he would do anything she asked."\n\n[Recording Saved: Witness_Statement_Margaret_Chen.mp3]\n\n**EVIDENCE 3 ACQUIRED**: Recorded witness statement proving Lili had a relationship with an obsessed young man.'
                            }
                        ]
                    }
                }
            ]
        },
        npcType: 'type1',
        importance: 'key',
        initialState: {
            stage: 'active',
            isRevealed: true
        },
        version: { schema: '1.0.0', content: '2.0.0' }
    },

    'npc_kiosk_vendor': {
        id: 'npc_kiosk_vendor' as NpcId,
        name: 'Kiosk Vendor',
        archetype: 'Type1-Scripted',
        description: 'An elderly man running the neighborhood kiosk. He sells newspapers and snacks.',
        personality: 'Grumpy but observant. He\'s been running this kiosk for decades.',
        location: 'loc_street' as LocationId,
        image: {
            url: '',
            description: 'Elderly kiosk vendor',
            hint: 'old newspaper seller'
        },
        proximity: { minDistance: 0, maxDistance: 10 },
        topics: [
            {
                topicId: 'topic_greeting',
                keywords: ['hello', 'hi', 'hey'],
                response: 'He grunts. "You buying something or just wasting my time?"',
                once: false
            },
            {
                topicId: 'topic_van',
                keywords: ['van', 'gray', 'vehicle', 'suspicious'],
                response: 'He squints. "Gray van? Yeah, I saw it. Parked right there by the gray building. Driver didn\'t get out. Just sat there watching."',
                once: true
            }
        ],
        handlers: {
            onTalk: {
                message: 'The vendor looks up from his newspaper. "What do you want?"'
            }
        },
        npcType: 'type1',
        importance: 'key',
        initialState: {
            stage: 'active',
            isRevealed: true
        },
        version: { schema: '1.0.0', content: '1.0.0' }
    }
};

// =====================================
// LOCATIONS
// =====================================

const locations: Record<LocationId, Location> = {
    'loc_street': {
        locationId: 'loc_street' as LocationId,
        name: 'Elm Street',
        sceneDescription: 'Elm Street is a quiet urban neighborhood. Bus stops, small shops, and residential buildings line both sides of the street. This is where Lili was last seen.',
        introMessage: 'You arrive at Elm Street. This is where Lili Morgenstern claims the abduction happened. The street is quiet now, but you know the truth is buried here somewhere.',
        objects: [
            'obj_bus_stop' as GameObjectId,
            'obj_gray_building_door' as GameObjectId,
            'obj_florist_shop' as GameObjectId,
            'obj_kiosk_counter' as GameObjectId,
            'obj_side_alley' as GameObjectId
        ],
        npcs: [
            'npc_electrician' as NpcId,
            'npc_florist' as NpcId,
            'npc_kiosk_vendor' as NpcId
        ],
        zones: [
            {
                id: 'zone_street_overview' as ZoneId,
                isDefault: true,
                title: 'Street Overview',
                description: 'You stand on Elm Street, taking in the scene',
                objectIds: [],
                transitionNarration: 'You step back to get a wider view of the street'
            },
            {
                id: 'zone_bus_stop' as ZoneId,
                parent: 'zone_street_overview' as ZoneId,
                title: 'Bus Stop',
                objectIds: ['obj_bus_stop' as GameObjectId, 'obj_bench' as GameObjectId, 'obj_info_board' as GameObjectId, 'obj_bus_sign' as GameObjectId],
                transitionNarration: 'You walk over to the bus stop'
            },
            {
                id: 'zone_gray_building' as ZoneId,
                parent: 'zone_street_overview' as ZoneId,
                title: 'Gray Building',
                objectIds: ['obj_gray_building_door' as GameObjectId],
                transitionNarration: 'You approach the gray building entrance'
            },
            {
                id: 'zone_florist' as ZoneId,
                parent: 'zone_street_overview' as ZoneId,
                title: 'Florist Shop',
                objectIds: ['obj_florist_shop' as GameObjectId],
                transitionNarration: 'You walk toward the florist shop'
            },
            {
                id: 'zone_kiosk' as ZoneId,
                parent: 'zone_street_overview' as ZoneId,
                title: 'Kiosk',
                objectIds: ['obj_kiosk_counter' as GameObjectId],
                transitionNarration: 'You move to the kiosk counter'
            },
            {
                id: 'zone_side_alley' as ZoneId,
                parent: 'zone_street_overview' as ZoneId,
                title: 'Side Alley',
                objectIds: ['obj_side_alley' as GameObjectId],
                transitionNarration: 'You turn into the narrow side alley'
            },
            {
                id: 'zone_at_dumpster' as ZoneId,
                parent: 'zone_side_alley' as ZoneId,
                title: 'At the Dumpster',
                objectIds: ['obj_dumpster' as GameObjectId],
                transitionNarration: 'You approach the large dumpster'
            },
            {
                id: 'zone_inside_dumpster' as ZoneId,
                parent: 'zone_at_dumpster' as ZoneId,
                title: 'Inside the Dumpster',
                objectIds: ['obj_old_suitcase' as GameObjectId, 'obj_paper_carton' as GameObjectId, 'obj_backpack' as GameObjectId],
                requiresAction: 'climb',
                transitionNarration: 'You climb into the dumpster, surrounded by garbage'
            }
        ],
        transitionTemplates: [
            'You walk down Elm Street toward the {entity}. The afternoon sun casts long shadows across the pavement.',
            'You move carefully toward the {entity}, scanning the surroundings. This is where she vanished.',
            'Your footsteps echo on the quiet street as you approach the {entity}. No one seems to notice you.',
            'You cross the street toward the {entity}, dodging a puddle from last night\'s rain.',
            'The street is nearly empty as you make your way to the {entity}. A car passes slowly, driver barely glancing your way.',
            'You navigate past a parked delivery truck, heading for the {entity}. The smell of exhaust lingers.',
            'A light breeze carries the scent of flowers from the florist as you approach the {entity}.',
            'You step around cracked pavement, moving toward the {entity}. This neighborhood has seen better days.',
            'The kiosk vendor watches you briefly as you head to the {entity}, then returns to his newspaper.',
            'You walk past faded storefronts toward the {entity}. Elm Street feels frozen in time, stuck somewhere between neglect and normalcy.'
        ],
        spatialMode: 'sprawling' // Large outdoor area - requires navigation between zones
    },

    'loc_courtyard': {
        locationId: 'loc_courtyard' as LocationId,
        name: 'Hidden Courtyard',
        sceneDescription: 'A small neglected courtyard hidden behind the side alley. Cracked concrete, overgrown weeds pushing through the cracks. Three garage doors line the back wall, each painted a different faded color: blue, red, green. The air here feels stagnant, forgotten.',
        introMessage: 'You step through the hidden door into the courtyard. It\'s quiet here—too quiet. The three garage doors stare back at you like closed eyes. What secrets do they hide?',
        objects: [
            'obj_old_tires' as GameObjectId,
            'obj_garage_blue_door' as GameObjectId,
            'obj_garage_red_door' as GameObjectId,
            'obj_garage_green_door' as GameObjectId
        ],
        npcs: [],
        zones: [
            {
                title: 'Courtyard Ground',
                objectIds: ['obj_old_tires' as GameObjectId]
            },
            {
                title: 'Blue Garage',
                objectIds: ['obj_garage_blue_door' as GameObjectId]
            },
            {
                title: 'Red Garage',
                objectIds: ['obj_garage_red_door' as GameObjectId]
            },
            {
                title: 'Green Garage',
                objectIds: ['obj_garage_green_door' as GameObjectId]
            }
        ]
    },

    'loc_garage_blue': {
        locationId: 'loc_garage_blue' as LocationId,
        name: 'Blue Garage Interior',
        sceneDescription: 'The blue garage is dark and musty. Old tools hang on the walls, covered in rust and dust. A workbench sits against the far wall.',
        introMessage: 'You step into the blue garage. The smell of motor oil and decay fills your nostrils.',
        objects: [],
        npcs: [],
        zones: []
    },

    'loc_garage_red': {
        locationId: 'loc_garage_red' as LocationId,
        name: 'Red Garage Interior',
        sceneDescription: 'The red garage is cluttered with boxes and old furniture. Everything is covered in a thick layer of dust.',
        introMessage: 'The red garage opens before you. Shadows loom in the corners.',
        objects: [],
        npcs: [],
        zones: []
    },

    'loc_garage_green': {
        locationId: 'loc_garage_green' as LocationId,
        name: 'Green Garage Interior',
        sceneDescription: 'The green garage is almost empty. Just bare concrete walls and a drain in the center of the floor.',
        introMessage: 'You push open the green garage door. The space inside is eerily empty.',
        objects: [],
        npcs: [],
        zones: []
    },

    // ============================================
    // DARK ALLEY LOCATIONS
    // ============================================

    'loc_dark_alley': {
        locationId: 'loc_dark_alley' as LocationId,
        name: 'Dark Alley',
        sceneDescription: 'A narrow alley behind the main street. The smell of garbage and damp concrete fills your nostrils. Rain-slicked walls close in on both sides. The dim light barely illuminates scattered objects and graffiti.',
        coord: { x: 2, y: 1, z: 0 },
        spatialMode: 'compact',
        objects: ['obj_alley_dumpster', 'obj_graffiti', 'obj_alley_crates', 'obj_rusty_locker'] as GameObjectId[],
        npcs: [],
        entryPortals: ['portal_street_to_alley' as PortalId],
        exitPortals: ['portal_alley_to_street' as PortalId, 'portal_alley_to_hidden_room' as PortalId],
        zones: [
            {
                title: 'Against the far wall',
                objectIds: ['obj_alley_crates', 'obj_alley_metal_door']
            },
            {
                title: 'Near the dumpster',
                objectIds: ['obj_alley_dumpster']
            },
            {
                title: 'On the brick wall',
                objectIds: ['obj_graffiti']
            },
            {
                title: 'In the corner',
                objectIds: ['obj_rusty_locker']
            }
        ],
        transitionTemplates: [
            'You navigate through puddles and debris toward the {entity}.',
            'The stench grows stronger as you approach the {entity}.',
            'Your footsteps echo off wet brick as you move to the {entity}.',
            'You pick your way through scattered trash toward the {entity}.',
            'Rain drips from fire escapes above as you head for the {entity}.'
        ]
    },

    'loc_hidden_room': {
        locationId: 'loc_hidden_room' as LocationId,
        name: 'Hidden Room',
        sceneDescription: 'A cramped, windowless space hidden behind the alley wall. Bare concrete, a single dim bulb overhead. This room was meant to stay secret. The air is stale and cold.',
        coord: { x: 3, y: 1, z: 0 },
        spatialMode: 'compact',
        objects: ['obj_hidden_table', 'obj_hidden_shelf'] as GameObjectId[],
        npcs: [],
        entryPortals: ['portal_hidden_room_from_alley' as PortalId],
        exitPortals: ['portal_hidden_room_to_alley' as PortalId],
        zones: [
            {
                title: 'Against the back wall',
                objectIds: ['obj_hidden_shelf']
            },
            {
                title: 'In the center',
                objectIds: ['obj_hidden_table']
            }
        ],
        transitionTemplates: [
            'You move through the cramped space to the {entity}.',
            'The bare bulb flickers as you approach the {entity}.',
            'Your shoes scrape on concrete as you reach the {entity}.'
        ]
    },

    'loc_garage': {
        locationId: 'loc_garage' as LocationId,
        name: 'Garage',
        sceneDescription: 'A cluttered garage space. Tools hang on pegboards, oil stains mark the floor. The air smells of gasoline and old newspapers. This is clearly a workspace that\'s seen better days.',
        coord: { x: 1, y: 2, z: 0 },
        spatialMode: 'compact',
        objects: ['obj_workbench', 'obj_tool_cabinet'] as GameObjectId[],
        npcs: [],
        entryPortals: ['portal_street_to_garage' as PortalId],
        exitPortals: ['portal_garage_to_street' as PortalId],
        zones: [
            {
                title: 'At the workbench',
                objectIds: ['obj_workbench']
            },
            {
                title: 'Against the wall',
                objectIds: ['obj_tool_cabinet']
            }
        ],
        transitionTemplates: [
            'You walk across oil-stained concrete to the {entity}.',
            'Tools rattle slightly as you move toward the {entity}.',
            'The smell of gasoline intensifies near the {entity}.'
        ]
    }
};

// =====================================
// PORTALS, STRUCTURES, WORLD
// =====================================

const portals: Record<PortalId, Portal> = {
    'portal_street_to_courtyard': {
        id: 'portal_street_to_courtyard' as PortalId,
        fromLocationId: 'loc_street' as LocationId,
        toLocationId: 'loc_courtyard' as LocationId,
        doorObjectId: 'obj_courtyard_door' as GameObjectId,
        isRevealed: false,
        isAccessible: false,
        description: 'A hidden door behind the dumpster in the side alley.',
        transitionMessage: 'You pass through the hidden door into the forgotten courtyard.'
    },
    'portal_courtyard_to_street': {
        id: 'portal_courtyard_to_street' as PortalId,
        fromLocationId: 'loc_courtyard' as LocationId,
        toLocationId: 'loc_street' as LocationId,
        doorObjectId: 'obj_courtyard_door' as GameObjectId,
        isRevealed: true,
        isAccessible: true,
        description: 'The door back to the side alley.',
        transitionMessage: 'You return through the door to the side alley.'
    },
    'portal_courtyard_to_blue_garage': {
        id: 'portal_courtyard_to_blue_garage' as PortalId,
        fromLocationId: 'loc_courtyard' as LocationId,
        toLocationId: 'loc_garage_blue' as LocationId,
        doorObjectId: 'obj_garage_blue_door' as GameObjectId,
        isRevealed: true,
        isAccessible: false,
        description: 'The faded blue garage door.',
        transitionMessage: 'You enter the blue garage.'
    },
    'portal_blue_garage_to_courtyard': {
        id: 'portal_blue_garage_to_courtyard' as PortalId,
        fromLocationId: 'loc_garage_blue' as LocationId,
        toLocationId: 'loc_courtyard' as LocationId,
        doorObjectId: 'obj_garage_blue_door' as GameObjectId,
        isRevealed: true,
        isAccessible: true,
        description: 'The blue garage door back to the courtyard.',
        transitionMessage: 'You step back into the courtyard.'
    },
    'portal_courtyard_to_red_garage': {
        id: 'portal_courtyard_to_red_garage' as PortalId,
        fromLocationId: 'loc_courtyard' as LocationId,
        toLocationId: 'loc_garage_red' as LocationId,
        doorObjectId: 'obj_garage_red_door' as GameObjectId,
        isRevealed: true,
        isAccessible: false,
        description: 'The rusted red garage door.',
        transitionMessage: 'You enter the red garage.'
    },
    'portal_red_garage_to_courtyard': {
        id: 'portal_red_garage_to_courtyard' as PortalId,
        fromLocationId: 'loc_garage_red' as LocationId,
        toLocationId: 'loc_courtyard' as LocationId,
        doorObjectId: 'obj_garage_red_door' as GameObjectId,
        isRevealed: true,
        isAccessible: true,
        description: 'The red garage door back to the courtyard.',
        transitionMessage: 'You step back into the courtyard.'
    },
    'portal_courtyard_to_green_garage': {
        id: 'portal_courtyard_to_green_garage' as PortalId,
        fromLocationId: 'loc_courtyard' as LocationId,
        toLocationId: 'loc_garage_green' as LocationId,
        doorObjectId: 'obj_garage_green_door' as GameObjectId,
        isRevealed: true,
        isAccessible: false,
        description: 'The green garage door.',
        transitionMessage: 'You enter the green garage.'
    },
    'portal_green_garage_to_courtyard': {
        id: 'portal_green_garage_to_courtyard' as PortalId,
        fromLocationId: 'loc_garage_green' as LocationId,
        toLocationId: 'loc_courtyard' as LocationId,
        doorObjectId: 'obj_garage_green_door' as GameObjectId,
        isRevealed: true,
        isAccessible: true,
        description: 'The green garage door back to the courtyard.',
        transitionMessage: 'You step back into the courtyard.'
    },

    // ============================================
    // DARK ALLEY PORTALS
    // ============================================

    'portal_street_to_alley': {
        id: 'portal_street_to_alley' as PortalId,
        fromLocationId: 'loc_street' as LocationId,
        toLocationId: 'loc_dark_alley' as LocationId,
        isRevealed: true,
        isAccessible: true,
        description: 'A narrow passage leading into a dark alley.',
        transitionMessage: 'You enter the dark alley.'
    },

    'portal_alley_to_street': {
        id: 'portal_alley_to_street' as PortalId,
        fromLocationId: 'loc_dark_alley' as LocationId,
        toLocationId: 'loc_street' as LocationId,
        isRevealed: true,
        isAccessible: true,
        description: 'The exit back to the main street.',
        transitionMessage: 'You step back onto the street.'
    },

    'portal_alley_to_hidden_room': {
        id: 'portal_alley_to_hidden_room' as PortalId,
        fromLocationId: 'loc_dark_alley' as LocationId,
        toLocationId: 'loc_hidden_room' as LocationId,
        doorObjectId: 'obj_alley_metal_door' as GameObjectId,
        isRevealed: false,
        isAccessible: false,
        description: 'The metal door with the keypad. Opens to a hidden room.',
        transitionMessage: 'You step through the hidden door.'
    },

    'portal_hidden_room_from_alley': {
        id: 'portal_hidden_room_from_alley' as PortalId,
        fromLocationId: 'loc_hidden_room' as LocationId,
        toLocationId: 'loc_dark_alley' as LocationId,
        doorObjectId: 'obj_alley_metal_door' as GameObjectId,
        isRevealed: true,
        isAccessible: true,
        description: 'The door back to the alley.',
        transitionMessage: 'You step back into the alley.'
    },

    'portal_hidden_room_to_alley': {
        id: 'portal_hidden_room_to_alley' as PortalId,
        fromLocationId: 'loc_hidden_room' as LocationId,
        toLocationId: 'loc_dark_alley' as LocationId,
        doorObjectId: 'obj_alley_metal_door' as GameObjectId,
        isRevealed: true,
        isAccessible: true,
        description: 'The door leading back to the alley.',
        transitionMessage: 'You exit the hidden room.'
    },

    // ============================================
    // GARAGE PORTALS
    // ============================================

    'portal_street_to_garage': {
        id: 'portal_street_to_garage' as PortalId,
        fromLocationId: 'loc_street' as LocationId,
        toLocationId: 'loc_garage' as LocationId,
        isRevealed: true,
        isAccessible: true,
        description: 'A roll-up garage door, standing open.',
        transitionMessage: 'You enter the garage.'
    },

    'portal_garage_to_street': {
        id: 'portal_garage_to_street' as PortalId,
        fromLocationId: 'loc_garage' as LocationId,
        toLocationId: 'loc_street' as LocationId,
        isRevealed: true,
        isAccessible: true,
        description: 'The garage door leading back to the street.',
        transitionMessage: 'You step back onto the street.'
    }
};

const structures: Record<StructureId, Structure> = {};

const world = {
    worldId: 'world_chapter1' as WorldId,
    name: 'Chapter 1 World',
    cells: {},
    navEdges: []
};

// =====================================
// CHAPTERS
// =====================================

const chapters: Record<ChapterId, Chapter> = {
    'chapter_1': {
        id: 'chapter_1' as ChapterId,
        title: 'Chapter 1: The Investigation Begins',
        goal: 'Investigate the alleged abduction of Lili Morgenstern and gather evidence proving it was staged.',
        objectives: [
            { flag: 'received_case_files' as Flag, label: 'Review the case files' },
            { flag: 'talked_to_witnesses' as Flag, label: 'Interview witnesses on Elm Street' },
            { flag: 'found_first_clue' as Flag, label: 'Discover the first clue' },
        ],
        hints: [
            'Start by examining Sarah\'s voice message about the gray van.',
            'Look around the street to see all the zones.',
            'Talk to the people on the street—they might have seen something.',
            'Show Lili\'s photo to witnesses who might recognize her.'
        ],
        startLocationId: 'loc_street' as LocationId,
        introMessage: 'Sarah sends you a photo of Lili Morgenstern and a brief message about a gray van spotted repeatedly on Elm Street before the alleged abduction.\n\nThis is where it happened. This quiet street is where Lili claims you abducted her. Time to prove the truth—that it was staged.',
        locations: {},
        gameObjects: {},
        items: {},
        npcs: {},
    }
};

// =====================================
// MAIN GAME CARTRIDGE
// =====================================

export const game: Game = {
    id: 'chapter-1-investigation' as GameId,
    title: 'Walk in Justice - Chapter 1',
    description: 'The investigation deepens. After uncovering the metal box and its dark secrets, you must now connect the dots between a 1940s cold case and a modern-day copycat killer. The staged abduction of Lili Morgenstern is just the beginning.',
    setting: 'Modern-day USA, 2025 - Elm Street',
    gameType: 'Limited Open World',
    narratorName: 'Narrator',
    promptContext: `You are the System, responsible for interpreting player commands and translating them into valid game actions. Your role is purely technical—you analyze input and route it to the correct handler.

**// 1. Your Primary Task: Command Interpretation**
Your single most important task is to translate the player's natural language input into a single, valid game command from the 'Available Game Commands' list. Use the exact entity names provided in the 'Visible Names' lists.

**// 2. Your Response Protocol**
- **NO System Messages for Valid Commands:** For ALL valid, actionable commands (take, use, examine, open, read, move, break, etc.), your \`agentResponse\` MUST ALWAYS be null. The Narrator handles ALL descriptive output.

**// 3. Handling Invalid Input**
- **Illogical/Destructive Actions:** ONLY mark as invalid for truly nonsensical actions. Use \`commandToExecute: "invalid"\`.
- **CRITICAL - You MUST NOT Block Valid Commands:** Your ONLY job is translating natural language → game commands.

**// 4. Final Output**
Your entire output must be a single, valid JSON object matching the output schema.
`,
    objectInteractionPromptContext: `You are the System, processing the player's interaction with the {{objectName}}. Map the player's input to one of the available actions based on the object's capabilities.`,
    storyStyleGuide: `You are a master storyteller transforming a text-based RPG log into a captivating crime noir chapter. Write in third person, past tense, focusing on FBI agent Burt Macklin. Use rich, descriptive noir style with atmosphere and internal thought.`,

    systemMedia: {
        take: {
            success: {
                url: '',
                description: 'Item goes into pocket',
                hint: 'putting item away'
            }
        }
    },

    systemMessages: {
        needsTarget: {
            examine: "need_target_examine",
            read: "need_target_read",
            take: "need_target_take",
            goto: "need_target_goto",
        },
        notVisible: (itemName: string) => "item_not_visible",
        inventoryEmpty: "inventory_empty",
        inventoryList: (itemNames: string) => `You're carrying:\n${itemNames}`,  // Keep static (structured list)
        alreadyHaveItem: (itemName: string) => "already_have_item",
        cannotGoThere: "cannot_go_there",
        chapterIncomplete: (goal: string, locationName: string) => "chapter_incomplete",
        chapterTransition: (chapterTitle: string) => `━━━ ${chapterTitle} ━━━`,  // Keep static (structured divider)
        locationTransition: (locationName: string) => `You arrive at ${locationName}.`,  // Keep static (simple announcement)
        noNextChapter: "no_next_chapter",
        notReadable: (itemName: string) => "item_not_readable",
        alreadyReadAll: (itemName: string) => "already_read_all",
        textIllegible: "text_illegible",
        dontHaveItem: (itemName: string) => "dont_have_item",
        cantUseItem: (itemName: string) => "cant_use_item",
        cantUseOnTarget: (itemName: string, targetName: string) => "cant_use_item_on_target",
        noVisibleTarget: (targetName: string) => "no_visible_target",
        useDidntWork: "use_didnt_work",
        cantMoveObject: (objectName: string) => "cant_move_object",
        movedNothingFound: (objectName: string) => "moved_nothing_found",
        cantOpen: (targetName: string) => "cant_open",
        needsFocus: "needs_focus",
        focusSystemError: "focus_system_error",
        noPasswordInput: (objectName: string) => "no_password_input",
        alreadyUnlocked: (objectName: string) => "already_unlocked",
        wrongPassword: "wrong_password",
        cantDoThat: "cant_do_that",
        somethingWentWrong: "something_went_wrong",
    },

    world: world,
    structures: structures,
    locations: locations,
    portals: portals,
    gameObjects: gameObjects,
    items: items,
    npcs: npcs,
    chapters: chapters,
    startChapterId: 'chapter_1' as ChapterId,
};
